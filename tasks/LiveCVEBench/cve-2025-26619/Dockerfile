FROM node:20-bullseye

WORKDIR /app

# System dependencies (tmux, asciinema, curl are required)
RUN apt-get update && apt-get install -y \
    git \
    tmux \
    asciinema \
    curl \
    rsync \
    python3 \
    build-essential \
    libcairo2-dev \
    libpango1.0-dev \
    libjpeg-dev \
    libgif-dev \
    && rm -rf /var/lib/apt/lists/*

# Clone vulnerable version and remove git history
RUN git clone --depth 1 --branch v5.30.0 https://github.com/vega/vega.git . && rm -rf .git

# Install dependencies
RUN yarn install

# Build all packages
RUN yarn build

# Keep container running for testing
CMD ["tail", "-f", "/dev/null"]
