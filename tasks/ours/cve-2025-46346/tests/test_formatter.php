<?php
/**
 * Test wrapper for wakka.php formatter
 * Usage: php test_formatter.php <base64_encoded_input>
 */

// Define required constants
define('WN_WIKI_LINK', '[A-Z][a-z]+[A-Z][a-zA-Z]*');
define('YW_CHARSET', 'UTF-8');

// Read wakka.php content and remove the executable tail
$wakkaContent = file_get_contents('/app/formatters/wakka.php');
// Remove the last executable lines that use $this outside class
$wakkaContent = preg_replace('/\$form = new .*$/s', '', $wakkaContent);
$wakkaContent = preg_replace('/<\?php/', '', $wakkaContent, 1);
eval($wakkaContent);

// Create a mock wiki object
class MockWiki {
    public function GetConfigValue($key, $default = null) {
        if ($key === 'disable_wiki_links') return true;
        return $default;
    }
    public function Link($thing) {
        return $thing;
    }
    public function Format($text, $formatter = 'wakka') {
        return $text;
    }
    public function Action($action) {
        return "{{" . $action . "}}";
    }
}

$wiki = new MockWiki();
$formatter = new \YesWiki\WikiniFormatter($wiki);

// Decode input from base64
$text = base64_decode($argv[1]);
$result = $formatter->format($text);
echo $result;
