instruction: |-
  This application is a web server built with the Oak middleware framework for
  Deno. It operates behind a reverse proxy (nginx/load balancer) and uses
  the `proxy: true` configuration to correctly extract client information from
  forwarded headers.

  When processing HTTP requests with unusually long `X-Forwarded-For` or
  `X-Forwarded-Proto` headers (e.g., headers containing thousands of whitespace
  characters between commas), the server becomes extremely slow to respond.
  For example, a header with ~64,000 whitespace characters can cause response
  times to exceed 4 seconds, and larger payloads cause proportionally worse
  delays. This makes the server unresponsive and affects all users.

  Additionally, there are some inconsistencies in header parsing:
  - Headers with many comma-separated entries are all processed without any
    reasonable limit
  - The `X-Forwarded-Proto` header accepts arbitrary protocol values without
    validation (should only allow "http" or "https")
  - Whitespace around comma-separated values is not properly trimmed in all cases

  Expected behavior:
  - The server should respond quickly regardless of header content length
  - Input should be bounded to prevent resource exhaustion
  - The number of parsed IP entries should be reasonably limited (e.g., 100 max)
  - Protocol values should be validated to only accept "http" or "https"
  - Whitespace around values should be properly trimmed

difficulty: medium
category: bug-fix
tags:
  - deno
  - oak
  - performance
  - input-validation
  - header-parsing
parser_name: pytest

run_tests_in_same_shell: false
