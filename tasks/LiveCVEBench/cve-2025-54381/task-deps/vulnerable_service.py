"""
Vulnerable BentoML service that demonstrates CVE-2025-54381 SSRF vulnerability.
This service accepts file paths via URL and will fetch from any URL without validation.
"""
from __future__ import annotations
from pathlib import Path
import bentoml


@bentoml.service
class FileProcessor:
    """
    A simple file processor service that accepts file paths.
    The vulnerability exists because BentoML automatically downloads files
    from user-provided URLs without validating the target addresses.
    """

    @bentoml.api
    def process_file(self, file: Path) -> str:
        """
        Process a file and return its content length.

        When called with a URL (e.g., via multipart form or JSON body),
        BentoML will automatically fetch the URL content without checking
        if it points to internal resources like:
        - http://localhost:8080/admin
        - http://169.254.169.254/latest/meta-data/
        - http://10.0.0.1:22
        """
        try:
            content = file.read_bytes()
            return f"Processed file: {file.name}, size: {len(content)} bytes"
        except Exception as e:
            return f"Error processing file: {str(e)}"

    @bentoml.api
    def process_text(self, text_file: Path) -> str:
        """
        Process a text file and return its content.
        """
        try:
            content = file.read_text()
            return f"Content: {content[:100]}..."
        except Exception as e:
            return f"Error: {str(e)}"
