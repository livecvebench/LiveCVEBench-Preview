FROM php:7.4-apache

WORKDIR /var/www/html

# Install system dependencies
RUN apt-get update && apt-get install -y \
    tmux \
    asciinema \
    curl \
    default-mysql-client \
    && rm -rf /var/lib/apt/lists/*

# Install mysqli PHP extension
RUN docker-php-ext-install mysqli

# Enable Apache rewrite module (optional but useful)
RUN a2enmod rewrite

# Copy application files
COPY task-deps/Supply_Management_System /var/www/html/Supply_Management_System

# Update config files with correct database settings
COPY task-deps/config.php /var/www/html/Supply_Management_System/config.php
COPY task-deps/includes_config.php /var/www/html/Supply_Management_System/includes/config.php

# Set proper permissions
RUN chown -R www-data:www-data /var/www/html/Supply_Management_System && \
    chmod -R 755 /var/www/html/Supply_Management_System

# Copy entrypoint script
COPY task-deps/entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Expose port 80
EXPOSE 80

# Use entrypoint to wait for DB and start Apache
# CMD ["/entrypoint.sh"]
