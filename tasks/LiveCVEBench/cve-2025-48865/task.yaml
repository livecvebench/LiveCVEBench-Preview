instruction: |-
  Fabio is a fast HTTP(S) and TCP load balancing router for Consul-managed applications.
  It automatically adds forwarding headers (X-Forwarded-Host, X-Forwarded-Port,
  X-Forwarded-Proto, X-Real-Ip, Forwarded) to requests when proxying to backend services.

  Users have reported that certain forwarding headers are mysteriously missing when
  requests reach backend applications. This occurs when clients send HTTP requests with
  custom Connection header values that reference these forwarding headers.

  For example, when a client sends a request with:
    Connection: keep-alive, X-Real-Ip

  The backend receives the request without the X-Real-Ip header, even though Fabio
  should have added it. The same issue affects other forwarding headers like
  X-Forwarded-Host, Forwarded, X-Forwarded-Proto, etc.

  Backend applications that rely on these headers for determining client IP addresses,
  request protocols, or original hostnames are receiving incomplete information. This
  breaks logging, access controls, and request routing that depend on these headers.

  The expected behavior is that Fabio's forwarding headers should always be present
  in proxied requests, regardless of what the client specifies in the Connection header.

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: bug-fix
tags:
  - go
  - http-proxy
  - header-handling
  - reverse-proxy
parser_name: pytest

run_tests_in_same_shell: false
