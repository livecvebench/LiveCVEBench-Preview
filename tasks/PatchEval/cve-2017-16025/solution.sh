cat <<'EOF' > /workspace/fix.patch
diff --git a/lib/socket.js b/lib/socket.js
index 261156e..5465eaa 100755
--- a/lib/socket.js
+++ b/lib/socket.js
@@ -537,7 +537,12 @@ internals.Socket.prototype._authenticate = function () {
         return;
     }
 
-    this._listener._connection.states.parse(cookies, (ignoreErr, state, failed) => {
+    this._listener._connection.states.parse(cookies, (err, state, failed) => {
+
+        if (err) {
+            this.auth._error = Boom.unauthorized('Invalid nes authentication cookie');
+            return;
+        }
 
         const auth = state[config.cookie];
         if (auth) {
            

EOF

cd /workspace/nes
git apply --whitespace=nowarn  /workspace/fix.patch