#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2021-41803:latest
# bash /workspace/fix-run.sh
set -e

cd /workspace/consul
git apply --whitespace=nowarn /tests/test.patch 
go test  -timeout 30s -run ^TestAutoConfigInitialConfiguration$ github.com/hashicorp/consul/agent/consul

cd /workspace
#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2021-41803:latest
# bash /workspace/unit_test.sh
set -e

cd /workspace/consul
go test -timeout 30s -run '^(TestAutoConfig_updateTLSCertificatesInConfig|TestAutoConfig_updateACLsInConfig|TestAutoConfig_updateGossipEncryptionInConfig|TestAutoConfig_baseConfig|TestAutoConfigInitialConfiguration|TestAutoConfig_updateTLSSettingsInConfig|TestAutoConfig_updateJoinAddressesInConfig)$' github.com/hashicorp/consul/agent/consul