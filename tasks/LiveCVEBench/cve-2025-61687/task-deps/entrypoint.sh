#!/bin/sh

# Entrypoint script for Flowise CVE-2025-61687
# This script wraps the Flowise service to allow restart after code changes

# Trap signals for graceful shutdown
trap 'exit 0' SIGTERM SIGINT

# Change to the server directory
cd /app/packages/server

# Main loop - allows service restart
while true; do
    echo "[Entrypoint] Starting Flowise..."
    ./bin/run start &
    SERVER_PID=$!
    wait $SERVER_PID
    EXIT_CODE=$?
    echo "[Entrypoint] Flowise exited with code $EXIT_CODE"

    # If flowise exits normally (code 0), restart it
    # If it crashes or is killed, also restart
    sleep 2
done
