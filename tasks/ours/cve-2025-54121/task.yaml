instruction: |-
  This application is a Python async web service built with Starlette that
  handles file uploads via multipart forms.

  Users are reporting that the application becomes unresponsive when multiple
  clients upload files larger than 1MB simultaneously. Profiling shows that the
  async event loop becomes blocked during certain file upload operations.

  The issue manifests as:
  - Increased latency for all concurrent requests during large file uploads
  - Connection timeouts under high concurrency
  - The application stops accepting new connections temporarily

  Investigation suggests the blocking occurs when uploaded files transition from
  memory storage to disk storage (files are initially buffered in memory up to
  1MB, then written to temporary files on disk).

  Fix the file handling code so that disk I/O operations during file uploads
  don't block the async event loop, even when files exceed the memory buffer
  threshold.

difficulty: medium
category: bug-fix
tags:
  - python
  - async
  - starlette
  - file-upload
  - event-loop
parser_name: pytest

run_tests_in_same_shell: false
