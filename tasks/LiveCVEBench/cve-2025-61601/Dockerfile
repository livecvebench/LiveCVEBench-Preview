FROM node:20-slim

WORKDIR /app

# System dependencies (tmux, asciinema, curl are required)
RUN apt-get update && apt-get install -y git tmux asciinema curl && rm -rf /var/lib/apt/lists/*

# Create source directory structure
RUN mkdir -p src/actions src/imports src/types

# Copy package files
COPY task-deps/package.json task-deps/tsconfig.json ./

# Install dependencies
RUN npm install

# Copy TypeScript source files to create the vulnerable application structure
# pollSubmitUserVote.vulnerable.ts -> src/actions/pollSubmitUserVote.ts
COPY task-deps/pollSubmitUserVote.vulnerable.ts ./src/actions/pollSubmitUserVote.ts

# validation.ts -> src/imports/validation.ts
COPY task-deps/validation.ts ./src/imports/validation.ts

# types.ts -> src/types/index.ts
COPY task-deps/types.ts ./src/types/index.ts

# ValidationError.ts -> src/types/ValidationError.ts
COPY task-deps/ValidationError.ts ./src/types/ValidationError.ts

# Keep the container running for testing
CMD ["tail", "-f", "/dev/null"]
