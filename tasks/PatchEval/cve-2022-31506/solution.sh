cat <<'EOF' > /workspace/fix.patch
diff --git a/opendiamond/dataretriever/diamond_store.py b/opendiamond/dataretriever/diamond_store.py
index 0bcb1160..27c75184 100644
--- a/opendiamond/dataretriever/diamond_store.py
+++ b/opendiamond/dataretriever/diamond_store.py
@@ -17,6 +17,7 @@
 from flask import Blueprint, url_for, Response, stream_with_context, send_file, \
     jsonify
 from werkzeug.datastructures import Headers
+from werkzeug.security import safe_join
 
 from opendiamond.dataretriever.util import ATTR_SUFFIX
 
@@ -120,11 +121,11 @@ def _get_object_src_uri(object_path):
 
 
 def _get_obj_absolute_path(obj_path):
-    return os.path.join(DATAROOT, obj_path)
+    return safe_join(DATAROOT, obj_path)
 
 
 def _get_index_absolute_path(index):
-    return os.path.join(INDEXDIR, index)
+    return safe_join(INDEXDIR, index)
 
 
 @scope_blueprint.route('/obj/<path:obj_path>')


EOF

cd /workspace/opendiamond
git apply --whitespace=nowarn  /workspace/fix.patch