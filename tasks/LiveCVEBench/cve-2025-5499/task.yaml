instruction: |-
  We have a PHP application with an image resizing feature at `image_resized.php`. Users
  can pass an image file path via the `imgfile` query parameter to get a resized version.

  Several users have reported concerning behavior with this endpoint:

  1. A security researcher on our team discovered they could access files outside the web
     directory by using paths like "../../../etc/passwd" in the imgfile parameter.

  2. Another team member noticed the application attempts to process unusual URL-like
     paths such as "phar://something" or "php://filter/..." instead of ignoring them.
     This seems dangerous and shouldn't be happening.

  3. When testing locally, we can see the application tries to open absolute paths
     like "/etc/passwd" when provided in the imgfile parameter.

  The application should only process image files within its own directory structure.
  Normal requests like "img/photo.jpg" should continue working, but anything that
  looks like it's trying to access files outside the application should be rejected.

  Please investigate `image_resized.php` and fix the input validation so that
  suspicious file paths are rejected before any file operations occur.

difficulty: medium
category: security
tags:
  - php
  - input-validation
  - path-traversal
  - stream-wrappers
parser_name: pytest

run_tests_in_same_shell: false
