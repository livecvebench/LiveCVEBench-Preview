FROM php:8.2-cli

WORKDIR /app

# System dependencies (tmux, asciinema, curl are required)
# libonig-dev is required for mbstring extension
RUN apt-get update && apt-get install -y \
    git \
    tmux \
    asciinema \
    curl \
    libonig-dev \
    gcc g++ wget \
    && rm -rf /var/lib/apt/lists/*

# Install required PHP extensions
RUN docker-php-ext-install mbstring

# Clone YesWiki at vulnerable version and remove git history
RUN git clone --branch v4.5.3 --depth 1 https://github.com/YesWiki/yeswiki.git . && \
    rm -rf .git

# Keep container running for tests
# CMD ["tail", "-f", "/dev/null"]
