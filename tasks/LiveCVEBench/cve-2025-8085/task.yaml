instruction: |-
  This is a WordPress site with the Ditty (News Ticker) plugin installed, which provides
  customizable content display widgets and tickers.

  Users are reporting that external parties can trigger outbound HTTP requests from our
  server through the plugin's REST API. When they send a POST request to the
  `/wp-json/dittyeditor/v1/displayItems` endpoint with specially crafted JSON data
  containing image URLs, the server fetches those URLs regardless of whether the
  request is authenticated.

  For example, a request like this triggers the issue:
  ```
  POST /wp-json/dittyeditor/v1/displayItems
  Content-Type: application/json

  {"apiData":{"layouts":[{"id":"test","html":"{image default_src=\"http://example.com/\"}","css":""}],"items":[{"item_id":"1","item_type":"default","item_value":{"content":"test"},"layout_value":{"default":"test"}}]}}
  ```

  The server makes HTTP requests to whatever URL is specified in the `default_src`
  attribute, which could be used to access internal services or scan internal networks.

  We need the API endpoints to properly verify that requests are coming from
  authenticated WordPress users with valid nonces before processing them. The endpoints
  that need protection are: `displayItems`, `phpItemMods`, and `dynamicLayoutTags`
  (the ones using `general_ditty_permissions_check`).

difficulty: medium
category: security
tags:
  - wordpress
  - plugin
  - php
  - api
  - authentication
parser_name: pytest

run_tests_in_same_shell: false
max_test_timeout_sec: 180.0
