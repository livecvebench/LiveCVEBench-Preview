# validator.js isLength() Unicode bypass reproduction
FROM node:18

WORKDIR /app

# Install system dependencies (tmux, asciinema, curl required, plus Python for tests)
RUN apt-get update && apt-get install -y \
    git \
    tmux \
    asciinema \
    curl \
    wget \
    gcc \
    g++ \
    python3 \
    python3-pip \
    python3-venv \
    && rm -rf /var/lib/apt/lists/*

# Create virtual environment for Python packages
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"

# Install pytest in the virtual environment
RUN pip install pytest

# Copy package.json for the vulnerable validator version
COPY task-deps/package.json /app/package.json

# Install the vulnerable validator package
RUN npm install

# Ensure files are writable for solution.sh to modify
RUN chmod -R 755 /app/node_modules

# Keep container running
# CMD ["tail", "-f", "/dev/null"]
