#!/bin/bash
set -e

cd /app/openfga

git apply --whitespace=nowarn /tests/test.patch

go test -timeout 30s -run ^TestCachedCheckResolver_FieldsInResponse$ github.com/openfga/openfga/internal/graph
go test -timeout 30s -run '^(TestResolveCheck_ConcurrentCachedReadsAndWrites|TestResolveCheckFromCache|TestBuildCacheKey|TestResolveCheckExpired|TestResolveCheckLastChangelogRecent)$' github.com/openfga/openfga/internal/graph