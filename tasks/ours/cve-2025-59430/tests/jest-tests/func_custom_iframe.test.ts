import { createLink } from '../Link'

jest.mock('@meshconnect/uwc-bridge-parent', () => ({
  BridgeParent: jest.fn().mockImplementation(() => ({
    destroy: jest.fn()
  }))
}))

const VALID_URL = Buffer.from('http://localhost/test').toString('base64')

describe('Functional: Custom Iframe ID', () => {
  beforeEach(() => {
    document.getElementsByTagName('html')[0].innerHTML = ''
  })

  test('createLink with custom iframe id should use that iframe', () => {
    const customIframeId = 'my-custom-iframe'
    const customIframe = document.createElement('iframe')
    customIframe.id = customIframeId
    document.body.appendChild(customIframe)

    const frontConnection = createLink({
      clientId: 'test',
      onIntegrationConnected: jest.fn(),
      language: 'en'
    })

    frontConnection.openLink(VALID_URL, customIframeId)

    // Default popup iframe should NOT be created
    const defaultIframe = document.getElementById('mesh-link-popup__iframe')
    expect(defaultIframe).toBeFalsy()

    // Custom iframe should have the src set
    expect(customIframe.attributes.getNamedItem('src')?.nodeValue).toBe('http://localhost/test?lng=en')
  })
})
