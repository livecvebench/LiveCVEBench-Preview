instruction: |-
  Authlib is a Python library for OAuth and OpenID Connect authentication. It provides
  JSON Web Signature (JWS) implementation for signing and verifying tokens.

  The JWS implementation does not properly validate the 'crit' (critical) header parameter
  according to RFC 7515 Section 4.1.11. When a JWS token contains a 'crit' header listing
  header parameters that the recipient must understand and process, the library fails to
  enforce these "must-understand" semantics.

  Current behavior:
  - Tokens with 'crit' headers listing unknown/unregistered header names are accepted
  - Tokens with 'crit' headers listing parameters not present in the protected header are accepted
  - No validation occurs for the 'crit' parameter during both serialization and deserialization

  Expected behavior (per RFC 7515 Section 4.1.11):
  - Recipients MUST understand and process every header parameter listed in 'crit'
  - If any listed parameter is unknown (not in registered or private headers), the token MUST be rejected
  - If any listed parameter is not present in the protected header, the token MUST be rejected
  - The 'crit' header MUST only appear in the protected (integrity-protected) header, not in unprotected headers

  For example, a token with header {"alg": "HS256", "crit": ["bork"], "bork": "value"} should be
  rejected because "bork" is not a registered or configured private header parameter. Similarly,
  a token with {"alg": "HS256", "crit": ["kid"]} should be rejected because "kid" is listed in
  crit but not actually present in the header.

difficulty: medium
category: bug-fix
tags:
  - python
  - jws
  - jwt
  - authentication
  - rfc-compliance
parser_name: pytest
