#!/bin/bash
# Entrypoint script for Starlette application
# Allows service restart for testing solution.sh

set -e

# Function to handle SIGTERM
cleanup() {
    echo "Received signal, cleaning up..."
    pkill -f "uvicorn" || true
    exit 0
}

trap cleanup SIGTERM SIGINT

while true; do
    echo "Starting Starlette application..."
    uvicorn main:app --host 0.0.0.0 --port 8000 &
    UVICORN_PID=$!

    # Wait for the process
    wait $UVICORN_PID
    EXIT_CODE=$?

    echo "Uvicorn exited with code $EXIT_CODE"

    # Small delay before restart
    sleep 1
done
