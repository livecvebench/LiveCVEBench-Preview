instruction: |-
  AstrBot is a large language model chatbot and development framework with a web
  dashboard interface running on port 6185.

  The `/api/chat/get_file` endpoint allows downloading files from the webchat images
  directory (`data/webchat/imgs/`). Users have reported that by manipulating the
  `filename` parameter, they can access files outside the intended directory.

  For example, a request like:
  ```
  GET /api/chat/get_file?filename=../../../data/cmd_config.json
  ```
  Returns the contents of `/app/data/cmd_config.json` instead of returning an error.

  Similarly, requests with paths like `../../../../../../../etc/passwd` return system
  files that should not be accessible.

  The expected behavior is that the endpoint should only serve files from within the
  designated images directory (`data/webchat/imgs/`). Any attempt to access files
  outside this directory using path traversal sequences (e.g., `../`) should be
  rejected with an appropriate error message.

  The fix should:
  - Sanitize the filename parameter to prevent directory traversal
  - Ensure requested files are within the allowed images directory
  - Return a clear error when an invalid file path is detected

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: security
tags:
  - path-traversal
  - input-validation
  - python
  - quart
  - web-api
parser_name: pytest

run_tests_in_same_shell: false
