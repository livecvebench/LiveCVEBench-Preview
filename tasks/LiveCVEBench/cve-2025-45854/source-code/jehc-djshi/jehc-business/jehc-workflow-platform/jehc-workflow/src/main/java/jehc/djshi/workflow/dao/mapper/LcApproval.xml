<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.workflow.dao.LcApprovalDao">

	<!--查询审批记录-->
	<select id="getLcApprovalList" resultType="jehc.djshi.workflow.model.LcApproval" parameterType="jehc.djshi.workflow.param.LcApprovalParam">
		SELECT
			id,
			title,
			proc_inst_id AS procInstId,
			task_def_key AS taskDefKey,
			proc_def_id AS procDefId,
			task_name AS taskName,
			behavior,
			behavior_text AS behaviorText,
			lc_apply_id AS lcApplyId,
			comment,
			task_id AS taskId,
			user_id AS userId,
			create_id AS createId,
			update_id AS updateId,
			create_time AS createTime,
			update_time AS updateTime,
			business_key AS businessKey
		FROM
			lc_approval lc_approval
		WHERE 1=1
			AND lc_approval.del_flag = 0
			<if test="null != instanceId">
				AND lc_approval.proc_inst_id IN
				<foreach item="item" index="index" collection="instanceId.split(',')" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			<if test="null != behavior">
				AND lc_approval.behavior = #{behavior}
			</if>
			<if test="null != lcApplyId">
				AND lc_approval.lc_apply_id = #{lcApplyId}
			</if>
			<if test="null != userId">
				AND lc_approval.user_id = #{userId}
			</if>
			<if test="null != businessKey">
				AND lc_approval.business_key = #{businessKey}
			</if>
			<if test="null != taskId">
				AND lc_approval.task_id = #{taskId}
			</if>
			<if test="null != taskName">
				AND lc_approval.task_name LIKE CONCAT(CONCAT('%',#{taskName}),'%')
			</if>
			<if test="null != taskDefKey">
				AND lc_approval.task_def_key = #{taskDefKey}
			</if>
			<if test="null != procDefId">
				AND lc_approval.proc_def_id = #{procDefId}
			</if>
			ORDER BY create_time DESC
	</select>

	<!--初始化分页-->
	<select id="getLcApprovalListByCondition" resultType="jehc.djshi.workflow.model.LcApproval" parameterType="map">
		SELECT
			id,
			title,
			proc_inst_id AS procInstId,
			task_def_key AS taskDefKey,
			proc_def_id AS procDefId,
			task_name AS taskName,
			behavior,
			behavior_text AS behaviorText,
			lc_apply_id AS lcApplyId,
			comment,
			task_id AS taskId,
			user_id AS userId,
			create_id AS createId,
			update_id AS updateId,
			create_time AS createTime,
			update_time AS updateTime,
			business_key AS businessKey
		FROM
			lc_approval lc_approval
		WHERE 1=1
			AND lc_approval.del_flag = 0
			<if test="null != instanceId">
				AND lc_approval.proc_inst_id IN
				<foreach item="item" index="index" collection="instanceId.split(',')" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			<if test="null != behavior">
				AND lc_approval.behavior = #{behavior}
			</if>
			<if test="null != lcApplyId">
				AND lc_approval.lc_apply_id = #{lcApplyId}
			</if>
			<if test="null != userId">
				AND lc_approval.user_id = #{userId}
			</if>
			<if test="null != businessKey">
				AND lc_approval.business_key = #{businessKey}
			</if>
			<if test="null != taskId">
				AND lc_approval.task_id = #{taskId}
			</if>
			<if test="null != taskName">
				AND lc_approval.task_name LIKE CONCAT(CONCAT('%',#{taskName}),'%')
			</if>
			<if test="null != taskDefKey">
				AND lc_approval.task_def_key = #{taskDefKey}
			</if>
			<if test="null != procDefId">
				AND lc_approval.proc_def_id = #{procDefId}
			</if>
			ORDER BY create_time DESC
	</select>

	<!--查询对象-->
	<select id="getLcApprovalById" resultType="jehc.djshi.workflow.model.LcApproval" parameterType="string">
		SELECT
			id,
			title,
			proc_inst_id AS procInstId,
			task_def_key AS taskDefKey,
			proc_def_id AS procDefId,
			task_name AS taskName,
			behavior,
			behavior_text AS behaviorText,
			lc_apply_id AS lcApplyId,
			comment,
			task_id AS taskId,
			user_id AS userId,
			create_id AS createId,
			update_id AS updateId,
			create_time AS createTime,
			update_time AS updateTime,
			business_key AS businessKey
		FROM
			lc_approval lc_approval
		WHERE lc_approval.id=#{id}
	</select>

	<!--添加-->
	<insert id="addLcApproval" parameterType="jehc.djshi.workflow.model.LcApproval">
		INSERT INTO
			lc_approval
		(
			id,
			title,
			proc_inst_id,
			task_def_key,
			proc_def_id,
			task_name,
			behavior,
			behavior_text,
			lc_apply_id,
			comment,
			task_id,
			user_id,
			create_id,
			update_id,
			del_flag,
			create_time,
			update_time,
			business_key
		)
		VALUES
		(
			#{id},
			#{title},
			#{procInstId},
			#{taskDefKey},
			#{procDefId},
			#{taskName},
			#{behavior},
			#{behaviorText},
			#{lcApplyId},
			#{comment},
			#{taskId},
			#{userId},
			#{createId},
			#{updateId},
			0,
			#{createTime},
			#{updateTime},
			#{businessKey}
		)
	</insert>

	<!--删除-->
	<delete id="delLcApproval" parameterType="map">
		UPDATE lc_approval SET del_flag = 1 WHERE id IN
		<foreach item="item" index="index" collection="id" open="(" separator="," close=")">
			#{item}
		</foreach>
	</delete>

	<!--根据业务Key批量删除-->
	<delete id="delLcApprovalByBusinessKey" parameterType="map">
		UPDATE lc_approval SET del_flag = 1 WHERE business_key IN
		<foreach item="item" index="index" collection="businessKey" open="(" separator="," close=")">
			#{item}
		</foreach>
	</delete>
</mapper>