cat <<'EOF' > /workspace/fix.patch
diff --git a/core/hoverfly_funcs.go b/core/hoverfly_funcs.go
index 181d2f135..776ab79fd 100644
--- a/core/hoverfly_funcs.go
+++ b/core/hoverfly_funcs.go
@@ -2,8 +2,8 @@ package hoverfly
 
 import (
 	"fmt"
-	"io/ioutil"
 	"net/http"
+	"os"
 	"path/filepath"
 	"strings"
 
@@ -188,7 +188,12 @@ func (hf *Hoverfly) readResponseBodyFile(filePath string) (string, error) {
 		return "", fmt.Errorf("bodyFile contains absolute path (%s). only relative is supported", filePath)
 	}
 
-	fileContents, err := ioutil.ReadFile(filepath.Join(hf.Cfg.ResponsesBodyFilesPath, filePath))
+	resolvedPath, err := util.ResolveAndValidatePath(hf.Cfg.ResponsesBodyFilesPath, filePath)
+	if err != nil {
+		return "", err
+	}
+
+	fileContents, err := os.ReadFile(resolvedPath)
 	if err != nil {
 		return "", err
 	}
diff --git a/core/util/util.go b/core/util/util.go
index 5493c60d2..e5eb537da 100644
--- a/core/util/util.go
+++ b/core/util/util.go
@@ -17,6 +17,7 @@ import (
 	"math/rand"
 	"net/http"
 	"net/url"
+	"path/filepath"
 	"reflect"
 	"regexp"
 	"sort"
@@ -517,11 +518,31 @@ func NeedsEncoding(headers map[string][]string, body string) bool {
 	return needsEncoding
 }
 
-func IsJsonData(data string) bool {
-	var jsonData map[string]interface{}
-	if err := json.Unmarshal([]byte(data), &jsonData); err == nil {
-		return true
-	} else {
-		return false
+// Resolves a relative path from basePath, and fails if the relative path starts with ".."
+func ResolveAndValidatePath(basePath, relativePath string) (string, error) {
+	absBasePath, err := filepath.Abs(basePath)
+	if err != nil {
+		return "", fmt.Errorf("failed to get absolute base path: %v", err)
 	}
+
+	cleanRelativePath := filepath.Clean(relativePath)
+
+	// Check if the relative path starts with ".."
+	if strings.HasPrefix(cleanRelativePath, "..") {
+		return "", fmt.Errorf("relative path is invalid as it attempts to backtrack")
+	}
+
+	resolvedPath := filepath.Join(absBasePath, cleanRelativePath)
+
+	// Verify that the resolved path is indeed a subpath of the base path
+	finalPath, err := filepath.Rel(absBasePath, resolvedPath)
+	if err != nil {
+		return "", fmt.Errorf("failed to get relative path: %v", err)
+	}
+
+	if strings.HasPrefix(finalPath, "..") {
+		return "", fmt.Errorf("resolved path is outside the base path")
+	}
+
+	return resolvedPath, nil
 }


EOF

cd /workspace/hoverfly
git apply --whitespace=nowarn  /workspace/fix.patch