#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2021-3583:latest
# bash /workspace/fix-run.sh
set -e

cd /workspace/ansible
git apply --whitespace=nowarn /tests/test.patch 
PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook test/integration/targets/template/unsafe.yml -v

cd /workspace
#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2021-3583:latest
# bash /workspace/unit_test.sh
set -e

cd /workspace/ansible
# PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook test/integration/targets/template/72262.yml test/integration/targets/template/6653.yml test/integration/targets/template/72615.yml -v
cd test/integration/targets/template/
# Test for several corner cases #57188
PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook corner_cases.yml -v "$@"

# Test for #57351
PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook filter_plugins.yml -v "$@"

# https://github.com/ansible/ansible/issues/68699
PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook unused_vars_include.yml -v "$@"

# https://github.com/ansible/ansible/issues/55152
PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook undefined_var_info.yml -v "$@"

# https://github.com/ansible/ansible/issues/72615
PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook 72615.yml -v "$@"

# https://github.com/ansible/ansible/issues/6653
PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook 6653.yml -v "$@"

# https://github.com/ansible/ansible/issues/72262
PYTHONPATH=./lib /workspace/PoC_env/CVE-2021-3583/bin/ansible-playbook 72262.yml -v "$@"