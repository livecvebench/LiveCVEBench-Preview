<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.workflow.dao.LcProcessDao">
	<!--初始化分页-->
	<select id="getLcProcessListByCondition" resultType="jehc.djshi.workflow.model.LcProcess" parameterType="map">
		SELECT
			lc_process.id,
			lc_process.path,
			lc_process.uid,
			lc_process.uk,
-- 			lc_process.bpmn,
			lc_process.title,
			lc_process.bpmn_path AS bpmnPath,
			lc_process.img_path AS imgPath,
			lc_process.status,
-- 			lc_process.mxgraph_xml AS mxgraphXml,
			lc_process.mxgraph_style AS mxgraphStyle,
			lc_process.flag,
			lc_process.attachment_id AS attachmentId,
			lc_process.remark,
			lc_process.version,
			lc_process.lc_product_id AS lcProductId,
			lc_process.lc_group_id AS lcGroupId,
			lc_product.name,
			lc_group.name AS groupName,
-- 			lc_process.img_xml AS imgXml,
			lc_process.w,
			lc_process.h,
			lc_process.del_flag AS delFlag,
			lc_process.create_time AS createTime,
			lc_process.update_time AS updateTime,
			lc_process.create_id AS createId,
			lc_process.update_id AS updateId,
			lc_process.module_key AS moduleKey,
			lc_process.candidate_group_type AS candidateGroupType,
			lc_process.candidate_starter_users AS candidateStarterUsers,
			lc_process.candidate_starter_groups AS candidateStarterGroups
		FROM 
			lc_process lc_process LEFT JOIN lc_product lc_product ON lc_process.lc_product_id = lc_product.id
			LEFT JOIN lc_group lc_group ON lc_process.lc_group_id = lc_group.id
		WHERE 1=1
			<if test="null != title">
				AND instr(lc_process.title,#{title})
			</if>
			<if test="null != status">
				AND lc_process.status = #{status}
			</if>
			<if test="null != flag">
				AND lc_process.flag = #{flag}
			</if>
			<if test="null != remark">
				AND instr(lc_process.remark,#{remark})
			</if>
			<if test="null != lcProductId">
				AND lc_process.lc_product_id = #{lcProductId}
			</if>
			<if test="null != moduleKey">
				AND lc_process.module_key = #{moduleKey}
			</if>
-- 			AND lc_process.del_flag = 0
			ORDER BY lc_process.update_time DESC,lc_process.create_time DESC
	</select>

	<!--查询对象-->
	<select id="getLcProcessById" resultType="jehc.djshi.workflow.model.LcProcess" parameterType="string">
		SELECT
			lc_process.id,
			lc_process.path,
			lc_process.uid,
			lc_process.uk,
			lc_process.bpmn,
			lc_process.title,
			lc_process.bpmn_path AS bpmnPath,
			lc_process.img_path AS imgPath,
			lc_process.status,
			lc_process.mxgraph_xml AS mxgraphXml,
			lc_process.mxgraph_style AS mxgraphStyle,
			lc_process.flag ,
			lc_process.attachment_id AS attachmentId,
			lc_process.remark,
			lc_process.version,
			lc_process.lc_product_id AS lcProductId,
			lc_process.lc_group_id AS lcGroupId,
			lc_product.name,
			lc_group.name AS groupName,
			lc_process.img_xml AS imgXml,
			lc_process.w,
			lc_process.h,
			lc_process.del_flag AS delFlag,
			lc_process.create_time AS createTime,
			lc_process.update_time AS updateTime,
			lc_process.create_id AS createId,
			lc_process.update_id AS updateId,
			lc_process.module_key AS moduleKey,
			lc_process.candidate_group_type AS candidateGroupType,
			lc_process.candidate_starter_users AS candidateStarterUsers,
			lc_process.candidate_starter_groups AS candidateStarterGroups
		FROM
			lc_process lc_process LEFT JOIN lc_product lc_product ON lc_process.lc_product_id = lc_product.id
			LEFT JOIN lc_group lc_group ON lc_process.lc_group_id = lc_group.id
		WHERE lc_process.id=#{id}
	</select>

	<!--添加-->
	<insert id="addLcProcess" parameterType="jehc.djshi.workflow.model.LcProcess">
		INSERT INTO
			lc_process
			(
			id,
			path,
			uid,
			uk,
			bpmn,
			title,
			bpmn_path,
			img_path,
			status,
			mxgraph_xml,
			mxgraph_style,
			flag,
			attachment_id,
			remark,
			version,
			lc_product_id,
			lc_group_id,
			img_xml,
			w,
			h,
			create_id,
			update_id,
			create_time,
			update_time,
			module_key,
			candidate_group_type,
			candidate_starter_users,
			candidate_starter_groups
			)
			VALUES
			(
			#{id},
			#{path},
			#{uid},
			#{uk},
			#{bpmn},
			#{title},
			#{bpmnPath},
			#{imgPath},
			#{status},
			#{mxgraphXml},
			#{mxgraphStyle},
			#{flag},
			#{attachmentId},
			#{remark},
			#{version},
			#{lcProductId},
			#{lcGroupId},
			#{imgXml},
			#{w},
			#{h},
			#{createId},
			#{updateId},
			#{createTime},
			#{updateTime},
			#{moduleKey},
			#{candidateGroupType},
			#{candidateStarterUsers},
			#{candidateStarterGroups}
			)
	</insert>

	<!--修改-->
	<update id="updateLcProcess" parameterType="jehc.djshi.workflow.model.LcProcess">
		UPDATE
			lc_process
		<set>
			<if test="path != null">
				path = #{path},
			</if>
			<if test="uid != null">
				uid = #{uid},
			</if>
			<if test="uk != null">
				uk = #{uk},
			</if>
			<if test="bpmn != null">
				bpmn = #{bpmn},
			</if>
			<if test="title != null">
				title = #{title},
			</if>
			<if test="bpmnPath != null">
				bpmn_path = #{bpmnPath},
			</if>
			<if test="imgPath != null">
				img_path = #{imgPath},
			</if>
			<if test="status != null">
				status = #{status},
			</if>
			<if test="mxgraphXml != null">
				mxgraph_xml = #{mxgraphXml},
			</if>
			<if test="mxgraphStyle != null">
				mxgraph_style = #{mxgraphStyle},
			</if>
			<if test="flag != null">
				flag = #{flag},
			</if>
			<if test="attachmentId != null">
				attachment_id = #{attachmentId},
			</if>
			<if test="remark != null">
				remark = #{remark},
			</if>
			<if test="version != null">
				version = #{version},
			</if>
			<if test="lcProductId != null">
				lc_product_id = #{lcProductId},
			</if>
			<if test="lcGroupId != null">
				lc_group_id = #{lcGroupId},
			</if>
			<if test="imgXml != null">
				img_xml = #{imgXml},
			</if>
			<if test="w != null">
				w = #{w},
			</if>
			<if test="h != null">
				h = #{h},
			</if>
			<if test="updateId != null">
				update_id = #{updateId},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime},
			</if>
			<if test="moduleKey != null">
				module_key = #{moduleKey},
			</if>
			<if test="candidateGroupType != null">
				candidate_group_type = #{candidateGroupType},
			</if>
			<if test="candidateStarterUsers != null">
				candidate_starter_users = #{candidateStarterUsers},
			</if>
			<if test="candidateStarterGroups != null">
				candidate_starter_groups = #{candidateStarterGroups},
			</if>
		</set>
		WHERE id=#{id}
	</update>

	<!--删除-->
	<update id="delLcProcess" parameterType="map">
		UPDATE lc_process SET del_flag = 1 WHERE id IN
		<foreach item="item" index="index" collection="id" open="(" separator="," close=")">
			#{item}
		</foreach>
	</update>

	<!-- 发布或关闭流程 -->
	<update id="updateLcProcessStatus" parameterType="map">
		UPDATE
			lc_process
		SET
			status = #{status},update_id = #{updateId},
		    update_time = #{updateTime}
		WHERE id=#{id}
	</update>

	<!--根据流程模块Key查找流程定义-->
	<select id="getLcProcessByModuleKey" resultType="jehc.djshi.workflow.model.LcProcess" parameterType="string">
		SELECT
			id,
			module_key AS moduleKey
		FROM
			lc_process
		WHERE module_key=#{moduleKey}
	</select>
</mapper>