FROM php:8.0-apache

# Install required system packages and PHP extensions
RUN apt-get update && \
    apt-get install -y git tmux asciinema curl default-mysql-client gcc g++ wget && \
    docker-php-ext-install mysqli && \
    rm -rf /var/lib/apt/lists/*

# Enable Apache mod_rewrite (useful for PHP apps)
RUN a2enmod rewrite

# Copy application files to document root (using JSON format for path with space)
COPY ["task-deps/onl shoe/", "/var/www/html/"]

# Copy modified dbconn.php for Docker environment
COPY ["task-deps/dbconn_docker.php", "/var/www/html/db/dbconn.php"]

# Set proper permissions
RUN chown -R www-data:www-data /var/www/html && \
    chmod -R 755 /var/www/html && \
    chmod -R 777 /var/www/html/photo

# Configure PHP error display for debugging (helpful for SQL injection testing)
COPY task-deps/docker-php-errors.ini /usr/local/etc/php/conf.d/docker-php-errors.ini


# CMD ["apache2-foreground"]
