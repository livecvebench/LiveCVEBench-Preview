#!/bin/bash
# Entrypoint script that keeps the container running and allows service restarts
# The service is wrapped in a loop so solution.sh can kill and restart it

# Signal handler for graceful shutdown
trap 'echo "Shutting down..."; kill $PID 2>/dev/null; exit 0' SIGTERM SIGINT

while true; do
    echo "Starting BentoML service..."
    bentoml serve service:FileProcessor --port 3000 --host 0.0.0.0 &
    PID=$!

    # Wait for the process to exit
    wait $PID
    EXIT_CODE=$?

    echo "BentoML service exited with code $EXIT_CODE"

    # Small delay before restart to avoid rapid restart loops
    sleep 1
done
