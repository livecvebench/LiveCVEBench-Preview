instruction: |-
  This is a ThinkPHP-based web application that provides a Central Authentication
  Service with a widget controller for dynamically loading UI components.

  The widget controller (`/index.php/auth/widget`) accepts parameters to specify
  which widget layer, component, and action to render. However, users have reported
  that sending certain malformed requests to this endpoint causes the application
  to behave unexpectedly - sometimes returning internal error messages, executing
  unintended code paths, or exposing system information.

  For example, when requests contain special characters like backslashes in the
  `get.layer` or `get.widget` parameters (e.g., `get.layer=\think\app`), the
  application fails to reject them and may attempt to load arbitrary classes or
  execute unintended methods.

  The expected behavior is that the widget controller should only accept valid,
  predefined widget names and reject any requests with invalid or suspicious
  parameter values. The application should validate all input parameters against
  an allowlist and return appropriate error responses for invalid requests.

  Fix the widget controller to properly validate the `get.layer`, `get.widget`,
  and `get.action` parameters before using them.

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: security
tags:
  - php
  - thinkphp
  - input-validation
  - code-injection
parser_name: pytest

run_tests_in_same_shell: false
