#!/bin/bash

# Wait for MySQL to be ready
echo "Waiting for MySQL..."
while ! mysqladmin ping -h db -u root -premoteclinic --silent 2>/dev/null; do
    sleep 2
done
echo "MySQL is ready!"

# Import database schema if not already imported
mysql -h db -u root -premoteclinic remoteclinic -e "SELECT 1 FROM p_logins LIMIT 1" 2>/dev/null
if [ $? -ne 0 ]; then
    echo "Importing database schema..."
    mysql -h db -u root -premoteclinic remoteclinic < /var/www/html/remoteclinic.sql
    echo "Database imported!"
else
    echo "Database already initialized."
fi

# Start Apache in foreground
echo "Starting Apache..."
apache2-foreground
