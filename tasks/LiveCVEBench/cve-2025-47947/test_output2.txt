==========================================
ModSecurity Test Suite
==========================================
Installing uv package manager...
no checksums to verify
installing to /root/.local/bin
  uv
  uvx
everything's installed!

To add $HOME/.local/bin to your PATH, either restart your shell or run:

    source $HOME/.local/bin/env (sh, bash, zsh)
    source $HOME/.local/bin/env.fish (fish)
Initializing test environment...
Installing test dependencies...
Waiting for server to be ready...
Server is ready!

==========================================
Running Tests
==========================================
Target URL: http://localhost

============================= test session starts ==============================
platform linux -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0 -- /tests/.venv/bin/python
cachedir: .pytest_cache
rootdir: /tests
configfile: pyproject.toml
collecting ... collected 18 items

test_func.py::TestModSecurityBasicFunctionality::test_basic_get_request PASSED [  5%]
test_func.py::TestModSecurityBasicFunctionality::test_basic_post_request PASSED [ 11%]
test_func.py::TestModSecurityBasicFunctionality::test_json_content_type_accepted PASSED [ 16%]
test_func.py::TestModSecurityBasicFunctionality::test_small_json_array_processed PASSED [ 22%]
test_func.py::TestModSecurityBasicFunctionality::test_json_object_processed PASSED [ 27%]
test_func.py::TestModSecurityFormData::test_url_encoded_form_data PASSED [ 33%]
test_func.py::TestModSecurityFormData::test_multipart_form_data PASSED   [ 38%]
test_func.py::TestModSecurityRuleProcessing::test_rules_engine_active PASSED [ 44%]
test_func.py::TestModSecurityRuleProcessing::test_multiple_json_fields PASSED [ 50%]
test_func.py::TestModSecurityRuleProcessing::test_nested_json_structure PASSED [ 55%]
test_vuln.py::TestSanitizationEntryCount::test_sanitization_entry_count_linear FAILED [ 61%]
test_vuln.py::TestSanitizationEntryCount::test_larger_array_scaling PASSED [ 66%]
test_vuln.py::TestSanitizationEntryCount::test_growth_ratio PASSED       [ 72%]
test_vuln.py::TestVulnerabilityDetection::test_duplicate_warnings_per_request FAILED [ 77%]
test_vuln.py::TestVulnerabilityDetection::test_multiple_arrays_scaling FAILED [ 83%]
test_vuln.py::TestBasicFunctionality::test_server_responds PASSED        [ 88%]
test_vuln.py::TestBasicFunctionality::test_json_accepted PASSED          [ 94%]
test_vuln.py::TestBasicFunctionality::test_small_array_works PASSED      [100%]

=================================== FAILURES ===================================
_______ TestSanitizationEntryCount.test_sanitization_entry_count_linear ________
test_vuln.py:152: in test_sanitization_entry_count_linear
    assert entry_count < max_expected, \
E   AssertionError: Too many sanitization entries: 200 (expected < 150). This indicates O(nÂ²) behavior from CVE-2025-47947 vulnerability.
E   assert 200 < 150
________ TestVulnerabilityDetection.test_duplicate_warnings_per_request ________
test_vuln.py:256: in test_duplicate_warnings_per_request
    assert total_warnings < max_expected, \
E   AssertionError: Detected 120 warning entries for 30 elements. Expected < 120. Excessive duplicates indicate vulnerability.
E   assert 120 < 120
___________ TestVulnerabilityDetection.test_multiple_arrays_scaling ____________
test_vuln.py:284: in test_multiple_arrays_scaling
    assert entry_count < max_expected, \
E   AssertionError: Multiple arrays produced 360 entries for 90 elements. Expected linear scaling, got excessive duplicates.
E   assert 360 < 360
==================================== PASSES ====================================
=========================== short test summary info ============================
PASSED test_func.py::TestModSecurityBasicFunctionality::test_basic_get_request
PASSED test_func.py::TestModSecurityBasicFunctionality::test_basic_post_request
PASSED test_func.py::TestModSecurityBasicFunctionality::test_json_content_type_accepted
PASSED test_func.py::TestModSecurityBasicFunctionality::test_small_json_array_processed
PASSED test_func.py::TestModSecurityBasicFunctionality::test_json_object_processed
PASSED test_func.py::TestModSecurityFormData::test_url_encoded_form_data
PASSED test_func.py::TestModSecurityFormData::test_multipart_form_data
PASSED test_func.py::TestModSecurityRuleProcessing::test_rules_engine_active
PASSED test_func.py::TestModSecurityRuleProcessing::test_multiple_json_fields
PASSED test_func.py::TestModSecurityRuleProcessing::test_nested_json_structure
PASSED test_vuln.py::TestSanitizationEntryCount::test_larger_array_scaling
PASSED test_vuln.py::TestSanitizationEntryCount::test_growth_ratio
PASSED test_vuln.py::TestBasicFunctionality::test_server_responds
PASSED test_vuln.py::TestBasicFunctionality::test_json_accepted
PASSED test_vuln.py::TestBasicFunctionality::test_small_array_works
FAILED test_vuln.py::TestSanitizationEntryCount::test_sanitization_entry_count_linear
FAILED test_vuln.py::TestVulnerabilityDetection::test_duplicate_warnings_per_request
FAILED test_vuln.py::TestVulnerabilityDetection::test_multiple_arrays_scaling
======================== 3 failed, 15 passed in 17.88s =========================
