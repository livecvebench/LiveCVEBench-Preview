#!/bin/bash
set -e
cd "$(dirname "$0")"

echo "=== Installing test dependencies ==="
curl -LsSf https://astral.sh/uv/0.7.13/install.sh | sh 2>/dev/null
source $HOME/.local/bin/env
uv init 2>/dev/null || true
uv add pytest 2>/dev/null

echo ""
echo "=== Verifying package is built ==="
if [ ! -f /app/packages/css-to-react-native/dist/index.js ]; then
    echo "ERROR: dist/index.js not found. Package needs to be built."
    echo "Running build..."
    cd /app/packages/css-to-react-native
    npm run build
    cd "$(dirname "$0")"
fi

echo ""
echo "=== Running tests ==="
uv run pytest . -rA
