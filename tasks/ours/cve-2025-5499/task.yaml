instruction: |-
  This application is phpwcms, a PHP content management system that includes an
  image resizing service at image_resized.php. The endpoint accepts image file
  paths via the "imgfile" GET parameter and returns resized images.

  Users report that the image_resized.php script allows unintended file path
  handling. When certain special paths are passed to the "imgfile" parameter
  (such as paths starting with "..", "/", or containing protocol prefixes like
  "phar://" or "php://"), the script attempts to process them instead of
  rejecting them outright.

  For example:
  - Passing "imgfile=../../../etc/passwd" causes the script to attempt to read
    that path instead of limiting access to valid image directories.
  - Passing "imgfile=phar://some/path" or "imgfile=php://filter/resource=file"
    is processed by PHP file functions instead of being rejected.

  The current sanitization only removes "http://" and "https://" prefixes using
  str_replace(), which is insufficient. We need comprehensive path validation
  that:
  - Rejects paths starting with ".", "/", or "\"
  - Rejects any path containing protocol handlers (anything with ":/")
  - Restricts file access to the application's current directory only

  Expected behavior: The script should reject any path that could access files
  outside the application's intended image directories and return an "Image Error"
  response for invalid paths.

difficulty: medium
category: bug-fix
tags:
  - php
  - input-validation
  - path-handling
  - file-access
parser_name: pytest

run_tests_in_same_shell: false
