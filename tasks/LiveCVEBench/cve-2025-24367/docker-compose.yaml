# services:
#   db:
#     image: mariadb:10.6
#     container_name: cacti-cve-2025-24367-db
#     environment:
#       MYSQL_ROOT_PASSWORD: rootpassword
#       MYSQL_DATABASE: cacti
#       MYSQL_USER: cacti
#       MYSQL_PASSWORD: cactipassword
#     command: >
#       --character-set-server=utf8mb4
#       --collation-server=utf8mb4_unicode_ci
#       --max_allowed_packet=64M
#       --innodb_buffer_pool_size=256M
#     healthcheck:
#       test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
#       interval: 10s
#       timeout: 5s
#       retries: 10
#       start_period: 30s
#     volumes:
#       - db_data:/var/lib/mysql
#     networks:
#       - cacti-network

  # cacti:
  #   build: .
  #   container_name: cacti-cve-2025-24367-app
  #   depends_on:
  #     db:
  #       condition: service_healthy
  #   networks:
  #     - cacti-network

services:
  client:
    build:
      dockerfile: Dockerfile
    image: ${T_BENCH_TASK_DOCKER_CLIENT_IMAGE_NAME}
    container_name: ${T_BENCH_TASK_DOCKER_CLIENT_CONTAINER_NAME}
    command: ["/entrypoint.sh"]
    environment:
      - TEST_DIR=${T_BENCH_TEST_DIR}
    depends_on:
      db:
        condition: service_healthy
    volumes:
      - ${T_BENCH_TASK_LOGS_PATH}:${T_BENCH_CONTAINER_LOGS_PATH}
      - ${T_BENCH_TASK_AGENT_LOGS_PATH}:${T_BENCH_CONTAINER_AGENT_LOGS_PATH}
    networks:
      - cacti-network
  db:
    image: mariadb:10.6
    container_name: ${T_BENCH_TASK_DOCKER_CLIENT_CONTAINER_NAME}-cacti-cve-2025-24367-db
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: cacti
      MYSQL_USER: cacti
      MYSQL_PASSWORD: cactipassword
    command: >
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
      --max_allowed_packet=64M
      --innodb_buffer_pool_size=256M
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - cacti-network

volumes:
  db_data:

networks:
  cacti-network:
    driver: bridge
