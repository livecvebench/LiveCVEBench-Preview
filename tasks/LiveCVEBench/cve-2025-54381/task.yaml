instruction: |-
  This application is a BentoML service that processes uploaded files. The service
  allows users to submit files either by uploading them directly or by providing
  a URL from which the application will download the file server-side.

  We've discovered that when users submit URLs for file downloads, the application
  makes requests to any URL without any validation. This has caused several issues:

  1. When users accidentally submit internal network addresses (like http://10.0.0.1/
     or http://192.168.1.1/), the server attempts to connect to those internal
     resources, causing network connectivity errors and timeouts.

  2. Users have reported that submitting localhost URLs (http://127.0.0.1:8080/ or
     http://localhost/) causes the server to connect back to itself, leading to
     unexpected behavior and potential resource loops.

  3. Cloud deployments have experienced issues where URLs pointing to cloud metadata
     endpoints (like http://169.254.169.254/) are being processed, which should
     never be accessible from user requests.

  The expected behavior is that the URL download feature should only allow
  fetching files from public internet addresses. The application should reject
  URLs that point to:
  - Localhost addresses (127.0.0.1, localhost, ::1)
  - Private IP ranges (10.x.x.x, 172.16.x.x-172.31.x.x, 192.168.x.x)
  - Link-local addresses (169.254.x.x)
  - Any hostname that resolves to the above IP ranges

  Please implement URL validation to prevent the server from making requests to
  internal or private network addresses.

difficulty: medium
category: bug-fix
tags:
  - python
  - networking
  - validation
  - url-handling
parser_name: pytest

run_tests_in_same_shell: false
