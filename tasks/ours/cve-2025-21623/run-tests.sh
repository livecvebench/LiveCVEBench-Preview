#!/bin/bash
set -e
cd "$(dirname "$0")"

# Use system Python packages (already installed in container)
# No need to install uv - pytest, requests, and mysql-connector-python are available

# Set default environment variables if not provided
export APP_URL="${APP_URL:-http://localhost}"
export DB_HOST="${DB_HOST:-db}"
export DB_USER="${DB_USER:-clipbucket}"
export DB_PASS="${DB_PASS:-clipbucket}"
export DB_NAME="${DB_NAME:-clipbucket}"

# Debug: Print environment variables
echo "Environment variables:"
echo "APP_URL: $APP_URL"
echo "DB_HOST: $DB_HOST"
echo "DB_USER: $DB_USER"
echo "DB_NAME: $DB_NAME"

# Run pytest with verbose output and environment variables
exec env APP_URL="$APP_URL" DB_HOST="$DB_HOST" DB_USER="$DB_USER" DB_PASS="$DB_PASS" DB_NAME="$DB_NAME" python3 -m pytest . -rA -v
