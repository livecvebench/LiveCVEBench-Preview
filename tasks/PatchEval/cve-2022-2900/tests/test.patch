diff --git a/test/index.js b/test/index.js
index 1a50435..04caca5 100644
--- a/test/index.js
+++ b/test/index.js
@@ -17,6 +17,7 @@ const INPUTS = [
           , hash: ""
           , search: ""
           , query: {}
+          , parse_failed: false
         }
     ]
   , [
@@ -32,6 +33,7 @@ const INPUTS = [
           , hash: ""
           , search: ""
           , query: {}
+          , parse_failed: false
         }
     ]
   , [
@@ -47,6 +49,7 @@ const INPUTS = [
           , hash: "some-hash?foo=bar"
           , search: ""
           , query: {}
+          , parse_failed: false
         }
     ]
   , [
@@ -62,6 +65,7 @@ const INPUTS = [
           , hash: ""
           , search: ""
           , query: {}
+          , parse_failed: false
         }
     ]
   , [
@@ -77,6 +81,7 @@ const INPUTS = [
           , hash: ""
           , search: ""
           , query: {}
+          , parse_failed: false
         }
     ]
   , [
@@ -92,6 +97,7 @@ const INPUTS = [
           , hash: ""
           , search: ""
           , query: {}
+          , parse_failed: false
         }
     ]
   , [
@@ -107,22 +113,24 @@ const INPUTS = [
           , hash: "http://a:1:1"
           , search: ""
           , query: {}
+          , parse_failed: false
         }
     ]
   , [
         ["git@github.my-enterprise.com:my-org/my-repo.git", false],
         {
             protocols: [ 'ssh' ]
-            , protocol: 'ssh'
-            , port: ''
-            , resource: 'github.my-enterprise.com'
-            , host: 'github.my-enterprise.com'
-            , user: 'git'
-            , password: ''
-            , pathname: '/my-org/my-repo.git'
-            , hash: ''
-            , search: ''
-            , query: {}
+          , protocol: 'ssh'
+          , port: ''
+          , resource: 'github.my-enterprise.com'
+          , host: 'github.my-enterprise.com'
+          , user: 'git'
+          , password: ''
+          , pathname: '/my-org/my-repo.git'
+          , hash: ''
+          , search: ''
+          , query: {}
+          , parse_failed: false
         }
     ]
   , [
@@ -138,31 +146,65 @@ const INPUTS = [
         , hash: ""
         , search: ""
         , query: {}
+        , parse_failed: false
       }
   ]
 ];
 
+let failedTests = 0;
+
+function safeExpect(expectFn, label) {
+    try {
+        expectFn();
+    } catch (err) {
+        failedTests++;
+        console.error(`Test failed: ${label}\n`, err.message || err);
+    }
+}
+
 tester.describe("check urls", test => {
     INPUTS.forEach(function (c) {
-        let url = Array.isArray(c[0]) ? c[0][0] : c[0]
+        let url = Array.isArray(c[0]) ? c[0][0] : c[0];
         test.should("support " + url, () => {
-            const res = parseUrl(url, c[0][1] !== false);
+            safeExpect(() => {
+                const res = parseUrl(url, c[0][1] !== false);
 
-            if (c[0][1] !== false) {
-                url = normalizeUrl(url, {
-                    stripHash: false
-                })
-            }
+                if (c[0][1] !== false) {
+                    url = normalizeUrl(url, {
+                        stripHash: false
+                    });
+                }
 
-            c[1].href = c[1].href || url
-            c[1].password = c[1].password || ""
-            test.expect(res).toEqual(c[1]);
+                c[1].href = c[1].href || url;
+                c[1].password = c[1].password || "";
+                test.expect(res).toEqual(c[1]);
+            }, `support ${url}`);
         });
     });
 
     test.should("throw if url is empty", () => {
-        test.expect(() => {
-            parseUrl("")
-        }).toThrow(/invalid url/i)
-    })
+        safeExpect(() => {
+            test.expect(() => parseUrl("")).toThrow(/invalid url/i);
+        }, "throw if url is empty");
+    });
+
+    test.should("throw if url is too long", () => {
+        safeExpect(() => {
+            parseUrl.MAX_INPUT_LENGTH = 10;
+            test.expect(() => parseUrl("https://domain.com/")).toThrow(/input exceeds maximum length/i);
+        }, "throw if url is too long");
+    });
+
+    test.should("throw if url is invalid", () => {
+        safeExpect(() => {
+            test.expect(() => parseUrl("foo")).toThrow(/url parsing failed/i);
+        }, "throw if url is invalid");
+    });
+});
+
+process.on("exit", () => {
+    if (failedTests > 0) {
+        console.error(`\n${failedTests} test(s) failed.`);
+        process.exit(1);
+    }
 });
