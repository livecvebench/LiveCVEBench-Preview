==========================================
ModSecurity Test Suite
==========================================
Installing uv package manager...
no checksums to verify
installing to /root/.local/bin
  uv
  uvx
everything's installed!

To add $HOME/.local/bin to your PATH, either restart your shell or run:

    source $HOME/.local/bin/env (sh, bash, zsh)
    source $HOME/.local/bin/env.fish (fish)
Initializing test environment...
Installing test dependencies...
Waiting for server to be ready...
Server is ready!

==========================================
Running Tests
==========================================
Target URL: http://localhost

============================= test session starts ==============================
platform linux -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0 -- /tests/.venv/bin/python
cachedir: .pytest_cache
rootdir: /tests
configfile: pyproject.toml
collecting ... collected 15 items

test_func.py::TestModSecurityBasicFunctionality::test_basic_get_request PASSED [  6%]
test_func.py::TestModSecurityBasicFunctionality::test_basic_post_request PASSED [ 13%]
test_func.py::TestModSecurityBasicFunctionality::test_json_content_type_accepted PASSED [ 20%]
test_func.py::TestModSecurityBasicFunctionality::test_small_json_array_processed PASSED [ 26%]
test_func.py::TestModSecurityBasicFunctionality::test_json_object_processed PASSED [ 33%]
test_func.py::TestModSecurityFormData::test_url_encoded_form_data PASSED [ 40%]
test_func.py::TestModSecurityFormData::test_multipart_form_data PASSED   [ 46%]
test_func.py::TestModSecurityRuleProcessing::test_rules_engine_active PASSED [ 53%]
test_func.py::TestModSecurityRuleProcessing::test_multiple_json_fields PASSED [ 60%]
test_func.py::TestModSecurityRuleProcessing::test_nested_json_structure PASSED [ 66%]
test_vuln.py::TestSanitizationEntryCount::test_sanitization_entry_count_linear FAILED [ 73%]
test_vuln.py::TestSanitizationEntryCount::test_larger_array_scaling FAILED [ 80%]
test_vuln.py::TestSanitizationEntryCount::test_per_element_entry_count FAILED [ 86%]
test_vuln.py::TestVulnerabilityDetection::test_duplicate_warnings_per_request FAILED [ 93%]
test_vuln.py::TestVulnerabilityDetection::test_multiple_arrays_scaling FAILED [100%]

=================================== FAILURES ===================================
_______ TestSanitizationEntryCount.test_sanitization_entry_count_linear ________
test_vuln.py:152: in test_sanitization_entry_count_linear
    assert entry_count < max_expected, \
E   AssertionError: Too many sanitization entries: 200 (expected < 150). This indicates O(nÂ²) behavior from CVE-2025-47947 vulnerability.
E   assert 200 < 150
_____________ TestSanitizationEntryCount.test_larger_array_scaling _____________
test_vuln.py:178: in test_larger_array_scaling
    assert entry_count < max_expected, \
E   AssertionError: Excessive sanitization entries: 400 (expected < 300). N=100 elements should not produce 400 entries (indicates duplicates).
E   assert 400 < 300
___________ TestSanitizationEntryCount.test_per_element_entry_count ____________
test_vuln.py:205: in test_per_element_entry_count
    assert entries_per_element < max_entries_per_element, \
E   AssertionError: Too many entries per element: 4.0 (expected < 3.0). Got 200 entries for 50 elements, indicating duplicate additions.
E   assert 4.0 < 3.0
________ TestVulnerabilityDetection.test_duplicate_warnings_per_request ________
test_vuln.py:249: in test_duplicate_warnings_per_request
    assert total_warnings < max_expected, \
E   AssertionError: Detected 120 warning entries for 30 elements. Expected < 90. Excessive duplicates indicate vulnerability.
E   assert 120 < 90
___________ TestVulnerabilityDetection.test_multiple_arrays_scaling ____________
test_vuln.py:279: in test_multiple_arrays_scaling
    assert entry_count < max_expected, \
E   AssertionError: Multiple arrays produced 360 entries for 90 elements. Expected < 270 entries, got excessive duplicates.
E   assert 360 < 270
==================================== PASSES ====================================
=========================== short test summary info ============================
PASSED test_func.py::TestModSecurityBasicFunctionality::test_basic_get_request
PASSED test_func.py::TestModSecurityBasicFunctionality::test_basic_post_request
PASSED test_func.py::TestModSecurityBasicFunctionality::test_json_content_type_accepted
PASSED test_func.py::TestModSecurityBasicFunctionality::test_small_json_array_processed
PASSED test_func.py::TestModSecurityBasicFunctionality::test_json_object_processed
PASSED test_func.py::TestModSecurityFormData::test_url_encoded_form_data
PASSED test_func.py::TestModSecurityFormData::test_multipart_form_data
PASSED test_func.py::TestModSecurityRuleProcessing::test_rules_engine_active
PASSED test_func.py::TestModSecurityRuleProcessing::test_multiple_json_fields
PASSED test_func.py::TestModSecurityRuleProcessing::test_nested_json_structure
FAILED test_vuln.py::TestSanitizationEntryCount::test_sanitization_entry_count_linear
FAILED test_vuln.py::TestSanitizationEntryCount::test_larger_array_scaling - ...
FAILED test_vuln.py::TestSanitizationEntryCount::test_per_element_entry_count
FAILED test_vuln.py::TestVulnerabilityDetection::test_duplicate_warnings_per_request
FAILED test_vuln.py::TestVulnerabilityDetection::test_multiple_arrays_scaling
======================== 5 failed, 10 passed in 14.30s =========================
