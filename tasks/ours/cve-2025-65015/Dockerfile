FROM python:3.11-slim

WORKDIR /app

# System dependencies (tmux, asciinema, curl are required)
RUN apt-get update && apt-get install -y git tmux asciinema curl && rm -rf /var/lib/apt/lists/*

# Clone the vulnerable version of joserfc (1.3.4)
RUN git clone --branch 1.3.4 --depth 1 https://github.com/authlib/joserfc.git . && rm -rf .git

# Install dependencies
RUN pip install --no-cache-dir cryptography pytest

# Install package in development mode (editable) so source changes take effect immediately
RUN pip install --no-cache-dir -e .

# Keep container running (library has no service to run)
# CMD ["tail", "-f", "/dev/null"]
