FROM php:7.4-apache

WORKDIR /var/www/html

# System dependencies (tmux, asciinema, curl required; unzip for extracting archive)
RUN apt-get update && apt-get install -y \
    git \
    tmux \
    asciinema \
    curl \
    unzip \
    default-mysql-client \
    && rm -rf /var/lib/apt/lists/*

# Install PHP mysqli extension
RUN docker-php-ext-install mysqli

# Copy and extract the Student Management System
COPY task-deps/Student-Management-System.zip /tmp/
RUN unzip /tmp/Student-Management-System.zip -d /tmp/ && \
    cp -r /tmp/grading/* /var/www/html/ && \
    rm -rf /tmp/grading /tmp/Student-Management-System.zip

# Replace db.php with Docker-compatible version
COPY task-deps/db-docker.php /var/www/html/db.php

# Set proper permissions
RUN chown -R www-data:www-data /var/www/html

# Enable Apache mod_rewrite (if needed)
RUN a2enmod rewrite

# Expose port 80
EXPOSE 80

# Default Apache foreground command
# CMD ["apache2-foreground"]
