#!/bin/bash
set -e

# Wait for database to be ready
echo "Waiting for MySQL database to be ready..."
max_tries=30
count=0
while [ $count -lt $max_tries ]; do
    if mysql -h db -u root -e "SELECT 1" &>/dev/null; then
        echo "Database is ready!"
        break
    fi
    count=$((count + 1))
    echo "Attempt $count/$max_tries - Waiting for database..."
    sleep 2
done

if [ $count -eq $max_tries ]; then
    echo "WARNING: Database may not be ready, proceeding anyway..."
fi

# Start Apache in foreground
echo "Starting Apache web server..."
exec apache2-foreground
