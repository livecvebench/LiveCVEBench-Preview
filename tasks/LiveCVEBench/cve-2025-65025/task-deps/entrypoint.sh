#!/bin/bash
# Entrypoint script for esm.sh server
# This script enables restart capability for the solution.sh to apply fixes

cd /app

# Start the esm.sh server in a restart loop
while true; do
    echo "[entrypoint] Starting esmd server..."
    /app/esmd
    exit_code=$?
    echo "[entrypoint] esmd exited with code $exit_code"

    # If the process was killed (signal 15/SIGTERM), restart
    # If it exited normally (0), exit the loop
    if [ $exit_code -eq 0 ]; then
        echo "[entrypoint] esmd exited normally, stopping..."
        break
    fi

    echo "[entrypoint] Restarting esmd in 1 second..."
    sleep 1
done
