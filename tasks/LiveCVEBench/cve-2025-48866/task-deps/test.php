<?php
/**
 * Simple test endpoint for CVE-2025-48866
 * This file accepts POST requests and echoes back the received parameters
 * ModSecurity with sanitiseArg will process the request before it reaches here
 */

header('Content-Type: application/json');

// Get request method
$method = $_SERVER['REQUEST_METHOD'];

// Prepare response
$response = [
    'method' => $method,
    'timestamp' => date('Y-m-d H:i:s'),
    'received_params' => [],
    'param_count' => 0
];

// Process POST data
if ($method === 'POST') {
    $response['received_params'] = $_POST;
    $response['param_count'] = count($_POST);

    // Count parameters with same name (PHP merges them into arrays)
    $name_counts = [];
    foreach ($_POST as $key => $value) {
        if (is_array($value)) {
            $name_counts[$key] = count($value);
        } else {
            $name_counts[$key] = 1;
        }
    }
    $response['name_counts'] = $name_counts;
}

// Output response
echo json_encode($response, JSON_PRETTY_PRINT);
?>
