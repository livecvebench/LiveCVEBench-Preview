FROM ubuntu:22.04

WORKDIR /app

# System dependencies (tmux, asciinema, curl are required)
RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    ruby \
    rake \
    tmux \
    asciinema \
    curl \
    && rm -rf /var/lib/apt/lists/*

# 直接 checkout 到修复前一个提交
RUN git clone https://github.com/mruby/mruby.git . && \
    git checkout 93619f06dd378db6766666b30c08978311c7ec94^ && \
    rm -rf .git

RUN rake
