#!/bin/bash
# Entrypoint script for ModSecurity CVE-2025-54571
# This script runs Apache with restart capability for solution.sh

# Create required directories
mkdir -p /var/run/apache2
mkdir -p /var/lock/apache2
mkdir -p /var/cache/modsecurity

# Set permissions
chown -R www-data:www-data /var/cache/modsecurity

# Test Apache configuration
apache2ctl configtest

# Start Apache in a loop so it can be restarted by solution.sh
while true; do
    apache2ctl -D FOREGROUND &
    APACHE_PID=$!
    wait $APACHE_PID
    echo "Apache process exited, restarting..."
    sleep 1
done
