package jehc.djshi.workflow.common.listener;

import lombok.extern.slf4j.Slf4j;
import org.activiti.engine.TaskService;
import org.activiti.engine.delegate.DelegateExecution;
import org.activiti.engine.delegate.DelegateTask;
import org.activiti.engine.delegate.ExecutionListener;
import org.activiti.engine.delegate.TaskListener;
import javax.annotation.Resource;
/**
 * @Desc
 * @Author 邓纯杰
 * @CreateTime 2012-12-12 12:12:12
 */
@Slf4j
public class CustmTaskExecutionListener implements ExecutionListener, TaskListener {

	@Resource
	private TaskService taskService;

	private static final long serialVersionUID = 7960387497099642910L;

	/**
	 * ExecutionListener类的实现
	 * @param execution
	 * @throws Exception
	 */
	public void notify(DelegateExecution execution) throws Exception {
		String eventName = execution.getEventName();
		// start
		if ("start".equals(eventName)) {
			log.debug("start=========");
		} else if ("end".equals(eventName)) {
			log.debug("end=========");
		} else if ("take".equals(eventName)) {
			//take是监控连线的时执行
			log.debug("take=========");
		}
	}

	/**
	 * 实现TaskListener中的方法
	 * @param delegateTask
	 */
	public void notify(DelegateTask delegateTask) {
		String eventName = delegateTask.getEventName();
		if ("create".endsWith(eventName)) {
			log.debug("create=========");
		} else if ("assignment".endsWith(eventName)) {
			log.debug("assignment========");
		} else if ("complete".endsWith(eventName)) {
			log.debug("complete===========");
		} else if ("delete".endsWith(eventName)) {
			log.debug("delete=============");
		}else {
			//监听器分配任务处理人,该种实现方式无论流程图的处理人Assignee填不填都能正常分配
			taskService.setAssignee(delegateTask.getId(),"用户处理人");
		}
	}
}
