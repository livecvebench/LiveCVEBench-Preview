FROM debian:bookworm-slim

WORKDIR /app

# Install system dependencies
# - gcc: C compiler for compiling test harness
# - make: build system
# - curl: required by system
# - python3: for running pytest tests
# - tmux, asciinema: required tools
RUN apt-get update && apt-get install -y \
    gcc \
    make \
    curl \
    python3 \
    python3-pip \
    tmux \
    asciinema \
    && rm -rf /var/lib/apt/lists/*

# Create directories
RUN mkdir -p /app /tests

# Copy vulnerable source code to /app
# solution.sh will replace this with the fixed version
COPY task-deps/file_stream_vulnerable.c /app/file_stream.c
COPY task-deps/file_stream_fixed.c /app/file_stream_fixed.c

# Default command
CMD ["/bin/bash"]
