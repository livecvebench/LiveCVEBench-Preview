FROM ruby:3.2-slim

WORKDIR /app

# Install build dependencies and required tools
RUN apt-get update && apt-get install -y \
    build-essential \
    bison \
    git \
    tmux \
    asciinema \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Clone mruby at vulnerable commit and remove git history
RUN git clone https://github.com/mruby/mruby.git /app && \
    git checkout dd68681002f570233e6603360e70c32b2414eeba && \
    rm -rf .git

# Build mruby
RUN rake

# Keep container running for testing
# CMD ["tail", "-f", "/dev/null"]
