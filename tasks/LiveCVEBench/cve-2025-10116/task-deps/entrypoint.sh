#!/bin/bash
set -e

# Wait for MySQL to be ready
echo "Waiting for MySQL..."
while ! mysqladmin ping -h"db" -u"root" -p"rootpassword" --silent 2>/dev/null; do
    sleep 1
done
echo "MySQL is ready!"

# Import the database schema if not already done
if ! mysql -h"db" -u"root" -p"rootpassword" -e "USE siempre_cms; SELECT 1 FROM cms_user LIMIT 1;" 2>/dev/null; then
    echo "Initializing database..."
    mysql -h"db" -u"root" -p"rootpassword" < /var/www/html/SiempreCMS/backups/siempre_v1_3_r.sql
    echo "Database initialized successfully!"
else
    echo "Database already initialized."
fi

# Start Apache
exec "$@"
