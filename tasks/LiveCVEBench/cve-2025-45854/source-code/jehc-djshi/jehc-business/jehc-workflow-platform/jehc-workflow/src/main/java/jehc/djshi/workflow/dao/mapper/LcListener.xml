<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.workflow.dao.LcListenerDao">
    <!--初始化分页-->
    <select id="getLcListenerListByCondition" resultType="jehc.djshi.workflow.model.LcListener" parameterType="map">
        SELECT
            lc_listener.name,
            lc_listener.id,
            lc_listener.create_time AS createTime,
            lc_listener.update_time AS updateTime,
            lc_listener.create_id AS createId,
            lc_listener.update_id AS updateId,
            lc_listener.type,
            lc_listener.event,
            lc_listener.listener_val AS listenerVal,
            lc_listener.lc_product_id AS lcProductId,
            lc_listener.lc_group_id AS lcGroupId,
            lc_listener.remark,
            lc_listener.categories,
            lc_product.name AS productName,
            lc_group.name AS groupName
        FROM
            lc_listener lc_listener LEFT JOIN lc_product lc_product ON lc_product.id = lc_listener.lc_product_id
            LEFT JOIN lc_group lc_group ON  lc_group.id = lc_listener.lc_group_id
        WHERE 1=1
            AND lc_listener.del_flag = 0
            <if test="null != name">
                AND instr(lc_listener.name,#{name})
            </if>
            <if test="null != type">
                AND lc_listener.type = #{type}
            </if>
            <if test="null != event">
                AND lc_listener.event = #{event}
            </if>
            <if test="null != listenerVal">
                AND instr(lc_listener.listener_val,#{listenerVal})
            </if>
            <if test="null != categories">
                AND lc_listener.categories IN
                <foreach item="item" index="index" collection="categories" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
    </select>

    <!--查询对象-->
    <select id="getLcListenerById" resultType="jehc.djshi.workflow.model.LcListener" parameterType="string">
        SELECT
            lc_listener.name,
            lc_listener.id,
            lc_listener.create_time AS createTime,
            lc_listener.update_time AS updateTime,
            lc_listener.create_id AS createId,
            lc_listener.update_id AS updateId,
            lc_listener.type,
            lc_listener.event,
            lc_listener.listener_val AS listenerVal,
            lc_listener.lc_product_id AS lcProductId,
            lc_listener.lc_group_id AS lcGroupId,
            lc_listener.remark,
            lc_listener.categories,
            lc_product.name AS productName,
            lc_group.name AS groupName
        FROM
            lc_listener lc_listener LEFT JOIN lc_product lc_product ON lc_product.id = lc_listener.lc_product_id
                                    LEFT JOIN lc_group lc_group ON  lc_group.id = lc_listener.lc_group_id
        WHERE lc_listener.id=#{id}
    </select>

    <!--添加-->
    <insert id="addLcListener" parameterType="jehc.djshi.workflow.model.LcListener">
        INSERT INTO
            lc_listener
        (
            name,
            id,
            create_time,
            create_id,
            type,
            event,
            listener_val,
            lc_product_id,
            lc_group_id,
            remark,
            categories
        )
        VALUES
        (
            #{name},
            #{id},
            #{createTime},
            #{createId},
            #{type},
            #{event},
            #{listenerVal},
            #{lcProductId},
            #{lcGroupId},
            #{remark},
            #{categories}
        )
    </insert>

    <!--修改-->
    <update id="updateLcListener" parameterType="jehc.djshi.workflow.model.LcListener">
        UPDATE
            lc_listener
        SET
            <if test="null != name">
                name = #{name},
            </if>

            <if test="null != type">
                type = #{type},
            </if>
            <if test="null != event">
                event = #{event},
            </if>
            <if test="null != listenerVal">
                listener_val = #{listenerVal},
            </if>
            <if test="null != lcProductId">
                lc_product_id = #{lcProductId},
            </if>
            <if test="null != lcGroupId">
                lc_group_id = #{lcGroupId},
            </if>
            <if test="null != remark">
                remark = #{remark},
            </if>
            <if test="null != categories">
                categories = #{categories},
            </if>
            update_time = #{updateTime},
            update_id = #{updateId}
        WHERE
            id=#{id}
    </update>

    <!--删除-->
    <delete id="delLcListener" parameterType="map">
        UPDATE lc_listener SET del_flag = 1 WHERE id IN
        <foreach item="item" index="index" collection="id" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
</mapper>