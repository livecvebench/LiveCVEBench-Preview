FROM node:18-slim

WORKDIR /app

# Install system dependencies (git for the package to work, tmux/asciinema/curl as required)
RUN apt-get update && apt-get install -y \
    git \
    tmux \
    asciinema \
    curl \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Configure git globally
RUN git config --global user.email "docker@test.com" && \
    git config --global user.name "Docker User"

# Initialize a git repository in /app (required for the checkout functions to work)
RUN git init && \
    echo "Initial test content" > README.md && \
    git add . && \
    git commit -m "Initial commit"

# Install the vulnerable version of the package from npm
RUN npm install interactive-git-checkout@1.1.4

# Install pytest for running tests
RUN pip3 install pytest --break-system-packages

# Keep container running
# CMD ["tail", "-f", "/dev/null"]
