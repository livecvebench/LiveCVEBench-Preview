# Dockerfile for CVE-2025-3248 - Langflow Unauthenticated RCE
# Uses the official vulnerable Langflow image version 1.2.0

FROM langflowai/langflow:1.2.0

# Proxy settings for build
ARG HTTP_PROXY
ARG HTTPS_PROXY
ARG http_proxy
ARG https_proxy
ARG NO_PROXY
ARG no_proxy

# Install required system packages (tmux, asciinema, curl are required by framework)
USER root
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        tmux \
        asciinema \
        gcc \
        g++ \
        wget \
        curl \
        git \
        procps && \
    rm -rf /var/lib/apt/lists/*

# Copy wrapper script that monitors for restart signal
COPY task-deps/wrapper.sh /app/wrapper.sh
RUN chmod +x /app/wrapper.sh


# Health check for application readiness
HEALTHCHECK --interval=10s --timeout=5s --start-period=90s --retries=10 \
    CMD curl -f http://localhost:7860/health || exit 1

# Reset base image ENTRYPOINT to allow docker-compose command to work
ENTRYPOINT []

# Use wrapper script as entrypoint
# CMD ["/app/wrapper.sh"]
