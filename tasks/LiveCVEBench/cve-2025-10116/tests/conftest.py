"""
Shared fixtures for SiempreCMS vulnerability tests.
"""

import pytest
import requests
import os

BASE_URL = os.environ.get("APP_URL", "http://localhost/SiempreCMS")


@pytest.fixture(scope="session")
def authenticated_session():
    """
    Create a single authenticated session for all tests.
    Using session scope to minimize login attempts and avoid IP lockout.
    """
    session = requests.Session()
    response = session.post(
        f"{BASE_URL}/docs/admin/login_ajax.php",
        data={
            "action": "login",
            "username": "admin",
            "password": "admin"
        }
    )
    assert response.status_code == 200
    json_data = response.json()
    assert json_data.get("result") is True, f"Failed to authenticate: {json_data}"
    return session
