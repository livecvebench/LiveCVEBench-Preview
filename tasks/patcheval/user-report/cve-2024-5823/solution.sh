cat <<'EOF' > fix.patch
diff --git a/ChuanhuChatbot.py b/ChuanhuChatbot.py
index 3fdc2bba..8ea2abd8 100644
--- a/ChuanhuChatbot.py
+++ b/ChuanhuChatbot.py
@@ -781,7 +781,7 @@ def create_greeting(request: gr.Request):
     # Invisible elements
     updateChuanhuBtn.click(
         update_chuanhu,
-        [],
+        [user_name],
         [status_display],
         show_progress=True,
     )
diff --git a/modules/config.py b/modules/config.py
index f93fad59..b0945fff 100644
--- a/modules/config.py
+++ b/modules/config.py
@@ -190,6 +190,7 @@ def load_config_to_environ(key_list):
     shared.state.set_api_key_queue(api_key_list)
 
 auth_list = config.get("users", [])  # 实际上是使用者的列表
+admin_list = config.get("admin_list", [])  # 管理员列表
 authflag = len(auth_list) > 0  # 是否开启认证的状态值，改为判断auth_list长度
 
 # 处理自定义的api_host，优先读环境变量的配置，如果存在则自动装配
diff --git a/modules/utils.py b/modules/utils.py
index f2baefad..e6b12b01 100644
--- a/modules/utils.py
+++ b/modules/utils.py
@@ -27,7 +27,7 @@
 
 from modules.presets import *
 from . import shared
-from modules.config import retrieve_proxy, hide_history_when_not_logged_in
+from modules.config import retrieve_proxy, hide_history_when_not_logged_in, admin_list
 
 if TYPE_CHECKING:
     from typing import TypedDict
@@ -741,7 +741,9 @@ def transfer_input(inputs):
     )
 
 
-def update_chuanhu():
+def update_chuanhu(username):
+    if username not in admin_list:
+        return gr.Markdown(value=i18n("no_permission_to_update_description"))
     from .repo import background_update
 
     print("[Updater] Trying to update...")


EOF

cd /app/chuanhuchatgpt
git apply --whitespace=nowarn  /app/fix.patch