#!/bin/bash
cd "$(dirname "$0")"

# Try to install uv, fall back to pip if network fails
install_and_run_tests() {
    # Try uv first
    if ! command -v uv &> /dev/null; then
        curl -LsSf --connect-timeout 10 https://astral.sh/uv/0.7.13/install.sh | sh 2>/dev/null
        if [ -f "$HOME/.local/bin/env" ]; then
            source $HOME/.local/bin/env
        fi
    fi

    if command -v uv &> /dev/null; then
        # uv is available
        uv init 2>/dev/null || true
        uv add pytest 2>/dev/null
        uv run pytest test_func.py test_vuln.py -rA --tb=no || true
    else
        # Fallback to pip
        echo "uv not available, using pip..."
        pip3 install pytest --break-system-packages 2>/dev/null || pip3 install pytest 2>/dev/null || pip install pytest 2>/dev/null
        python3 -m pytest test_func.py test_vuln.py -rA --tb=no || true
    fi
}

install_and_run_tests
