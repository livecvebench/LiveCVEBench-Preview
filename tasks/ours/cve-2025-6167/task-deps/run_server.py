#!/usr/bin/env python3
"""Server startup script for python-a2a workflow API."""
import os
from python_a2a.agent_flow.storage.workflow_storage import FileWorkflowStorage
from python_a2a.agent_flow.models.agent import AgentRegistry
from python_a2a.agent_flow.models.tool import ToolRegistry
from python_a2a.agent_flow.engine.executor import WorkflowExecutor
from python_a2a.agent_flow.server.api import create_app

# Initialize storage directory
storage_dir = os.environ.get('WORKFLOW_STORAGE_DIR', '/app/workflows')
os.makedirs(storage_dir, exist_ok=True)

# Initialize components
storage = FileWorkflowStorage(storage_dir)
agent_registry = AgentRegistry()
tool_registry = ToolRegistry()
executor = WorkflowExecutor(agent_registry, tool_registry)

# Create and run app
app = create_app(agent_registry, tool_registry, storage, executor)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080, threaded=True)
