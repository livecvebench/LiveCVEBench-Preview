#!/bin/bash
set -e

# Initialize Aim repository if not exists
# The aim init command creates .aim in the current working directory
cd /app
if [ ! -d "/app/.aim" ]; then
    echo "Initializing Aim repository..."
    aim init -y
fi

# Create sample data if needed
python /app/create_sample_data.py

# Restart loop for the Aim server
# This allows solution.sh to restart the service after applying patches
while true; do
    echo "Starting Aim server..."
    # Use /app as the repo path (aim looks for .aim directory inside it)
    aim up --host 0.0.0.0 --port 43800 --repo /app || true
    echo "Aim server stopped. Restarting in 2 seconds..."
    sleep 2
done
