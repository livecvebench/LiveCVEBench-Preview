instruction: |-
  This WordPress plugin provides a REST API connector that allows external services
  to interact with your WordPress site, including uploading media files via the
  `/wp-json/wp/v2/media` endpoint with API key authentication.

  Users have reported that when uploading files with disallowed extensions (such as
  .php, .phtml, or .phar files), the API correctly returns an error message:
  "Sorry, this file type is not permitted for security reasons." However, despite
  this error response, the uploaded file still appears in the uploads directory
  (`/wp-content/uploads/YYYY/MM/`) and is accessible via direct URL.

  The expected behavior is that files with disallowed types should never be written
  to the uploads directory. If validation fails, the file should be rejected before
  any file system operations occur.

  The issue is in the file upload handler located in the plugin's class directory.
  The validation logic exists but appears to execute at the wrong point in the
  upload workflow.

difficulty: medium
category: bug-fix
tags:
  - wordpress
  - php
  - file-upload
  - validation
parser_name: pytest

run_tests_in_same_shell: false
max_test_timeout_sec: 180
max_agent_timeout_sec: 600
