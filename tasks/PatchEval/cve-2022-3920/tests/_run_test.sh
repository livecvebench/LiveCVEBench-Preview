#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2022-3920:latest
# bash /workspace/fix-run.sh
set -e

cd /workspace/consul
git apply --whitespace=nowarn /tests/test.patch 
go test  -timeout 30s -run ^TestACL_filterNodeDump$ github.com/hashicorp/consul/agent/structs/aclfilter

cd /workspace
#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2022-3920:latest
# bash /workspace/unit_test.sh
set -e

cd /workspace/consul
go test -timeout 30s -run '^(TestACL_filterPreparedQueries|TestACL_filterCheckServiceNodes|TestACL_filterCoordinates|TestACL_filterIntentions|TestACL_filterImported_IndexedServiceNodes|TestACL_unhandledFilterType|TestACL_filterImported_CheckServiceNode|TestACL_filterServiceList|TestACL_filterImported_IndexedHealthChecks|TestACL_filterIndexedNodesWithGateways|TestACL_filterPreparedQueryExecuteResponse|TestACL_filterNodeServices|TestACL_filterHealthChecks|TestACL_filterImported_IndexedNodes|TestACL_filterDatacenterCheckServiceNodes|TestACL_filterIndexedServiceDump|TestACL_filterImported_IndexedNodeServiceList|TestACL_filterServiceTopology|TestACL_filterGatewayServices|TestFilterACL_redactTokenSecrets|TestACL_filterNodeServiceList|TestACL_filterImported_IndexedNodeServices|TestFilterACL_redactTokenSecret|TestACL_filterSessions|TestACL_filterNodes|TestACL_redactPreparedQueryTokens|TestACL_filterServices|TestACL_filterNodeDump|TestACL_filterServiceNodes)$' github.com/hashicorp/consul/agent/structs/aclfilter