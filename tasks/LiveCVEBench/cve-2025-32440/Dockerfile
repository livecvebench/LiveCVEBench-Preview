# CVE-2025-32440: NetAlertX Authentication Bypass
# Using official vulnerable Docker image as base
FROM jokobsk/netalertx:25.4.1

# Accept proxy build args
ARG http_proxy
ARG https_proxy
ARG HTTP_PROXY
ARG HTTPS_PROXY
ARG no_proxy
ARG NO_PROXY

# Install additional tools needed for testing
# Use proxy for apk
RUN export http_proxy=http://oversea-squid5.sgp.txyun:11080 && \
    export https_proxy=http://oversea-squid5.sgp.txyun:11080 && \
    apk add --no-cache tmux gcc g++ wget curl git bash asciinema py3-pip coreutils py3-pytest py3-requests

# Copy the sample configuration with password enabled
COPY task-deps/app.conf.sample /app/config/app.conf
COPY task-deps/app.conf.sample /app/config/app.conf.orig

# Ensure proper permissions for config file (nginx:www-data in Alpine)
RUN chown nginx:www-data /app/config/app.conf /app/config/app.conf.orig && chmod 644 /app/config/app.conf /app/config/app.conf.orig

# Environment variables
ENV TZ=Europe/Berlin
ENV PORT=20211

# The base image already exposes port 20211 and has healthcheck
# ENTRYPOINT ["/init"] is set by base image
