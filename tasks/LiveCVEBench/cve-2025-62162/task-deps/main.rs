// Test harness for cel-rust
// Parses and optionally executes a CEL expression from command line arguments

use cel::{Context, Program};
use std::env;

fn main() {
    let args: Vec<String> = env::args().collect();

    if args.len() < 2 {
        eprintln!("Usage: {} <expression>", args[0]);
        eprintln!("\nExamples:");
        eprintln!("  {} '1 + 1'", args[0]);
        eprintln!("  {} 'true && false'", args[0]);
        eprintln!("  {} '\"hello\" == \"hello\"'", args[0]);
        std::process::exit(1);
    }

    let expr = &args[1];
    println!("Parsing: {}", expr);

    match Program::compile(expr) {
        Ok(program) => {
            println!("Parsed successfully!");

            let context = Context::default();
            match program.execute(&context) {
                Ok(value) => println!("Result: {:?}", value),
                Err(e) => {
                    eprintln!("Execution error: {:?}", e);
                    std::process::exit(2);
                }
            }
        }
        Err(e) => {
            eprintln!("Parse error: {:?}", e);
            std::process::exit(1);
        }
    }
}
