instruction: |-
  This is the ruby-saml library, which provides SAML (Security Assertion Markup
  Language) support for Ruby applications handling Single Sign-On (SSO) authentication.

  We've configured a message size limit using `message_max_bytesize` setting to prevent
  large SAML messages from consuming excessive resources. However, when an extremely
  large Base64-encoded SAML message is submitted (e.g., 10MB+), the application becomes
  unresponsive for several seconds before eventually rejecting the message with the
  expected size limit error.

  Expected behavior: Large messages should be rejected immediately (in milliseconds)
  without causing CPU spikes or delays. The `message_max_bytesize` check should prevent
  expensive processing of oversized messages.

  Actual behavior: The application performs expensive regex operations on the entire
  message content before checking the size limit, causing significant CPU usage and
  delays even for messages that will ultimately be rejected.

  The issue is in the message decoding logic in `lib/onelogin/ruby-saml/saml_message.rb`.
  The validation order needs to be corrected so that size limits are enforced before
  any expensive string operations are performed.

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: easy
category: bug-fix
tags:
  - ruby
  - saml
  - performance
  - validation-order
parser_name: pytest

run_tests_in_same_shell: false
