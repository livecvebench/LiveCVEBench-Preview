#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2022-36009:latest
# bash /workspace/fix-run.sh
set -e

cd /workspace/gomatrixserverlib
git apply --whitespace=nowarn /tests/test.patch 
go test  -timeout 30s -run ^TestNegativePowerLevels$ github.com/matrix-org/gomatrixserverlib

cd /workspace
#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2022-36009:latest
# bash /workspace/unit_test.sh
set -e

cd /workspace/gomatrixserverlib
go test -timeout 30s -run '^(TestAuthEvents|TestStateNeededForInvite|TestStateNeededForCreate|TestAllowedNoFederation|TestAllowedWithPowerLevels|TestStateNeededForMessage|TestDemoteUserDefaultPowerLevelBelowOwn|TestAllowedInviteFrom3PID|TestPromoteUserDefaultLevelAboveOwn|TestAllowedEmptyRoom|TestRedactAllowed|TestStateNeededForInvite3PID|TestStateNeededForAlias|TestAllowedFirstJoin|TestStateNeededForJoin|TestAllowedWithNoPowerLevels)$' github.com/matrix-org/gomatrixserverlib