#!/bin/bash

# Wait for MySQL to be ready
echo "Waiting for MySQL to be ready..."
until mysql -h mysql -u admin -ppointofsale -e "SELECT 1" > /dev/null 2>&1; do
    echo "MySQL is not ready yet, waiting..."
    sleep 2
done

echo "MySQL is ready. Checking if database is initialized..."

# Check if the database has tables already
TABLE_COUNT=$(mysql -h mysql -u admin -ppointofsale ospos -N -e "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'ospos'")

if [ "$TABLE_COUNT" -eq "0" ]; then
    echo "Database is empty. Initializing database..."
    mysql -h mysql -u admin -ppointofsale ospos < /app/app/Database/database.sql
    echo "Database initialized successfully."
else
    echo "Database already has $TABLE_COUNT tables. Skipping initialization."
fi

# Start Apache
echo "Starting Apache..."
exec apache2-foreground
