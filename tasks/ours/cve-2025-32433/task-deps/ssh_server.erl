-module(ssh_server).
-export([start/0]).

%% Simple Erlang SSH server for CVE-2025-32433 reproduction
%% This server is intentionally simple and accepts any credentials
%% to demonstrate the pre-authentication RCE vulnerability

start() ->
    io:format("Starting vulnerable SSH server on port 2222~n"),
    application:ensure_all_started(ssh),
    case ssh:daemon(2222, [
        {system_dir, "/root/ssh_keys"},
        {auth_methods, "password"},
        {pwdfun, fun(User, Pass) ->
            io:format("Login attempt: ~p/~p~n", [User, Pass]),
            true  % Accept any credentials for testing
        end}
    ]) of
        {ok, Pid} ->
            io:format("SSH Daemon started successfully. PID: ~p~n", [Pid]),
            io:format("Server is listening on port 2222~n"),
            io:format("~n*** VULNERABLE TO CVE-2025-32433 ***~n"),
            receive
                stop -> ok
            end;
        {error, Reason} ->
            io:format("Failed to start SSH daemon: ~p~n", [Reason])
    end.
