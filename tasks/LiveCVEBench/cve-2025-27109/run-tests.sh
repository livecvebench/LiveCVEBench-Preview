#!/bin/bash

cd "$(dirname "$0")"

# Install uv if not already available
if ! command -v uv &> /dev/null; then
    echo "Installing uv..."
    curl -LsSf https://astral.sh/uv/0.7.13/install.sh | sh 2>/dev/null
    source $HOME/.local/bin/env 2>/dev/null || true
    export PATH="$HOME/.local/bin:$PATH"
fi

# Initialize uv project if needed
uv init 2>/dev/null || true

# Add test dependencies
uv add pytest requests 2>/dev/null

# Wait a bit for server to be fully ready
sleep 2

# Run all tests with summary report format (-rA produces PASSED/FAILED lines)
echo "Running all tests..."
# Run both test files and allow failures without exiting
uv run pytest test_func.py test_vuln.py -rA -v --tb=short || true

echo ""
echo "All tests completed!"
