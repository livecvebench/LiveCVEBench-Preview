instruction: |-
  I'm using a Python application that connects to a PostgreSQL database to
  retrieve system metadata. The application runs queries like:

  `SELECT version()`
  `SELECT current_database()`
  `SELECT pg_is_in_recovery()`
  `SELECT now()`

  I discovered that any database user with `CREATE` privilege on the `public`
  schema can hijack these function calls. For example, if someone runs:

  CREATE FUNCTION public.version() RETURNS text AS $$
  BEGIN
    -- malicious code here
    RETURN 'fake';
  END;
  $$ LANGUAGE plpgsql;
    When my application (running as a privileged user) executes `SELECT version()`,
  it actually runs the attacker's function instead of the real PostgreSQL
  `pg_catalog.version()` function. This is because PostgreSQL's `search_path`
  includes `public` before `pg_catalog` by default.

  The attacker's function runs with my application's database privileges,
  allowing privilege escalation.

  Expected behavior:
  - All built-in function calls should use fully qualified names
  - Use `pg_catalog.version()` instead of `version()`
  - Use `pg_catalog.current_database()` instead of `current_database()`
  - The application should be immune to `search_path` hijacking attacks

difficulty: medium
category: security
tags:
  - postgresql
  - sql
  - search-path
  - function-resolution
parser_name: pytest
run_tests_in_same_shell: false
