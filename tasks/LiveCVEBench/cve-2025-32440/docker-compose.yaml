services:
  client:
    build:
      dockerfile: Dockerfile
    container_name: ${T_BENCH_TASK_DOCKER_CLIENT_CONTAINER_NAME}
    environment:
      TZ: Europe/Berlin
      PORT: '20211'
      TEST_DIR: ${T_BENCH_TEST_DIR}
      S6_CMD_WAIT_FOR_SERVICES: 1
      S6_CMD_WAIT_FOR_SERVICES_MAXTIME: 0
      S6_KEEP_ENV: 1
      S6_BEHAVIOUR_IF_STAGE2_FAILS: 2
    volumes:
    - netalertx_db:/app/db
    - ${T_BENCH_TASK_LOGS_PATH}:${T_BENCH_CONTAINER_LOGS_PATH}
    - ${T_BENCH_TASK_AGENT_LOGS_PATH}:${T_BENCH_CONTAINER_AGENT_LOGS_PATH}
    healthcheck:
      test: [CMD, curl, -sf, "http://localhost:20211/"]
      interval: 10s
      timeout: 5s
      start_period: 60s
      retries: 5
    image: ${T_BENCH_TASK_DOCKER_CLIENT_IMAGE_NAME}
    entrypoint: ["/init"]
    command: ["sleep", "infinity"]
volumes:
  netalertx_db: null
