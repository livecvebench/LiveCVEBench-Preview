#!/bin/sh

# Initialize database if it doesn't exist
if [ ! -f /database.db ]; then
    echo "Initializing database..."
    /app/filebrowser config init --database /database.db
    /app/filebrowser users add admin admin --perm.admin=true --database /database.db
    /app/filebrowser users add testuser testpass --perm.execute=true --commands=find --database /database.db
    echo "Database initialized with admin and testuser"
fi

# Run filebrowser in a loop (for restart capability after code changes)
while true; do
    echo "Starting File Browser..."
    /app/filebrowser --database /database.db --address 0.0.0.0 --port 80 --root /srv
    exit_code=$?
    echo "File Browser exited with code $exit_code. Restarting in 2 seconds..."
    sleep 2
done
