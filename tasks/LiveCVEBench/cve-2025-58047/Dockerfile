FROM plone/plone-frontend:16.33.0

# Install required tools - using a single RUN to minimize layers
USER root
RUN apt-get update -qq && \
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
    tmux asciinema gcc g++ wget curl git procps python3-pip && \
    rm -rf /var/lib/apt/lists/* && \
    pip3 install --no-cache-dir pytest requests

# Create task-deps directory and copy the patched file
RUN mkdir -p /task-deps

# Copy entrypoint script for restart capability and make it executable for all
COPY task-deps/entrypoint.sh /entrypoint.sh
RUN chmod 755 /entrypoint.sh && chown node:node /entrypoint.sh

# Environment variables for Volto
ENV RAZZLE_INTERNAL_API_PATH=http://backend:8080/Plone
ENV RAZZLE_DEV_PROXY_TO_API_PATH=http://backend:8080/Plone

EXPOSE 3000

# Reset ENTRYPOINT from base image (which was 'yarn')
ENTRYPOINT []

# Keep running as root for tb framework compatibility
# CMD moved to docker-compose.yaml for tb framework compatibility
