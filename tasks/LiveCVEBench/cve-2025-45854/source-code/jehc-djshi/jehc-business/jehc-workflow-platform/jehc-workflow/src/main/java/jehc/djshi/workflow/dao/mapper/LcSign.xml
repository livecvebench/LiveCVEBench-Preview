<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.workflow.dao.LcSignDao">
    <!--查询列表-->
    <select id="getLcSignListByCondition" resultType="jehc.djshi.workflow.model.LcSign" parameterType="map">
        SELECT
            id,
            proc_def_id AS procDefId,
            task_def_key AS taskDefKey,
            proc_inst_id AS procInstId,
            execution_id AS executionId,
            name,
            nr_of_instances AS nrOfInstances,
            nr_of_completed_instances AS nrOfCompletedInstances,
            tenant_id AS tenantId,
            create_time AS createTime,
            update_time AS updateTime,
            create_id AS createId,
            update_id AS updateId,
            batch
        FROM
            lc_sign
        WHERE 1=1
            <if test="null != procDefId">
                AND proc_def_id = #{procDefId}
            </if>
            <if test="null != procInstId">
                AND proc_inst_id = #{procInstId}
            </if>
            <if test="null != taskDefKey">
                AND task_def_key = #{taskDefKey}
            </if>
            <if test="null != executionId">
                AND execution_id = #{executionId}
            </if>
            <if test="null != batch">
                AND batch = #{batch}
            </if>
            ORDER BY create_time DESC
    </select>

    <!--添加-->
    <insert id="addLcSign" parameterType="jehc.djshi.workflow.model.LcSign">
        INSERT INTO
        lc_sign
        (
           id,
           proc_def_id,
           task_def_key,
           proc_inst_id,
           execution_id,
           name,
           nr_of_instances,
           nr_of_completed_instances,
           tenant_id,
           create_time,
           create_id,
           update_time,
           update_id,
           del_flag,
           batch
        )
        VALUES
        (
            #{id},
            #{procDefId},
            #{taskDefKey},
            #{procInstId},
            #{executionId},
            #{name},
            #{nrOfInstances},
            #{nrOfCompletedInstances},
            #{tenantId},
            #{createTime},
            #{createId},
            #{updateTime},
            #{updateId},
            0,
            #{batch}
        )
    </insert>

    <!--批量添加-->
    <insert id="addBatchLcSign" parameterType="list">
        INSERT INTO
        lc_sign
        (
            id,
            proc_def_id,
            task_def_key,
            proc_inst_id,
            execution_id,
            name,
            nr_of_instances,
            nr_of_completed_instances,
            tenant_id,
            create_time,
            create_id,
            update_time,
            update_id,
            del_flag,
            batch
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.id},
            #{item.procDefId},
            #{item.taskDefKey},
            #{item.procInstId},
            #{item.executionId},
            #{item.name},
            #{item.nrOfInstances},
            #{item.nrOfCompletedInstances},
            #{item.tenantId},
            #{item.createTime},
            #{item.createId},
            #{item.updateTime},
            #{item.updateId},
            0,
            #{item.batch}
            )
        </foreach>
    </insert>

    <!--更新会签结果-->
    <update id="updateLcSign" parameterType="jehc.djshi.workflow.model.LcSign">
        UPDATE
            lc_sign
        SET
            <if test="null != nrOfInstances">
                nr_of_instances = #{nrOfInstances},
            </if>

            <if test="null != nrOfCompletedInstances">
                nr_of_completed_instances = #{nrOfCompletedInstances},
            </if>
            update_time = #{updateTime},
            update_id = #{updateId}
        WHERE id=#{id}
    </update>

    <!--删除-->
    <delete id="delLcSign" parameterType="map">
        DELETE FROM lc_sign WHERE id IN
        <foreach item="item" index="index" collection="id" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>

    <!--获取最大批次-->
    <select id="getMaxBatch" resultType="java.lang.Integer" parameterType="jehc.djshi.workflow.model.LcSign">
        SELECT
          max(batch)
        FROM
          lc_sign
        WHERE 1=1
        <if test="null != procInstId">
            AND proc_inst_id = #{procInstId}
        </if>
        <if test="null != taskDefKey">
            AND task_def_key = #{taskDefKey}
        </if>
        <if test="null != executionId">
            AND execution_id = #{executionId}
        </if>
    </select>
</mapper>