#!/bin/bash
# Entrypoint wrapper for Erlang SSH server
# This allows the service to be restarted by solution.sh while keeping container alive

cd /root

# Keep restarting the Erlang SSH server whenever it exits
while true; do
    echo "[entrypoint] Starting Erlang SSH server..."
    erl -noshell -pa . -s ssh_server start &
    SERVER_PID=$!
    echo "[entrypoint] Erlang SSH server PID: $SERVER_PID"

    # Wait for the server process to exit
    wait $SERVER_PID
    EXIT_CODE=$?

    echo "[entrypoint] Erlang SSH server exited with code $EXIT_CODE, restarting in 1 second..."
    sleep 1
done
