<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.workflow.dao.LcDeploymentHisDao">
	<!--初始化分页-->
	<select id="getLcDeploymentHisListByCondition" resultType="jehc.djshi.workflow.model.LcDeploymentHis" parameterType="map">
		SELECT
			lc_deployment_his.id,
			lc_deployment_his.deployment_id AS deploymentId,
			lc_deployment_his.deployment_name AS deploymentName,
			lc_deployment_his.deployment_time AS deploymentTime,
			lc_deployment_his.tenant_id AS tenantId,
			lc_deployment_his.lc_process_id AS lcProcessId,
			lc_deployment_his.status,
			lc_deployment_his.uk,
			lc_deployment_his.uid,
			lc_deployment_his.version,
-- 			lc_deployment_his.bpmn,
-- 			lc_deployment_his.mxgraph_xml AS mxgraphXml,
			lc_deployment_his.mxgraph_style AS mxgraphStyle,
-- 			lc_deployment_his.img_xml AS imgXml,
			lc_product.name AS productName,
			lc_group.name AS groupName,
			lc_deployment_his.w,
			lc_deployment_his.h,
			lc_deployment_his.create_id AS createId,
			lc_deployment_his.update_id AS updateId,
			lc_deployment_his.create_time AS createTime,
			lc_deployment_his.update_time AS updateTime,
			lc_deployment_his.candidate_group_type AS candidateGroupType,
			lc_deployment_his.candidate_starter_users AS candidateStarterUsers,
			lc_deployment_his.candidate_starter_groups AS candidateStarterGroups,
			lc_process.title,
			lc_process.flag AS processDelFlag,
			lc_process.status AS processStatus
		FROM
			lc_deployment_his lc_deployment_his
			LEFT JOIN lc_process lc_process ON lc_deployment_his.lc_process_id = lc_process.id
			LEFT JOIN lc_product lc_product ON lc_process.lc_product_id = lc_product.id
			LEFT JOIN lc_group lc_group ON lc_process.lc_group_id = lc_group.id
		WHERE 1=1
			<if test="null != title">
				AND instr(lc_process.title,#{title})
			</if>
			<if test="null != deploymentName">
				AND instr(lc_deployment_his.deployment_name,#{deploymentName})
			</if>
			<if test="null != id">
				AND lc_deployment_his.id = #{id}
			</if>
			<if test="null != lcProcessId">
				AND lc_deployment_his.lc_process_id = #{lcProcessId}
			</if>
			<if test="null != deploymentId">
				AND lc_deployment_his.deployment_id = #{deploymentId}
			</if>
			<if test="null != lcProductId">
				AND lc_process.lc_product_id = #{lcProductId}
			</if>
			<if test="null != lcGroupId">
				AND lc_process.lc_group_id = #{lcGroupId}
			</if>
			<if test="null != status">
				AND lc_deployment_his.status = #{status}
			</if>
			ORDER BY lc_deployment_his.deployment_time DESC
	</select>

	<!--根据部署编号查找对象-->
	<select id="getLcDeploymentHisByDeploymentId" resultType="jehc.djshi.workflow.model.LcDeploymentHis" parameterType="string">
		SELECT
			lc_deployment_his.id,
			lc_deployment_his.deployment_id AS deploymentId,
			lc_deployment_his.deployment_name AS deploymentName,
			lc_deployment_his.deployment_time AS deploymentTime,
			lc_deployment_his.tenant_id AS tenantId,
			lc_deployment_his.lc_process_id AS lcProcessId,
			lc_deployment_his.status,
			lc_deployment_his.uk,
			lc_deployment_his.uid,
			lc_deployment_his.version,
			lc_deployment_his.bpmn,
			lc_deployment_his.mxgraph_xml AS mxgraphXml,
			lc_deployment_his.mxgraph_style AS mxgraphStyle,
			lc_deployment_his.img_xml AS imgXml,
			lc_process.flag,
			lc_product.name AS productName,
			lc_group.name AS groupName,
			lc_deployment_his.w,
			lc_deployment_his.h,
			lc_deployment_his.create_id AS createId,
			lc_deployment_his.update_id AS updateId,
			lc_deployment_his.create_time AS createTime,
			lc_deployment_his.update_time AS updateTime,
			lc_deployment_his.candidate_group_type AS candidateGroupType,
			lc_deployment_his.candidate_starter_users AS candidateStarterUsers,
			lc_deployment_his.candidate_starter_groups AS candidateStarterGroups,
			lc_process.title,
			lc_process.flag AS processDelFlag,
			lc_process.status AS processStatus
		FROM
			lc_deployment_his lc_deployment_his
			LEFT JOIN lc_process lc_process ON lc_deployment_his.lc_process_id = lc_process.id
			LEFT JOIN lc_product lc_product ON lc_process.lc_product_id = lc_product.id
			LEFT JOIN lc_group lc_group ON lc_process.lc_group_id = lc_group.id
		WHERE 1=1
		AND lc_deployment_his.deployment_id = #{deploymentId}
		ORDER BY lc_deployment_his.deployment_time DESC
	</select>

	<!--查询对象-->
	<select id="getLcDeploymentHisById" resultType="jehc.djshi.workflow.model.LcDeploymentHis" parameterType="string">
		SELECT
			lc_deployment_his.id,
			lc_deployment_his.deployment_id AS deploymentId,
			lc_deployment_his.deployment_name AS deploymentName,
			lc_deployment_his.deployment_time AS deploymentTime,
			lc_deployment_his.tenant_id AS tenantId,
			lc_deployment_his.lc_process_id AS lcProcessId,
			lc_deployment_his.status,
			lc_deployment_his.uk,
			lc_deployment_his.uid,
			lc_deployment_his.version,
			lc_deployment_his.bpmn,
			lc_deployment_his.mxgraph_xml AS mxgraphXml,
			lc_deployment_his.mxgraph_style AS mxgraphStyle,
			lc_deployment_his.img_xml AS imgXml,
			lc_product.name AS productName,
			lc_group.name AS groupName,
			lc_deployment_his.w,
			lc_deployment_his.h,
			lc_deployment_his.create_id AS createId,
			lc_deployment_his.update_id AS updateId,
			lc_deployment_his.create_time AS createTime,
			lc_deployment_his.update_time AS updateTime,
			lc_deployment_his.candidate_group_type AS candidateGroupType,
			lc_deployment_his.candidate_starter_users AS candidateStarterUsers,
			lc_deployment_his.candidate_starter_groups AS candidateStarterGroups,
			lc_process.title,
			lc_process.flag AS processDelFlag,
			lc_process.status AS processStatus
		FROM
			lc_deployment_his lc_deployment_his
			LEFT JOIN lc_process lc_process ON lc_deployment_his.lc_process_id = lc_process.id
			LEFT JOIN lc_product lc_product ON lc_process.lc_product_id = lc_product.id
			LEFT JOIN lc_group lc_group ON lc_process.lc_group_id = lc_group.id
		WHERE lc_deployment_his.id=#{id}
	</select>

	<!--添加-->
	<insert id="addLcDeploymentHis" parameterType="jehc.djshi.workflow.model.LcDeploymentHis">
		INSERT INTO
		lc_deployment_his
		(
			id,
			deployment_id,
			deployment_name,
			deployment_time,
			tenant_id,
			lc_process_id,
			status,
			uk,
			uid,
			version,
			bpmn,
			mxgraph_xml,
			mxgraph_style,
			img_xml,
			w,
			h,
			create_id,
			update_id,
			create_time,
			update_time,
			candidate_group_type,
			candidate_starter_users,
			candidate_starter_groups
		)
		VALUES
		(
			#{id},
			#{deploymentId},
			#{deploymentName},
			#{deploymentTime},
			#{tenantId},
			#{lcProcessId},
			#{status},
			#{uk},
			#{uid},
			#{version},
			#{bpmn},
			#{mxgraphXml},
			#{mxgraphStyle},
			#{imgXml},
			#{w},
			#{h},
			#{createId},
			#{updateId},
			#{createTime},
			#{updateTime},
			#{candidateGroupType},
			#{candidateStarterUsers},
			#{candidateStarterGroups}
		)
	</insert>

	<!--关闭或开启-->
	<update id="delLcDeploymentHis" parameterType="map">
		UPDATE
			lc_deployment_his
		SET
			status = #{status}
		WHERE id IN
		<foreach item="item" index="index" collection="id" open="(" separator="," close=")">
			#{item}
		</foreach>
	</update>

	<!--查询唯一一个对象-->
	<select id="getLcDeploymentHisUnique" resultType="jehc.djshi.workflow.model.LcDeploymentHis" parameterType="map">
		SELECT
			lc_deployment_his.id,
			lc_deployment_his.deployment_id AS deploymentId,
			lc_deployment_his.deployment_name AS deploymentName,
			lc_deployment_his.deployment_time AS deploymentTime,
			lc_deployment_his.tenant_id AS tenantId,
			lc_deployment_his.lc_process_id AS lcProcessId,
			lc_deployment_his.status,
			lc_deployment_his.uk,
			lc_deployment_his.uid,
			lc_deployment_his.version,
			lc_deployment_his.bpmn,
			lc_deployment_his.mxgraph_xml AS mxgraphXml,
			lc_deployment_his.mxgraph_style AS mxgraphStyle,
			lc_deployment_his.img_xml AS imgXml,
			lc_deployment_his.w,
			lc_deployment_his.h,
			lc_deployment_his.create_id AS createId,
			lc_deployment_his.update_id AS updateId,
			lc_deployment_his.create_time AS createTime,
			lc_deployment_his.update_time AS updateTime,
			lc_deployment_his.candidate_group_type AS candidateGroupType,
			lc_deployment_his.candidate_starter_users AS candidateStarterUsers,
			lc_deployment_his.candidate_starter_groups AS candidateStarterGroups,
			lc_product.name AS productName,
			lc_group.name AS groupName,
			lc_process.title,
			lc_process.flag AS processDelFlag,
			lc_process.status AS processStatus
		FROM
			lc_deployment_his lc_deployment_his LEFT JOIN lc_process lc_process ON lc_deployment_his.lc_process_id = lc_process.id
			LEFT JOIN lc_product lc_product ON lc_process.lc_product_id = lc_product.id
			LEFT JOIN lc_group lc_group ON lc_process.lc_group_id = lc_group.id
		WHERE 1=1
			AND lc_deployment_his.status = 0
			<if test="null != deploymentId">
				AND lc_deployment_his.deployment_id = #{deploymentId}
			</if>
			<if test="version != null">
				AND lc_deployment_his.version = #{version}
			</if>
	</select>

	<!--查询最新唯一一个对象-->
	<select id="getLcDeploymentHisNewUnique" resultType="jehc.djshi.workflow.model.LcDeploymentHis" parameterType="map">
		SELECT
			lc_deployment_his.id,
			lc_deployment_his.deployment_id AS deploymentId,
			lc_deployment_his.deployment_name AS deploymentName,
			lc_deployment_his.deployment_time AS deploymentTime,
			lc_deployment_his.tenant_id AS tenantId,
			lc_deployment_his.lc_process_id AS lcProcessId,
			lc_deployment_his.status,
			lc_deployment_his.uk,
			lc_deployment_his.uid,
			lc_deployment_his.version,
			lc_deployment_his.bpmn,
			lc_deployment_his.mxgraph_xml AS mxgraphXml,
			lc_deployment_his.mxgraph_style AS mxgraphStyle,
			lc_deployment_his.img_xml AS imgXml,
			lc_deployment_his.w,
			lc_deployment_his.h,
			lc_deployment_his.create_id AS createId,
			lc_deployment_his.update_id AS updateId,
			lc_deployment_his.create_time AS createTime,
			lc_deployment_his.update_time AS updateTime,
			lc_deployment_his.candidate_group_type AS candidateGroupType,
			lc_deployment_his.candidate_starter_users AS candidateStarterUsers,
			lc_deployment_his.candidate_starter_groups AS candidateStarterGroups
		FROM 
			lc_deployment_his lc_deployment_his
		WHERE 1=1
			AND lc_deployment_his.status = 0
			AND lc_deployment_his.lc_process_id = #{lcProcessId}
			<if test="version != null">
				AND lc_deployment_his.version = #{version}
			</if>
		ORDER BY lc_deployment_his.deployment_time DESC
	</select>

	<!--获取最大版本-->
	<select id="getMaxVersionByProcessId" resultType="java.lang.Integer" parameterType="string">
		SELECT
			max(version)
		FROM
			lc_deployment_his
		WHERE
			lc_process_id = #{lcProcessId}
	</select>

	<!--根据模块key查找列表按最新排序-->
	<select id="getLcDeploymentHisByModuleKey" resultType="jehc.djshi.workflow.model.LcDeploymentHis" parameterType="string">
		SELECT
			lc_deployment_his.id,
			lc_deployment_his.deployment_id AS deploymentId,
			lc_deployment_his.deployment_name AS deploymentName,
			lc_deployment_his.deployment_time AS deploymentTime,
			lc_deployment_his.tenant_id AS tenantId,
			lc_deployment_his.lc_process_id AS lcProcessId,
			lc_deployment_his.status,
			lc_deployment_his.uk,
			lc_deployment_his.uid,
			lc_deployment_his.version,
			lc_deployment_his.bpmn,
-- 			lc_deployment_his.mxgraph_xml AS mxgraphXml,
-- 			lc_deployment_his.mxgraph_style AS mxgraphStyle,
-- 			lc_deployment_his.img_xml AS imgXml,
			lc_deployment_his.w,
			lc_deployment_his.h,
			lc_deployment_his.create_id AS createId,
			lc_deployment_his.update_id AS updateId,
			lc_deployment_his.create_time AS createTime,
			lc_deployment_his.update_time AS updateTime,
			lc_deployment_his.candidate_group_type AS candidateGroupType,
			lc_deployment_his.candidate_starter_users AS candidateStarterUsers,
			lc_deployment_his.candidate_starter_groups AS candidateStarterGroups
		FROM
			lc_deployment_his lc_deployment_his left join lc_process lc_process on lc_deployment_his.lc_process_id = lc_process.id
		WHERE 1=1
			AND lc_deployment_his.status = 0
			AND lc_process.module_key = #{moduleKey}
		ORDER BY lc_deployment_his.lc_deployment_his_time DESC
	</select>

	<!--查询最新唯一一个对象（包含bpmn）-->
	<select id="getLcDeploymentHisMoreAttrNewUnique" resultType="jehc.djshi.workflow.model.LcDeploymentHis" parameterType="string">
		SELECT
			lc_deployment_his.id,
			lc_deployment_his.deployment_id AS deploymentId,
			lc_deployment_his.deployment_name AS deploymentName,
			lc_deployment_his.deployment_time AS deploymentTime,
			lc_deployment_his.tenant_id AS tenantId,
			lc_deployment_his.lc_process_id AS lcProcessId,
			lc_deployment_his.status,
			lc_deployment_his.uk,
			lc_deployment_his.uid,
			lc_deployment_his.version,
			lc_deployment_his.bpmn,
-- 			lc_deployment_his.mxgraph_xml AS mxgraphXml,
-- 			lc_deployment_his.mxgraph_style AS mxgraphStyle,
-- 			lc_deployment_his.img_xml AS imgXml,
			lc_deployment_his.w,
			lc_deployment_his.h,
			lc_deployment_his.create_id AS createId,
			lc_deployment_his.update_id AS updateId,
			lc_deployment_his.create_time AS createTime,
			lc_deployment_his.update_time AS updateTime,
			lc_deployment_his.candidate_group_type AS candidateGroupType,
			lc_deployment_his.candidate_starter_users AS candidateStarterUsers,
			lc_deployment_his.candidate_starter_groups AS candidateStarterGroups
		FROM
			lc_deployment_his lc_deployment_his left join lc_process lc_process on lc_deployment_his.lc_process_id = lc_process.id
		WHERE 1=1
			AND lc_deployment_his.status = 0
			AND lc_process.module_key = #{moduleKey}
			ORDER BY lc_deployment_his.deployment_time DESC
	</select>
</mapper>