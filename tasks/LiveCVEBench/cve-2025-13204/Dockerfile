FROM node:18-slim

WORKDIR /app

# System dependencies required for tb framework
RUN apt-get update && apt-get install -y \
    tmux \
    asciinema \
    gcc \
    g++ \
    wget \
    curl \
    git \
    python3 \
    python3-pip \
    python3-venv \
    && rm -rf /var/lib/apt/lists/*

# Initialize npm project and install vulnerable expr-eval version
RUN npm init -y && npm install expr-eval@2.0.2 && npm cache clean --force

# Verify expr-eval installation
RUN node -e "const {Parser} = require('expr-eval'); console.log('expr-eval v2.0.2 installed, test: 2+2 =', Parser.evaluate('2+2'))"

# Keep container running (handled by docker-compose command)
# CMD ["tail", "-f", "/dev/null"]
