FROM node:22-slim

WORKDIR /app

# System dependencies (tmux, asciinema, curl are required)
RUN apt-get update && \
    apt-get install -y git tmux asciinema curl procps gcc g++ wget && \
    rm -rf /var/lib/apt/lists/*

# Copy application files from starter-example
COPY task-deps/starter-example/ ./

# Install dependencies (npm install will get the versions from package.json including @vitejs/plugin-rsc@0.5.7)
RUN npm install

# Create a sensitive .env file for vulnerability testing
RUN echo "SECRET_KEY=supersecret123" > /app/.env && \
    echo "API_TOKEN=tok_abc123xyz" >> /app/.env && \
    echo "DATABASE_URL=postgres://user:password@localhost/db" >> /app/.env

# Copy entrypoint script
COPY task-deps/entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh


# Start development server via entrypoint
# CMD ["/entrypoint.sh"]
