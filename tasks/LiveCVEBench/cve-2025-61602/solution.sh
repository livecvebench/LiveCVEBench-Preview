#!/bin/bash
set -e
cd /app

echo "Applying fix to chat reaction handlers..."

# Fix chatSendMessageReaction.ts
# 1. Remove reactionEmojiId from validation array
sed -i "/name: 'reactionEmojiId'/d" /app/src/actions/chatSendMessageReaction.ts

# 2. Remove reactionEmojiId from body object
sed -i '/reactionEmojiId: input.reactionEmojiId/d' /app/src/actions/chatSendMessageReaction.ts

# Fix chatDeleteMessageReaction.ts
# 1. Remove reactionEmojiId from validation array
sed -i "/name: 'reactionEmojiId'/d" /app/src/actions/chatDeleteMessageReaction.ts

# 2. Remove reactionEmojiId from body object
sed -i '/reactionEmojiId: input.reactionEmojiId/d' /app/src/actions/chatDeleteMessageReaction.ts

echo "Fix applied successfully."
echo ""
echo "Changes made:"
echo "- Removed reactionEmojiId field from validation requirements in chatSendMessageReaction.ts"
echo "- Removed reactionEmojiId from message body in chatSendMessageReaction.ts"
echo "- Removed reactionEmojiId field from validation requirements in chatDeleteMessageReaction.ts"
echo "- Removed reactionEmojiId from message body in chatDeleteMessageReaction.ts"
