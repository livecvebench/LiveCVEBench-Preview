instruction: |-
  I discovered a Stored Cross-Site Scripting (XSS) vulnerability (CWE-79) in WeGIA's 
  document type management feature.

  The endpoint `/html/funcionario/dependente_docdependente.php` accepts a `nome` 
  parameter for creating document types but does not sanitize the input. The malicious 
  payload is stored in the database and later rendered without encoding on the 
  dependent profile page.

  Here's how I exploited this vulnerability:

    # Step 1: Inject XSS payload as document type name
    curl -X POST "http://target/html/funcionario/dependente_docdependente.php" \
         -b "PHPSESSID=xxx" \
         -d "action=adicionar&nome=<script>alert('XSS')</script>"
    
    # Step 2: Visit profile page - JavaScript executes in browser
    # GET /html/funcionario/profile_dependente.php?id_dependente=1

  The vulnerable code in `profile_dependente.php` line 602:

    echo ("<option value='" . $item["id_docdependentes"] . "' >" . 
          $item["nome_docdependente"] . "</option>");
    // nome_docdependente is NOT escaped!

  Attack vectors I verified:
  - Script tags: `<script>alert(1)</script>`
  - Event handlers: `<img src=x onerror="alert(1)">`
  - SVG: `<svg onload="alert(1)">`

  This allows attackers to:
  1. Steal session cookies and hijack admin accounts
  2. Perform actions on behalf of other users
  3. Deface the application interface

  The fix should use `htmlspecialchars()` for all user-provided data when 
  rendering in HTML context.

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: security
tags:
  - php
  - stored-xss
  - cwe-79
  - output-encoding
  - web-security
parser_name: pytest

run_tests_in_same_shell: false
max_test_timeout_sec: 180
