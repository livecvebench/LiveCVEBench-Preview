#!/bin/bash
set -e

# Fix the SQL injection vulnerability in check.php by replacing the
# vulnerable query with a prepared statement

cat > /var/www/html/check.php << 'EOF'
<?php
	require_once 'admin/connect.php';
	$student = $_POST['student'];
	// Input validation: ensure student ID is numeric only
	if (!isset($student) || !ctype_digit($student)) {
		echo 'Error';
		exit;
	}
	$stmt = $conn->prepare("SELECT * FROM `student` WHERE `student_no` = ?");
	$stmt->bind_param("i", $student);
	$stmt->execute();
	$result = $stmt->get_result();
	$v_student = $result->num_rows;
	if($v_student > 0){
		echo 'Success';
	}else{
		echo 'Error';
	}
EOF

echo "Fix applied successfully"
