FROM python:3.10-slim

WORKDIR /app

# Environment variables
ENV PYTHONUNBUFFERED=1

# System dependencies (tmux, asciinema, curl are required)
RUN apt-get update && apt-get install -y \
    git \
    tmux \
    asciinema \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Install PyTorch 2.6.0 (CPU version is sufficient for testing the fix)
# The vulnerability is in Python code (torch/cuda/nccl.py) - input validation
# CPU version allows testing the fix without requiring CUDA GPU
# First install typing-extensions from PyPI (torch wheel index has broken metadata for this package)
RUN pip install --no-cache-dir typing-extensions>=4.10.0 && \
    pip install --no-cache-dir torch==2.6.0 --index-url https://download.pytorch.org/whl/cpu

# Install testing dependencies
RUN pip install --no-cache-dir pytest pytest-timeout

# Keep container running for interactive testing
CMD ["tail", "-f", "/dev/null"]
