cat <<'EOF' > /workspace/fix.patch
diff --git a/lib/index.js b/lib/index.js
index b806431..fe5a052 100644
--- a/lib/index.js
+++ b/lib/index.js
@@ -32,18 +32,27 @@ import normalizeUrl from "normalize-url";
  *    - `search` (String): The url querystring value.
  *    - `href` (String): The input url.
  *    - `query` (Object): The url querystring, parsed as object.
+ *    - `parse_failed` (Boolean): Whether the parsing failed or not.
  */
 const parseUrl = (url, normalize = false) => {
 
     // Constants
     const GIT_RE = /(^(git@|http(s)?:\/\/)([\w\.\-@]+)(\/|:))(([\~,\.\w,\-,\_,\/]+)(.git){0,1}((\/){0,1}))/
 
-    if (typeof url !== "string" || !url.trim()) {
-        const err = new Error("Invalid url.")
+    const throwErr = msg => {
+        const err = new Error(msg)
         err.subject_url = url
         throw err
     }
 
+    if (typeof url !== "string" || !url.trim()) {
+        throwErr("Invalid url.")
+    }
+
+    if (url.length > parseUrl.MAX_INPUT_LENGTH) {
+        throwErr("Input exceeds maximum length. If needed, change the value of parseUrl.MAX_INPUT_LENGTH.")
+    }
+
     if (normalize) {
         if (typeof normalize !== "object") {
             normalize = {
@@ -56,7 +65,7 @@ const parseUrl = (url, normalize = false) => {
     const parsed = parsePath(url)
 
     // Potential git-ssh urls
-    if (parsed.protocol === "file") {
+    if (parsed.parse_failed) {
         const matched  = parsed.href.match(GIT_RE)
         if (matched) {
             parsed.protocols = ["ssh"]
@@ -65,10 +74,15 @@ const parseUrl = (url, normalize = false) => {
             parsed.host = matched[4]
             parsed.user = "git"
             parsed.pathname = `/${matched[6]}`
+            parsed.parse_failed = false
+        } else {
+            throwErr("URL parsing failed.")
         }
     }
 
     return parsed;
 }
 
+parseUrl.MAX_INPUT_LENGTH = 2048
+
 export default parseUrl;
 

EOF

cd /workspace/parse-url
git apply --whitespace=nowarn  /workspace/fix.patch