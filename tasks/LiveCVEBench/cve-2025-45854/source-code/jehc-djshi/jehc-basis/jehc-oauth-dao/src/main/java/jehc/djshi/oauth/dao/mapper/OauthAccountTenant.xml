<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.oauth.dao.OauthAccountTenantDao">

    <!--初始化分页-->
    <select id="getOauthAccountTenantList" resultType="jehc.djshi.oauth.model.OauthAccountTenant" parameterType="jehc.djshi.oauth.param.OauthAccountTenantParam">
        SELECT
            oauth_account_tenant.id,
            oauth_account_tenant.account,
            oauth_account_tenant.tenant_id AS tenantId,
            oauth_account_tenant.account_type_id AS accountTypeId,
            oauth_account_tenant.sys_mode_id AS sysModeId,
            oauth_account_tenant.create_time AS createTime,
            oauth_account_tenant.update_time AS updateTime,
            oauth_account_tenant.create_id AS createId,
            oauth_account_tenant.update_id AS updateId,
            oauth_tenant.name,
            oauth_tenant.code,
            oauth_sys_mode.name AS sysName
        FROM
            oauth_account_tenant oauth_account_tenant LEFT JOIN oauth_sys_mode oauth_sys_mode ON oauth_account_tenant.sys_mode_id = oauth_sys_mode.id
            LEFT JOIN oauth_tenant oauth_tenant ON oauth_account_tenant.tenant_id = oauth_tenant.id
        WHERE 1=1
        <if test="null != account">
            AND oauth_account_tenant.account = #{account}
        </if>
        <if test="null != sysModeId">
            AND oauth_account_tenant.sys_mode_id = #{sysModeId}
        </if>
        <if test="null != accountTypeId">
            AND oauth_account_tenant.account_type_id = #{accountTypeId}
        </if>
    </select>

    <!--添加-->
    <insert id="addOauthAccountTenant" parameterType="jehc.djshi.oauth.model.OauthAccountTenant">
        INSERT INTO
            oauth_account_tenant
        (
            id,
            account,
            tenant_id,
            account_type_id,
            sys_mode_id,
            create_time,
            update_time,
            create_id,
            update_id
        )
        VALUES
        (
            #{id},
            #{account},
            #{tenantId},
            #{accountTypeId},
            #{sysModeId},
            #{createTime},
            #{updateTime},
            #{createId},
            #{updateId}
        )
    </insert>

    <!--根据账号删除-->
    <delete id="delOauthAccountTenantByAccount" parameterType="string">
        DELETE FROM oauth_account_tenant WHERE account = #{account}
    </delete>

    <!--删除-->
    <delete id="delOauthAccountTenant" parameterType="map">
        DELETE FROM  oauth_account_tenant WHERE id IN
        <foreach item="item" index="index" collection="id" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>

    <!--统计绑定租户-->
    <select id="getOauthAccountTenantCount" resultType="int" parameterType="jehc.djshi.oauth.param.OauthAccountTenantParam">
        SELECT
            COUNT(0)
        FROM
        oauth_account_tenant oauth_account_tenant LEFT JOIN oauth_sys_mode oauth_sys_mode ON oauth_account_tenant.sys_mode_id = oauth_sys_mode.id
        LEFT JOIN oauth_tenant oauth_tenant ON oauth_account_tenant.tenant_id = oauth_tenant.id
        WHERE 1=1
        <if test="null != account">
            AND oauth_account_tenant.account = #{account}
        </if>
        <if test="null != sysModeId">
            AND oauth_account_tenant.sys_mode_id = #{sysModeId}
        </if>
        <if test="null != accountTypeId">
            AND oauth_account_tenant.account_type_id = #{accountTypeId}
        </if>
        <if test="null != tenantId">
            AND oauth_account_tenant.tenant_id = #{tenantId}
        </if>
        <if test="null != batchTenantId">
            AND oauth_account_tenant.tenant_id IN
            <foreach item="item" index="index" collection="batchTenantId" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
    </select>

    <!--根据账号，类型删除-->
    <delete id="delOauthAccountTenantByAccountAndType" parameterType="jehc.djshi.oauth.param.OauthAccountTenantParam">
        DELETE FROM oauth_account_tenant
        WHERE account = #{account}
        AND account_type_id IN
        <foreach item="item" index="index" collection="batchAccountTypeId" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>

    <!--根据子系统删除-->
    <delete id="delOauthAccountTenantBySysModeId" parameterType="jehc.djshi.oauth.param.OauthAccountTenantParam">
        DELETE FROM oauth_account_tenant
        WHERE sys_mode_id IN
        <foreach item="item" index="index" collection="batchSysModeId" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
</mapper>