FROM php:7.4-apache

WORKDIR /var/www/html

# Install mysqli extension and required tools
RUN docker-php-ext-install mysqli

# Install required system packages (tmux, asciinema, curl required by spec)
RUN apt-get update && apt-get install -y git tmux asciinema curl && rm -rf /var/lib/apt/lists/*

# Copy application source
COPY task-deps/OnlineMovieStreaming-master/ /var/www/html/

# Create upload directories
RUN mkdir -p /var/www/html/uploads /var/www/html/video-uploads && \
    chown -R www-data:www-data /var/www/html && \
    chmod -R 755 /var/www/html/uploads /var/www/html/video-uploads

# Update database connection file for Docker environment
COPY task-deps/dbh.php /var/www/html/backend/dbh.php

# Configure PHP for uploads
COPY task-deps/uploads.ini /usr/local/etc/php/conf.d/uploads.ini
EXPOSE 80

# CMD ["apache2-foreground"]
