FROM node:20-slim

WORKDIR /app


# System dependencies (tmux, asciinema, curl are required, plus python for tests)
RUN apt-get update && apt-get install -y \
    git \
    tmux \
    asciinema \
    curl \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Create minimal package.json for npm install
RUN echo '{\n  "name": "cve-2025-54798-test",\n  "version": "1.0.0",\n  "dependencies": {\n    "tmp": "0.2.3"\n  }\n}' > package.json

# Install the vulnerable tmp version
RUN npm install


# Ensure /tmp exists and is writable (should be default, but explicit for clarity)
RUN mkdir -p /tmp && chmod 1777 /tmp