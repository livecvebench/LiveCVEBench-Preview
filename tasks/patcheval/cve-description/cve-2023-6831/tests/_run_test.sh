#!/bin/bash
set -e

cd /app/mlflow
git apply --whitespace=nowarn /tests/test.patch
/app/PoC_env/CVE-2023-6831/bin/python -m pytest tests/server/test_handlers.py::test_delete_artifact_mlflow_artifacts_throws_for_malicious_path tests/store/artifact/test_http_artifact_repo.py::test_list_artifacts_malicious_path tests/utils/test_uri.py::test_validate_path_is_safe_bad -p no:warning --disable-warnings
/app/PoC_env/CVE-2023-6831/bin/python -m pytest tests/server/test_handlers.py tests/store/artifact/test_http_artifact_repo.py tests/utils/test_uri.py -k "not test_mlflow_server_with_installed_plugin and not test_list_artifacts_malicious_path" -p no:warning --disable-warnings

