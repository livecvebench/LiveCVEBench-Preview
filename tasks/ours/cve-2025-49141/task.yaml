instruction: |-
  This is a HAXcms PHP application that provides site management functionality.
  The application has a REST API endpoint that allows importing sites from Git repositories.

  When I send a POST request to `/system/api?op=gitImportSite` with a malicious
  Git URL like:
  `{"site": {"git": {"url": "http://attacker.com/repo.git;touch /tmp/pwned"}}}`

  The server executes the injected shell command (`touch /tmp/pwned`) instead of
  just cloning the repository. The file `/tmp/pwned` is created on the server,
  proving arbitrary command execution.

  The application performs basic validation:
  - Checks if the URL is valid using `filter_var(FILTER_VALIDATE_URL)`
  - Checks if the URL contains ".git" substring

  However, these checks don't prevent shell metacharacters (`;`, `$()`, backticks)
  from being injected. The URL is then passed unsanitized to `Git::set_remote()`,
  which builds a shell command: `git remote add origin $url`

  Expected behavior:
  - Invalid or suspicious URLs should return a validation error
  - User input should be properly escaped with `escapeshellarg()` before shell execution
  - Only legitimate git operations should be performed

difficulty: medium
category: security
tags:
  - php
  - command-injection
  - haxcms
  - git
  - input-validation
  - shell-escape
parser_name: pytest

run_tests_in_same_shell: false
