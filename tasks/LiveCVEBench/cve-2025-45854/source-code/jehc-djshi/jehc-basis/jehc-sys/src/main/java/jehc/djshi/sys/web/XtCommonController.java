package jehc.djshi.sys.web;

import com.github.pagehelper.util.StringUtil;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import jehc.djshi.common.annotation.Auth;
import jehc.djshi.common.entity.*;
import jehc.djshi.common.util.FastJsonUtils;
import jehc.djshi.common.base.BaseAction;
import jehc.djshi.common.base.BaseResult;
import jehc.djshi.common.base.CommonUtils;
import jehc.djshi.sys.model.XtConstant;
import jehc.djshi.sys.service.XtConstantService;
import org.springframework.web.bind.annotation.*;
import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import java.util.*;
/**
 * @Desc 通用
 * @Author 邓纯杰
 * @CreateTime 2012-12-12 12:12:12
 */
@RestController
@RequestMapping("/xtCommon")
@Api(value = "通用API",tags = "通用API",description = "通用API")
public class XtCommonController extends BaseAction {

	@Resource
    CommonUtils commonUtils;

	@Resource
	XtConstantService xtConstantService;

	/**
	 * 查询字典集合（根据cnKey）
	 * @param cnKey
	 * @return
	 */
	@ApiOperation(value="获取字典集合（根据cnKey）", notes="获取字典集合（根据cnKey）")
	@GetMapping(value="/xtDataDictionary/list/{cnKey}")
	@Auth(value = "/xtCommon/xtDataDictionary/list",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public BaseResult getXtDataDictionaryList(@PathVariable("cnKey")String cnKey){
		return outItemsStr(commonUtils.getXtDataDictionaryCache(cnKey));
	}

	/**
	 * 全部路径
	 * @return
	 */
	@ApiOperation(value="查询全部路径", notes="查询全部路径")
	@GetMapping(value="/path/list")
	@Auth(value = "/xtCommon/path/list",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public BaseResult pathList(String key){
		List<PathEntity> pathList = commonUtils.getXtPathCache(key);
		return new BaseResult(FastJsonUtils.toJSONString(pathList));
	}

	/**
	 * 读取所有省份
	 * @return
	 */
	@ApiOperation(value="查询全部省份", notes="查询全部省份")
	@GetMapping(value="/pList")
	@Auth(value = "/xtCommon/pList",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public BaseResult getPList(){
		List<AreaRegionEntity> list = commonUtils.getXtAreaRegionCache(null);
		return outItemsStr(list);
	}

	/**
	 * 读取城市
	 * @return
	 */
	@ApiOperation(value="查询全部城市", notes="查询全部城市")
	@GetMapping(value="/cList/{parentId}")
	@Auth(value = "/xtCommon/cList",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public BaseResult getCList(@PathVariable("parentId") String parentId){
		List<AreaRegionEntity> list = new ArrayList<AreaRegionEntity>();
		if(StringUtil.isEmpty(parentId)){
			return outItemsStr(list);
		}
		list = commonUtils.getXtAreaRegionCache(parentId);
		return outItemsStr(list);
	}

	/**
	 * 读取区县
	 * @return
	 */
	@ApiOperation(value="查询全部区县", notes="查询全部区县")
	@GetMapping(value="/dList/{parentId}")
	@Auth(value = "/xtCommon/dList",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public BaseResult getDList(@PathVariable("parentId") String parentId){
		List<AreaRegionEntity> list = new ArrayList<AreaRegionEntity>();
		if(StringUtil.isEmpty(parentId)){
			return outItemsStr(list);
		}
		list = commonUtils.getXtAreaRegionCache(parentId);
		return outItemsStr(list);
	}

	/**
	 * 根据Key查询常量
	 * @param key
	 * @return
	 */
	@ApiOperation(value="根据Key查询常量", notes="根据Key查询常量")
	@GetMapping(value="/constantByKey/{key}")
	@Auth(value = "/xtCommon/constantByKey",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public ConstantEntity getConstantCache(@PathVariable("key") String key){
		return commonUtils.getXtConstantCache(key);
	}

	/**
	 * 根据Id查询常量
	 * @param id
	 * @return
	 */
	@ApiOperation(value="根据Id查询常量", notes="根据Id查询常量")
	@GetMapping(value="/constant/{id}")
	@Auth(value = "/xtCommon/constant",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public XtConstant getConstant(@PathVariable("id") String id){
		if(StringUtil.isEmpty(id)){
			return new XtConstant();
		}
		XtConstant xtConstant = xtConstantService.getXtConstantById(id);
		return xtConstant;
	}

	/**
	 * 获取全部公共功能 通过缓存获取
	 * @param request
	 * @return
	 */
	@ApiOperation(value="查询全部功能", notes="查询全部功能")
	@GetMapping(value="/functioninfoCommon/list")
	@Auth(value = "/xtCommon/functioninfoCommon/list",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public String getConstant(HttpServletRequest request){
		return commonUtils.getXtFunctioninfoCommonCache();
	}

	/**
	 * 判断IP是否为黑户
	 * @param ip
	 * @return
	 */
	@ApiOperation(value="判断IP是否为黑户", notes="判断IP是否为黑户")
	@GetMapping(value="/ipFrozen/validate/{ip}")
	@Auth(value = "/xtCommon/ipFrozen/validate",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public boolean validateIp(@PathVariable("ip") String ip){
		return commonUtils.getXtIpFrozenCache(ip);
	}

	/**
	 * 根据KEY获取平台字典
	 * @param key
	 * @return
	 */
	@ApiOperation(value="根据KEY获取平台字典", notes="根据KEY获取平台字典")
	@GetMapping(value="/dataDictionary/list/{key}")
	@Auth(value = "/xtCommon/dataDictionary/list",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public List<DataDictionaryEntity> getXtDataDictionaryCache(@PathVariable("key") String key) {
		return commonUtils.getXtDataDictionaryCache(key);
	}

	/**
	 * 根据KEY获取平台路径
	 * @param key
	 * @return
	 */
	@ApiOperation(value="根据KEY获取平台路径", notes="根据KEY获取平台路径")
	@GetMapping(value="/path/list/{key}")
	@Auth(value = "/xtCommon/path/list",authenticationType = Auth.AuthorizationType.NOT_REQUIRED_LOGIN)
	public List<PathEntity> getXtPathCache(@PathVariable("key") String key) {
		return commonUtils.getXtPathCache(key);
	}
}
