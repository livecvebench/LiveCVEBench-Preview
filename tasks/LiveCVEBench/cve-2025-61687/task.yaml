instruction: |-
  I discovered an Unrestricted File Upload vulnerability in FlowiseAI Flowise,
  a drag-and-drop UI for building LLM flows.

  The `/api/v1/attachments/:chatflowId/:chatId` endpoint allows uploading files
  to chat conversations. However, I found several security issues:

  1. The `chatflowId` and `chatId` URL parameters accept arbitrary strings instead
     of valid UUID format. This allows attackers to manipulate the storage path.

  2. Path traversal sequences (like `..`, `%2e%2e`, `%2f`) in the parameters are
     not sanitized, potentially allowing files to be written outside the intended
     directory structure.

  3. The endpoint accepts uploads even when the referenced chatflow doesn't exist
     in the database, leading to orphaned files and potential abuse.

  4. Dangerous file types (`.js`, `.sh`, `.py`) can be uploaded without restriction.

  For example, sending a POST request with `chatflowId=../../etc` could potentially
  write files to unintended locations on the server.

  Expected behavior:
  - The `chatflowId` and `chatId` parameters should only accept valid UUID v4 format
  - Any path traversal attempts should be rejected with a 400 Bad Request response
  - Uploads to non-existent chatflows should return 404 Not Found
  - All path segments used in file storage should be properly sanitized

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: security
tags:
  - path-traversal
  - unrestricted-file-upload
  - input-validation
  - file-upload
  - nodejs
  - typescript
  - api
parser_name: pytest

run_tests_in_same_shell: false
