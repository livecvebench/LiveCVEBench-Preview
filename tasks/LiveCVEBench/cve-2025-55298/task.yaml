instruction: |-
  This application is ImageMagick, a widely-used image processing toolkit that
  supports reading, writing, and manipulating images in many formats.

  When processing filenames containing format specifiers (like %d for sequences),
  the InterpretImageFilename function improperly handles certain format string
  combinations. Specifically, when a filename contains format specifiers followed
  by additional percent characters (e.g., filenames like "%o%n" or "%d%n"), the
  application crashes or becomes unresponsive.

  For example, running:
    mogrify '%o%n'

  Results in a segmentation fault or heap corruption error, whereas we expect the
  application to either process the filename safely or return an appropriate error
  message without crashing.

  The issue appears to be in how the format string is passed to internal formatting
  functions - user-provided format specifiers should be validated and sanitized
  before being used. Valid format specifiers (%d, %o, %x with optional width) should
  work normally, while invalid or potentially dangerous specifiers should be treated
  as literal text.

difficulty: hard
category: bug-fix
tags:
  - imagemagick
  - format-string
  - input-validation
  - c
parser_name: pytest

run_tests_in_same_shell: false
