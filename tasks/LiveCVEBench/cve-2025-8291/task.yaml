instruction: |-
  This is a Python application that uses Python's standard zipfile module to process
  ZIP archives, including large ZIP64 format archives that exceed the 4GB size limit.

  Users have reported that the application accepts certain malformed ZIP64 files that
  other ZIP tools reject. Specifically, when a ZIP64 archive has inconsistent internal
  metadata (where the End of Central Directory offset values don't match the actual
  file layout), Python's zipfile module silently accepts these files while other
  compliant tools (like 7-Zip, unzip, etc.) report corruption errors.

  The issue manifests in two ways:
  1. `zipfile.ZipFile()` successfully opens archives with mismatched offset/size fields
     in the ZIP64 End of Central Directory structures, when it should raise an error.
  2. `zipfile.is_zipfile()` returns True for such corrupted archives when it should
     return False.

  For example, when opening a ZIP64 archive where the "offset to ZIP64 EOCD" field
  in the locator record doesn't point to the actual record location, Python opens
  the file without any error - but it should detect this inconsistency and raise
  a BadZipFile exception.

  We need the zipfile module to properly validate that:
  - The offset in the ZIP64 EOCD Locator points to the correct location
  - The size field in the ZIP64 EOCD record is consistent with the file layout
  - Invalid/corrupted ZIP64 archives are rejected with appropriate error messages

  Normal, valid ZIP and ZIP64 archives should continue to work correctly.

difficulty: medium
category: bug-fix
tags:
  - python
  - zipfile
  - zip64
  - validation
  - parsing
parser_name: pytest

run_tests_in_same_shell: false
