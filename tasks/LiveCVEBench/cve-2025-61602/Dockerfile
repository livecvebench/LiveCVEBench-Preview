FROM node:20

WORKDIR /app

# System dependencies (required: tmux, asciinema, curl)
RUN apt-get update && apt-get install -y git tmux asciinema curl && rm -rf /var/lib/apt/lists/*

# Create directory structure for the project
RUN mkdir -p /app/src/actions /app/src/imports /app/src/types

# Copy package.json and tsconfig.json
COPY task-deps/package.json /app/package.json
COPY task-deps/tsconfig.json /app/tsconfig.json

# Install dependencies
RUN npm install

# Copy source files from task-deps to their proper locations
COPY task-deps/chatSendMessageReaction_v3.0.12.ts /app/src/actions/chatSendMessageReaction.ts
COPY task-deps/chatDeleteMessageReaction_v3.0.12.ts /app/src/actions/chatDeleteMessageReaction.ts
COPY task-deps/validation.ts /app/src/imports/validation.ts
COPY task-deps/emojiValidation.ts /app/src/imports/emojiValidation.ts
COPY task-deps/types_index.ts /app/src/types/index.ts
COPY task-deps/ValidationError.ts /app/src/types/ValidationError.ts

# Container stays alive for testing - no running service needed
CMD ["tail", "-f", "/dev/null"]
