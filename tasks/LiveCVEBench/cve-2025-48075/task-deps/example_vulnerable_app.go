package main

import (
	"log"

	"github.com/gofiber/fiber/v2"
)

// RequestBody demonstrates the vulnerable struct pattern
type RequestBody struct {
	NestedContent []*struct {
		Value string `form:"value"`
	} `form:"nested-content"`
}

func main() {
	app := fiber.New()

	// Vulnerable endpoint that uses BodyParser
	app.Post("/", func(c *fiber.Ctx) error {
		subject := new(RequestBody)

		// This will panic if a negative index is provided in v2.52.6
		// In v2.52.7+, it will return an error instead
		if err := c.BodyParser(subject); err != nil {
			return c.Status(fiber.StatusUnprocessableEntity).JSON(fiber.Map{
				"error": err.Error(),
			})
		}

		return c.JSON(fiber.Map{
			"message": "Success",
			"data":    subject,
		})
	})

	log.Fatal(app.Listen(":3000"))
}
