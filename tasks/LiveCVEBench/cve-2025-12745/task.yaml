instruction: |-
  QuickJS is a small and embeddable JavaScript engine. I'm using it to run
  JavaScript code in my application.

  I discovered a crash when running code that uses ArrayBuffer.prototype.slice()
  with a custom Symbol.species constructor that modifies the source buffer.

  Here's a minimal example that crashes:

  ```javascript
  let buf = new ArrayBuffer(1000, { maxByteLength: 2000 });
  Object.defineProperty(buf.constructor, Symbol.species, {
      value: function(len) {
          buf.resize(100);
          return new ArrayBuffer(len);
      }
  });
  buf.slice(500, 1000);
  ```

  When I run this with QuickJS built with AddressSanitizer, I get a heap-buffer-
  overflow error. Without ASAN, the engine continues but may have read memory
  it shouldn't have.

  I think the problem is related to the buffer being resized while slice() is
  still operating on it, but the engine doesn't detect this condition properly.

  Expected behavior: The engine should throw a TypeError when the buffer has
  been resized to a size that makes the slice range invalid, rather than
  attempting to read out-of-bounds memory.

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: security
tags:
  - memory-safety
  - buffer-overflow
  - javascript-engine
  - arraybuffer
parser_name: pytest

run_tests_in_same_shell: false
