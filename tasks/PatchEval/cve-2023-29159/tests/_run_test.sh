#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2023-29159:latest
# bash /workspace/fix-run.sh
set -e

cd /workspace/starlette
git apply --whitespace=nowarn /tests/test.patch 
/workspace/PoC_env/CVE-2023-29159/bin/python -m pytest tests/test_staticfiles.py::test_staticfiles_avoids_path_traversal tests/test_staticfiles.py::test_staticfiles_with_pathlib

cd /workspace
#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2023-29159:latest
# bash /workspace/unit_test.sh
set -e

cd /workspace/starlette
/workspace/PoC_env/CVE-2023-29159/bin/python -m pytest tests/test_staticfiles.py -v -k "not test_staticfiles_with_invalid_dir_permissions_returns_401" 