#!/bin/bash
# Start langflow in background
/app/.venv/bin/langflow run --host 0.0.0.0 --port 7860 &

# Monitor for restart signal
while true; do
    if [ -f /tmp/need_restart ]; then
        rm -f /tmp/need_restart
        echo "[WRAPPER] Restart signal detected, killing all langflow processes..."
        pkill -9 -f "langflow" || true
        sleep 3
        echo "[WRAPPER] Starting fresh langflow instance..."
        /app/.venv/bin/langflow run --host 0.0.0.0 --port 7860 &
        echo "[WRAPPER] Langflow restarted"
    fi
    sleep 2
done
