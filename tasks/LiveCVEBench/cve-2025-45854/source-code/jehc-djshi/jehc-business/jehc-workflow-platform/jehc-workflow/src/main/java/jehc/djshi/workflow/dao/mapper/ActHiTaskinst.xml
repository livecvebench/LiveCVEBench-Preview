<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.workflow.dao.ActHiTaskinstDao">

    <!--根据流程定义统计流程任务运行平均时间-->
    <select id="getActHiTaskInstAvgTime" resultType="string" parameterType="string">
        SELECT
            AVG(TIME_TO_SEC(TIMEDIFF(END_TIME_, START_TIME_)))/3600 AS tCount
        FROM
            act_hi_taskinst
        WHERE
            END_TIME_ != ''
            AND PROC_DEF_ID_ = #{proc_def_id}
        GROUP BY PROC_DEF_ID_
    </select>

    <!--更新-->
    <update id="updateActHiTaskInst" parameterType="jehc.djshi.workflow.model.ActHiTaskinst">
        UPDATE
          act_hi_taskinst
        <set>
            <if test="null != procDefId and '' != procDefId">
                PROC_DEF_ID_ = #{procDefId},
            </if>
            <if test="null != taskDefKey and '' != taskDefKey">
                TASK_DEF_KEY_ = #{taskDefKey},
            </if>

            <if test="null != procInstId and '' != procInstId">
                PROC_INST_ID_ = #{procInstId},
            </if>

            <if test="null != executionId and '' != executionId">
                EXECUTION_ID_ = #{executionId},
            </if>
        </set>
        WHERE ID_=#{id}
    </update>

    <!--更新该任务为未完成-->
    <update id="updateActHiTaskInstEndTime" parameterType="map">
        UPDATE
          ACT_HI_TASKINST
        SET
          END_TIME_=#{endTime}
        WHERE ID_=#{id}
    </update>
</mapper>