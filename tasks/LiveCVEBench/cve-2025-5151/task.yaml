instruction: |-
  This application provides a data analysis service that allows users to run Python
  code for analyzing database query results. The code is executed in the
  `execute_analysis_code_safely` function located in `backend/tools/analysis_tools.py`.

  Users have reported that despite the function name suggesting safe execution, the
  code interpreter accepts arbitrary Python code without proper validation. Specifically:

  1. The function allows pandas to read files from anywhere on the filesystem. For
     example, when analysis code contains `pd.read_csv('/etc/passwd', ...)`, it
     successfully reads the system file contents instead of returning an error.

  2. Functions like `eval()`, `exec()`, and `open()` can be called directly within
     submitted code, allowing execution of arbitrary operations.

  3. The execution namespace provides full access to Python's built-in functions,
     which could be used to import additional modules or access system resources.

  The expected behavior is that the code execution environment should:
  - Block direct calls to dangerous built-in functions (eval, exec, open, __import__)
  - Prevent access to sensitive filesystem paths (like /etc/)
  - Restrict imports to only allowed data analysis libraries (pandas, numpy, scipy, etc.)
  - Provide only a safe subset of Python built-ins

  The function should gracefully reject dangerous operations with clear error messages
  rather than executing them.

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: security
tags:
  - python
  - code-execution
  - input-validation
  - sandboxing
parser_name: pytest

run_tests_in_same_shell: false
