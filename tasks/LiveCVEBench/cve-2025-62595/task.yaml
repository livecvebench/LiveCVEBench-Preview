instruction: |-
  This application is a Koa.js web server that provides various endpoints.

  The redirect functionality has a bug: when using `ctx.redirect('back')` to redirect
  users to their previous page (via the Referer header), certain URL formats bypass
  the origin validation check.

  When a request is made with specific types of URLs in the Referer header (those that
  look like relative paths but are actually interpreted differently by browsers), the
  server returns a redirect response that sends users to unintended external locations
  instead of staying on the same origin.

  For example, when a referrer URL begins with certain characters that the code assumes
  indicate a relative path, the validation is skipped entirely. This means the redirect
  destination is not properly verified to be on the same host.

  We expect that all redirect destinations returned by `ctx.redirect('back')` should be
  validated to ensure they belong to the same origin. If the referrer is from a different
  origin or is malformed, the redirect should fall back to a safe default (like '/' or
  the provided alternative URL).

  The issue is in the `_getBackReferrer` method in `lib/response.js`.

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: security
tags:
  - javascript
  - koa
  - redirect
  - url-validation
parser_name: pytest

run_tests_in_same_shell: false
