<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.oauth.dao.OauthAccountTypeDao">

    <!--初始化分页-->
    <select id="getOauthAccountTypeList" resultType="jehc.djshi.oauth.model.OauthAccountType" parameterType="map">
        SELECT
            oauth_account_type.id,
            oauth_account_type.sys_mode_id AS sysModeId,
            oauth_account_type.name,
            oauth_account_type.at_key AS atKey,
            oauth_account_type.content,
            oauth_account_type.status,
            oauth_sys_mode.name AS sysName,
            oauth_account_type.create_id AS createId,
            oauth_account_type.update_id AS updateId,
            oauth_account_type.create_time AS createTime,
            oauth_account_type.update_time AS updateTime
        FROM
          oauth_account_type oauth_account_type LEFT JOIN oauth_sys_mode oauth_sys_mode ON oauth_sys_mode.id= oauth_account_type.sys_mode_id
        WHERE 1=1
        <if test="null != name">
            AND oauth_account_type.name LIKE CONCAT(CONCAT('%',#{name}),'%')
        </if>
        <if test="null != atKey">
            AND oauth_account_type.at_key = #{atKey}
        </if>
        <if test="null != sysModeId">
            AND oauth_account_type.sys_mode_id = #{sysModeId}
        </if>
        <if test="null != id">
            AND oauth_account_type.id IN
            <foreach item="item" index="index" collection="id.split(',')" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
    </select>

    <!--查询对象-->
    <select id="getOauthAccountTypeById" resultType="jehc.djshi.oauth.model.OauthAccountType" parameterType="string">
        SELECT
            oauth_account_type.id,
            oauth_account_type.sys_mode_id AS sysModeId,
            oauth_account_type.name,
            oauth_account_type.at_key AS atKey,
            oauth_account_type.content,
            oauth_account_type.status,
            oauth_sys_mode.name AS sysName,
            oauth_account_type.create_id AS createId,
            oauth_account_type.update_id AS updateId,
            oauth_account_type.create_time AS createTime,
            oauth_account_type.update_time AS updateTime
        FROM
          oauth_account_type oauth_account_type LEFT JOIN oauth_sys_mode oauth_sys_mode ON oauth_sys_mode.id= oauth_account_type.sys_mode_id
        WHERE oauth_account_type.id=#{id}
    </select>

    <!--添加-->
    <insert id="addOauthAccountType" parameterType="jehc.djshi.oauth.model.OauthAccountType">
        INSERT INTO
        oauth_account_type
        (
        id,
        sys_mode_id,
        name,
        keyname,
        content,
        status,
        create_id,
        update_id,
        create_time,
        update_time
        )
        VALUES
        (
        #{id},
        #{sysModeId},
        #{name},
        #{atKey},
        #{content},
        #{status},
        #{createId},
        #{updateId},
        #{createTime},
        #{updateTime}
        )
    </insert>

    <!--修改-->
    <update id="updateOauthAccountType" parameterType="jehc.djshi.oauth.model.OauthAccountType">
        UPDATE
        oauth_account_type
        <set>
            <if test="sysModeId != null">
                sys_mode_id = #{sysModeId},
            </if>
            <if test="name != null">
                name = #{name},
            </if>
            <if test="atKey != null">
                at_key = #{atKey},
            </if>
            <if test="null != content">
                content =  #{content},
            </if>
            <if test="null != status">
                status =  #{status},
            </if>
            update_id = #{updateId},
            update_time = #{updateTime}
        </set>
        WHERE id=#{id}
    </update>

    <!-- 删除 -->
    <update id="delAccountType"  parameterType="jehc.djshi.oauth.model.OauthAccountType">
        UPDATE
          oauth_account_type
        SET status =1
        WHERE id=#{id}
    </update>


    <!--根据角色获取当前系统中隶属于其账户类型-->
    <select id="getAccountTypeListByRoleId" resultType="jehc.djshi.oauth.model.OauthAccountType"  parameterType="map">
        SELECT
            oauth_account_type.id ,
            oauth_account_type.sys_mode_id AS sysModeId,
            oauth_account_type.name,
            oauth_account_type.at_key AS atKey,
            oauth_account_type.content,
            oauth_account_type.status,
            oauth_sys_mode.name AS sysName
        FROM
          oauth_role oauth_role
        LEFT JOIN oauth_sys_mode oauth_sys_mode ON oauth_role.sys_mode_id = oauth_sys_mode.id
        LEFT JOIN oauth_account_type oauth_account_type ON oauth_account_type.sys_mode_id = oauth_sys_mode.id
        WHERE 1=1
        <if test="null != roleId">
            AND oauth_role.id = #{roleId}
        </if>
    </select>

    <!--根据账号类型及子系统获取有多少个-->
    <select id="getAccountTypeInSysMode" resultType="java.lang.Integer"  parameterType="map">
        SELECT
            COUNT(0)
        FROM
            oauth_account_type oauth_account_type
        LEFT JOIN oauth_sys_mode oauth_sys_mode ON oauth_sys_mode.id = oauth_account_type.sys_mode_id
        WHERE id IN
        <foreach item="item" index="index" collection="id" open="(" separator="," close=")">
            #{item}
        </foreach>
        AND oauth_sys_mode.id = #{sysModeId}
    </select>
</mapper>