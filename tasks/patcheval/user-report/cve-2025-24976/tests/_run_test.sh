#!/bin/bash
set -e

cd /app/distribution

git apply --whitespace=nowarn /tests/test.patch
go test -timeout 30s -run ^TestVerifyJWKWithTrustedKey$ github.com/distribution/distribution/v3/registry/auth/token
go test -timeout 30s -run '^(TestTokenVerify|TestAccessController|TestLeeway|TestNewAccessControllerPemBlock)$' github.com/distribution/distribution/v3/registry/auth/token