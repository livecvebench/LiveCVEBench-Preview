# CVE-2025-5895: Metabase ReDoS Vulnerability in parseDataUri
# Minimal Node.js environment for testing the vulnerable JavaScript function

FROM node:22-slim

WORKDIR /app

# Install required system utilities
RUN apt-get update && apt-get install -y \
    git \
    tmux \
    asciinema \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Create directory structure matching Metabase frontend
RUN mkdir -p /app/frontend/src/metabase/lib

# Copy the vulnerable dom.js file (parseDataUri function extracted from Metabase)
COPY task-deps/dom-simplified.js /app/frontend/src/metabase/lib/dom.js

# Initialize npm and install Jest for testing
RUN npm init -y && npm install jest@29 --save-dev

# Default command - keep container running
CMD ["tail", "-f", "/dev/null"]
