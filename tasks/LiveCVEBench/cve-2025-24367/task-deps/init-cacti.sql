-- Cacti initialization SQL for CVE-2025-24367 testing
-- This script sets up the minimum required data for vulnerability testing

UPDATE version SET cacti = "1.2.28";
UPDATE user_auth SET must_change_password="", password="21232f297a57a5a743894a0e4a801fc3" WHERE username="admin";

INSERT IGNORE INTO settings (name, value) VALUES
("install_complete", "1"),
("cacti_version", "1.2.28"),
("path_rrdtool", "/usr/bin/rrdtool"),
("path_php_binary", "/usr/bin/php"),
("path_snmpwalk", "/usr/bin/snmpwalk"),
("path_snmpget", "/usr/bin/snmpget"),
("path_snmpbulkwalk", "/usr/bin/snmpbulkwalk"),
("path_snmpgetnext", "/usr/bin/snmpgetnext"),
("snmp_version", "net-snmp"),
("rrdtool_version", "rrd-1.7.x"),
("poller_interval", "300"),
("cron_interval", "60"),
("availability_method", "2"),
("ping_method", "1"),
("ping_port", "23"),
("ping_timeout", "400"),
("ping_retries", "1"),
("max_get_size", "10"),
("log_destination", "1"),
("log_verbosity", "2"),
("default_template", "0"),
("hide_console", ""),
("auth_cache_enabled", ""),
("guest_user", "0"),
("user_template", "0"),
("default_view_mode", "1");

INSERT IGNORE INTO graph_templates (id, hash, name) VALUES
(1, "hash1234", "Unix - Logged in Users"),
(2, "hash5678", "Unix - Load Average"),
(3, "hash9012", "Unix - Memory Usage");

INSERT IGNORE INTO graph_templates_graph (local_graph_template_graph_id, local_graph_id, graph_template_id, image_format_id, title, title_cache, height, width, upper_limit, lower_limit, vertical_label, slope_mode, auto_scale, auto_scale_opts, base_value, grouping, unit_exponent_value) VALUES
(0, 0, 1, 1, "Unix - Logged in Users", "", 120, 500, "100", "0", "users", "on", "on", 2, 1000, "", ""),
(0, 0, 2, 1, "Unix - Load Average", "", 120, 500, "100", "0", "load", "on", "on", 2, 1000, "", ""),
(0, 0, 3, 1, "Unix - Memory Usage", "", 120, 500, "100", "0", "bytes", "on", "on", 2, 1000, "", "");

-- Create a host for testing
INSERT IGNORE INTO host (id, poller_id, site_id, host_template_id, description, hostname, status, disabled) VALUES
(1, 1, 0, 0, "Local Machine", "127.0.0.1", 3, "");

-- Create data template
INSERT IGNORE INTO data_template (id, hash, name) VALUES (1, "dt_hash1", "Test Data");

-- Create data_template_data
INSERT IGNORE INTO data_template_data (id, local_data_template_data_id, local_data_id, data_template_id, name, active, rrd_step) VALUES
(1, 0, 0, 1, "Test Data", "on", 300);

-- Create data_template_rrd
INSERT IGNORE INTO data_template_rrd (id, hash, local_data_template_rrd_id, local_data_id, data_template_id, rrd_maximum, rrd_minimum, rrd_heartbeat, data_source_type_id, data_source_name) VALUES
(1, "rrd_hash1", 0, 0, 1, 0, 0, 600, 1, "traffic");

-- Create local data source
INSERT IGNORE INTO data_local (id, data_template_id, host_id, snmp_query_id, snmp_index, orphan) VALUES (1, 1, 1, 0, "", 0);

-- Create data_template_data for local source
INSERT IGNORE INTO data_template_data (id, local_data_template_data_id, local_data_id, data_template_id, name, active, rrd_step) VALUES
(2, 1, 1, 1, "Local Machine - Traffic", "on", 300);

-- Create data_template_rrd for local source
INSERT IGNORE INTO data_template_rrd (id, hash, local_data_template_rrd_id, local_data_id, data_template_id, rrd_maximum, rrd_minimum, rrd_heartbeat, data_source_type_id, data_source_name) VALUES
(2, "rrd_hash2", 1, 1, 1, 0, 0, 600, 1, "traffic");

-- Create local graph
INSERT IGNORE INTO graph_local (id, graph_template_id, host_id, snmp_query_id, snmp_query_graph_id, snmp_index) VALUES (1, 1, 1, 0, 0, "");

-- Create graph_templates_graph for local graph
INSERT IGNORE INTO graph_templates_graph (id, local_graph_template_graph_id, local_graph_id, graph_template_id, image_format_id, title, title_cache, height, width, upper_limit, lower_limit, vertical_label, slope_mode, auto_scale, auto_scale_opts, base_value, right_axis, right_axis_label, right_axis_format) VALUES
(4, 1, 1, 1, 1, "Local Machine - Traffic", "Local Machine - Traffic", 200, 700, "100", "0", "bits/s", "on", "on", 2, 1000, "", "", 0);

-- Create graph item linking to data source
INSERT IGNORE INTO graph_templates_item (id, hash, local_graph_template_item_id, local_graph_id, graph_template_id, task_item_id, color_id, graph_type_id, consolidation_function_id, sequence, text_format) VALUES
(100, "gi_hash1", 0, 1, 1, 2, 9, 7, 1, 1, "Traffic");
