cat <<'EOF' > /workspace/fix.patch
diff --git a/src/index.js b/src/index.js
index 0dc1033..7cd9ec8 100644
--- a/src/index.js
+++ b/src/index.js
@@ -1,11 +1,37 @@
+var Netmask = require('netmask').Netmask
+function netmaskCheck (params) {
+  let privateRanges = [
+    '0.0.0.0/8',
+    '10.0.0.0/8',
+    '100.64.0.0/10',
+    '127.0.0.0/8',
+    '169.254.0.0/16',
+    '172.16.0.0/12',
+    '192.0.0.0/24',
+    '192.0.0.0/29',
+    '192.0.0.8/32',
+    '192.0.0.9/32',
+    '192.0.0.10/32',
+    '192.0.0.170/32',
+    '192.0.0.171/32',
+    '192.0.2.0/24',
+    '192.31.196.0/24',
+    '192.52.193.0/24',
+    '192.88.99.0/24',
+    '192.168.0.0/16',
+    '192.175.48.0/24',
+    '198.18.0.0/15',
+    '198.51.100.0/24',
+    '203.0.113.0/24',
+    '240.0.0.0/4',
+    '255.255.255.255/32'
+  ].map(b => new Netmask(b))
+  for (let r of privateRanges) {
+    if (r.contains(params)) return true
+  }
+  return false
+}
+
 export default (ip) => (
-  /^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(ip) ||
-  /^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(ip) ||
-  /^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(ip) ||
-  /^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(ip) ||
-  /^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(ip) ||
-  /^f[cd][0-9a-f]{2}:/i.test(ip) ||
-  /^fe80:/i.test(ip) ||
-  /^::1$/.test(ip) ||
-  /^::$/.test(ip)
+  netmaskCheck(ip)
 )
 

EOF

cd /workspace/private-ip
git apply --whitespace=nowarn  /workspace/fix.patch