#!/bin/bash
set -e

cd /app/argo-cd
git apply --whitespace=nowarn /tests/test.patch
go test  -timeout 30s -run ^TestUpdateCluster_RejectInvalidParams$ github.com/argoproj/argo-cd/v2/server/cluster && go test -timeout 30s -run '^(TestDeleteClusterByName|TestRotateAuth|TestGetCluster_UrlEncodedName|TestGetCluster_NameWithUrlEncodingButShouldNotBeUnescaped|TestUpdateCluster_FieldsPathSet|TestUpdateCluster_NoFieldsPaths)$' github.com/argoproj/argo-cd/v2/server/cluster

