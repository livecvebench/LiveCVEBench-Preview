#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2020-8559:latest
# bash /workspace/fix-run.sh
set -e

cd /workspace/kubernetes
git apply --whitespace=nowarn /tests/test.patch 
go test  -timeout 30s -run ^TestProxyUpgradeErrorResponse$ k8s.io/apimachinery/pkg/util/proxy

cd /workspace
#!/bin/bash
# From ghcr.io/anonymous2578-data/cve-2020-8559:latest
# bash /workspace/unit_test.sh
set -e

cd /workspace/kubernetes
go test -timeout 30s -run '^(TestNewWarningHeader|TestGetClientIP|TestAppendForwardedForHeader|TestProxyUpgrade|TestTLSClientConfigHolder|TestConnectWithRedirects|TestP
roxyUpgradeErrorResponseTerminates|TestJoinPreservingTrailingSlash|TestE
rrorPropagation|TestSourceIPs|TestServeHTTP|TestProxyUpgradeErrorRespons
e|TestIsProbableEOF|TestFlushIntervalHeaders|TestParseWarningHeaders|Tes
tAllowsHTTP2|TestProxierWithNoProxyCIDR|TestParseWarningHeader|TestDefau
ltProxyTransport)$' k8s.io/apimachinery/pkg/util/proxy