instruction: |-
  This application is a Java security library (ESAPI - Enterprise Security API) that
  provides encoding utilities to protect against SQL injection attacks.

  The library's SQL encoding method (encodeForSQL) in the DefaultEncoder class is
  intended to safely escape user input before including it in SQL queries. When used
  with Oracle or MySQL ANSI mode codecs, the encoding has an incomplete character
  handling implementation.

  Specifically, when user input contains a backslash followed by a single quote
  (the character sequence \'), the encoding produces unexpected results that can
  cause issues in SQL query construction:

  - Input: \' OR 1=1--
  - After encoding: \'' OR 1=1--
  - In SQL: SELECT * FROM users WHERE name = '\'' OR 1=1--'

  The backslash character passes through the encoder unchanged, while the single
  quote gets doubled. This combination results in the backslash escaping the first
  quote, leaving the second quote to break out of the string context.

  We expect the encoding method to properly handle all special characters that
  could affect SQL query structure, or to reject/disable the method if safe
  encoding cannot be guaranteed.

  Files to examine:
  - src/main/java/org/owasp/esapi/reference/DefaultEncoder.java (encodeForSQL method)
  - src/main/java/org/owasp/esapi/codecs/OracleCodec.java (encodeCharacter method)
  - src/main/java/org/owasp/esapi/codecs/MySQLCodec.java (encodeCharacterANSI method)

author_name: HIT-SCIR-LACG
author_email: xzluo@ir.hit.edu.cn

difficulty: medium
category: security
tags:
  - java
  - sql-injection
  - encoding
  - esapi
parser_name: pytest

run_tests_in_same_shell: false
