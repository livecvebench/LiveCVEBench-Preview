#!/bin/bash

# Entrypoint script for pyLoad CVE reproduction environment
# This script wraps the pyLoad service in a restart loop so the container
# stays running when solution.sh needs to restart the service

# Trap to handle signals gracefully
trap 'echo "Received signal, exiting..."; exit 0' SIGTERM SIGINT

# Create data directories if they don't exist
mkdir -p /tmp/pyload-data /tmp/pyload-downloads

while true; do
    echo "Starting pyLoad..."
    pyload --userdir=/tmp/pyload-data --storagedir=/tmp/pyload-downloads
    EXIT_CODE=$?
    echo "pyLoad exited with code $EXIT_CODE, restarting in 2 seconds..."
    sleep 2
done
