cat <<'EOF' > /workspace/fix.patch
diff --git a/lib/utils.js b/lib/utils.js
index 48572cdc..3bcd6859 100644
--- a/lib/utils.js
+++ b/lib/utils.js
@@ -59,8 +59,14 @@ function buildURL (source, reqBase) {
   const dest = new URL(source, reqBase)
 
   // if base is specified, source url should not override it
-  if (reqBase && !reqBase.startsWith(dest.origin)) {
-    throw new Error('source must be a relative path string')
+  if (reqBase) {
+    if (!reqBase.endsWith('/') && dest.href.length > reqBase.length) {
+      reqBase = reqBase + '/'
+    }
+
+    if (!dest.href.startsWith(reqBase)) {
+      throw new Error('source must be a relative path string')
+    }
   }
 
   return dest


EOF

cd /workspace/fastify-reply-from
git apply --whitespace=nowarn  /workspace/fix.patch