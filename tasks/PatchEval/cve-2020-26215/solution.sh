cat <<'EOF' > /workspace/fix.patch
diff --git a/notebook/base/handlers.py b/notebook/base/handlers.py
index 743f7bac73..5e92104007 100755
--- a/notebook/base/handlers.py
+++ b/notebook/base/handlers.py
@@ -854,13 +854,18 @@ def get(self):
 
 class TrailingSlashHandler(web.RequestHandler):
     """Simple redirect handler that strips trailing slashes
-    
+
     This should be the first, highest priority handler.
     """
-    
+
     def get(self):
-        self.redirect(self.request.uri.rstrip('/'))
-    
+        path, *rest = self.request.uri.partition("?")
+        # trim trailing *and* leading /
+        # to avoid misinterpreting repeated '//'
+        path = "/" + path.strip("/")
+        new_uri = "".join([path, *rest])
+        self.redirect(new_uri)
+
     post = put = get
 
 
@@ -911,6 +916,7 @@ def get(self):
         url = sep.join([self._url, self.request.query])
         self.redirect(url, permanent=self._permanent)
 
+
 class PrometheusMetricsHandler(IPythonHandler):
     """
     Return prometheus metrics for this notebook server


EOF

cd /workspace/notebook
git apply --whitespace=nowarn  /workspace/fix.patch