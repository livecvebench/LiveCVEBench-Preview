<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.oauth.dao.OauthTenantDao">

    <!--初始化分页-->
    <select id="getOauthTenantListByCondition" resultType="jehc.djshi.oauth.model.OauthTenant" parameterType="map">
        SELECT
            oauth_tenant.id,
            oauth_tenant.name,
            oauth_tenant.code,
            oauth_tenant.remark,
            oauth_tenant.status,
            oauth_tenant.exp_date AS expDate,
            oauth_tenant.sys_mode_id AS sysModeId,
            oauth_tenant.create_id AS createId,
            oauth_tenant.update_id AS updateId,
            oauth_tenant.create_time AS createTime,
            oauth_tenant.update_time AS updateTime,
            oauth_sys_mode.name AS sysName
        FROM
             oauth_tenant oauth_tenant LEFT JOIN oauth_sys_mode oauth_sys_mode ON oauth_tenant.sys_mode_id = oauth_sys_mode.id
        WHERE 1=1
            AND oauth_tenant.del_flag = 0
        <if test="null != name">
            AND oauth_tenant.name LIKE CONCAT(CONCAT('%',#{name}),'%')
        </if>
        <if test="null != sysModeId">
            AND oauth_tenant.sys_mode_id = #{sysModeId}
        </if>
        <if test="null != code">
            AND oauth_tenant.code = #{code}
        </if>
    </select>

    <!--查询对象-->
    <select id="getOauthTenantById" resultType="jehc.djshi.oauth.model.OauthTenant" parameterType="string">
        SELECT
            oauth_tenant.id,
            oauth_tenant.name,
            oauth_tenant.code,
            oauth_tenant.remark,
            oauth_tenant.status,
            oauth_tenant.exp_date AS expDate,
            oauth_tenant.sys_mode_id AS sysModeId,
            oauth_tenant.create_id AS createId,
            oauth_tenant.update_id AS updateId,
            oauth_tenant.create_time AS createTime,
            oauth_tenant.update_time AS updateTime,
            oauth_sys_mode.name AS sysName
        FROM
            oauth_tenant oauth_tenant LEFT JOIN oauth_sys_mode oauth_sys_mode ON oauth_tenant.sys_mode_id = oauth_sys_mode.id
        WHERE oauth_tenant.id=#{id}
    </select>

    <!--添加-->
    <insert id="addOauthTenant" parameterType="jehc.djshi.oauth.model.OauthTenant">
        INSERT INTO
        oauth_tenant
        (
            id,
            name,
            code,
            remark,
            status,
            exp_date,
            sys_mode_id,
            create_time,
            update_time,
            create_id,
            update_id
        )
        VALUES
        (
            #{id},
            #{name},
            #{code},
            #{remark},
            #{status},
            #{expDate},
            #{sysModeId},
            #{createTime},
            #{updateTime},
            #{createId},
            #{updateId}
        )
    </insert>

    <!--修改-->
    <update id="updateOauthTenant" parameterType="jehc.djshi.oauth.model.OauthTenant">
        UPDATE
            oauth_tenant
        SET
            name = #{name},
            code = #{code},
            remark = #{remark},
            status = #{status},
            exp_date = #{expDate},
            sys_mode_id = #{sysModeId},
            update_time = #{updateTime},
            update_id = #{updateId}
        WHERE id=#{id}
    </update>

    <!--删除-->
    <delete id="delOauthTenant" parameterType="map">
        UPDATE oauth_tenant SET del_flag = 1 WHERE id IN
        <foreach item="item" index="index" collection="id" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>

    <!--根据账号类型查询租户-->
    <select id="getOauthTenantListByAccountTypeId" resultType="jehc.djshi.oauth.model.OauthTenant" parameterType="string">
        SELECT
            oauth_tenant.id,
            oauth_tenant.name,
            oauth_tenant.code,
            oauth_tenant.remark,
            oauth_tenant.status,
            oauth_tenant.exp_date AS expDate,
            oauth_tenant.sys_mode_id AS sysModeId,
            oauth_tenant.create_id AS createId,
            oauth_tenant.update_id AS updateId,
            oauth_tenant.create_time AS createTime,
            oauth_tenant.update_time AS updateTime,
            oauth_sys_mode.name AS sysName,
            oauth_account_type.account_type_id AS accountTypeId
        FROM
            oauth_tenant oauth_tenant
        LEFT JOIN
            oauth_sys_mode oauth_sys_mode ON oauth_sys_mode.id = oauth_tenant.sys_mode_id
        LEFT JOIN
            oauth_account_type oauth_account_type ON oauth_account_type.sys_mode_id = oauth_sys_mode.id
        WHERE 1=1
        AND oauth_tenant.del_flag = 0
        AND oauth_account_type.account_type_id IN
        (
        <foreach item="item" index="index" collection="accountTypeId.split(',')" open=" " separator="," close=" ">
            #{item}
        </foreach>
        )
        AND oauth_tenant.id
            NOT IN (
                SELECT
                    tenant_id
                FROM
                    oauth_account_tenant
                WHERE 1=1
                AND account_type_id IN
                    (
                    <foreach item="item" index="index" collection="accountTypeId.split(',')" open=" " separator="," close=" ">
                        #{item}
                    </foreach>
                    )
            )
<!--        AND oauth_account_type.account_type_id-->
<!--            NOT IN (-->
<!--                SELECT-->
<!--                    oauth_account_tenant.account_type_id-->
<!--                FROM-->
<!--                    oauth_account_tenant-->
<!--                WHERE-->
<!--                    oauth_account_tenant.account_type_id IN-->
<!--                (-->
<!--                <foreach item="item" index="index" collection="accountTypeId.split(',')" open=" " separator="," close=" ">-->
<!--                    #{item}-->
<!--                </foreach>-->
<!--                )-->
<!--            )-->
    </select>
</mapper>