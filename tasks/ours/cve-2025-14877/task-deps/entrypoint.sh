#!/bin/bash
set -e

# Wait for database to be ready
echo "Waiting for database to be ready..."
max_tries=30
counter=0
while ! mysql -h db -u root -proot_password -e "SELECT 1" > /dev/null 2>&1; do
    counter=$((counter + 1))
    if [ $counter -ge $max_tries ]; then
        echo "Database connection timeout"
        exit 1
    fi
    echo "Waiting for database... attempt $counter/$max_tries"
    sleep 2
done
echo "Database is ready!"

# Start Apache in foreground
echo "Starting Apache..."
exec apache2-foreground
