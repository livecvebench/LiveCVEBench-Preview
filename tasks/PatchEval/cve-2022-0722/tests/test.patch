diff --git a/test/index.js b/test/index.js
index 339af1f..d7952f2 100644
--- a/test/index.js
+++ b/test/index.js
@@ -2,7 +2,6 @@
 const parseUrl = require("../lib")
     , tester = require("tester")
     , normalizeUrl = require("normalize-url")
-    , qs = require("querystring")
     ;
 
 const INPUTS = [
@@ -11,12 +10,13 @@ const INPUTS = [
       , {
             protocols: [ "http" ]
           , protocol: "http"
-          , port: null
+          , port: ""
           , resource: "ionicabizau.net"
           , user: ""
           , pathname: "/blog"
           , hash: ""
           , search: ""
+          , query: {}
         }
     ]
   , [
@@ -24,12 +24,13 @@ const INPUTS = [
       , {
             protocols: ["http"]
           , protocol: "http"
-          , port: null
+          , port: ""
           , resource: "ionicabizau.net"
           , user: ""
           , pathname: "/foo.js"
           , hash: ""
           , search: ""
+          , query: {}
         }
     ]
   , [
@@ -37,12 +38,13 @@ const INPUTS = [
       , {
             protocols: ["http"]
           , protocol: "http"
-          , port: null
+          , port: ""
           , resource: "domain.com"
           , user: ""
           , pathname: "/path/name"
           , hash: "some-hash?foo=bar"
           , search: ""
+          , query: {}
         }
     ]
   , [
@@ -50,25 +52,27 @@ const INPUTS = [
       , {
             protocols: ["git", "ssh"]
           , protocol: "git"
-          , port: null
+          , port: ""
           , resource: "host.xz"
           , user: "git"
           , pathname: "/path/name.git"
           , hash: ""
           , search: ""
+          , query: {}
         }
     ]
   , [
         ["git@github.com:IonicaBizau/git-stats.git", false]
       , {
-            protocols: []
+            protocols: ["ssh"]
           , protocol: "ssh"
-          , port: null
+          , port: ""
           , resource: "github.com"
           , user: "git"
           , pathname: "/IonicaBizau/git-stats.git"
           , hash: ""
           , search: ""
+          , query: {}
         }
     ]
   , [
@@ -76,35 +80,59 @@ const INPUTS = [
       , {
             protocols: [ "http" ]
           , protocol: "http"
-          , port: null
+          , port: ""
           , resource: "ionicabizau.net"
           , user: ""
           , pathname: "/with-true-normalize"
           , hash: ""
           , search: ""
+          , query: {}
         }
     ]
 ];
 
+let failedTests = 0;
+
 tester.describe("check urls", test => {
     INPUTS.forEach(function (c) {
         let url = Array.isArray(c[0]) ? c[0][0] : c[0]
         test.should("support " + url, () => {
-            const res = parseUrl(url, c[0][1] !== false);
-            if (c[0][1] !== false) {
-                url = normalizeUrl(url, {
-                    stripHash: false
-                })
+            try {
+                const res = parseUrl(url, c[0][1] !== false);
+
+                if (c[0][1] !== false) {
+                    url = normalizeUrl(url, {
+                        stripHash: false
+                    })
+                }
+
+                c[1].href = c[1].href || url
+                c[1].password = c[1].password || ""
+                test.expect(res).toEqual(c[1]);
+            } catch (err) {
+                failedTests++;
+                console.error(`Test failed: support ${url}\n`, err.message || err);
             }
-            c[1].query = qs.parse(c[1].search)
-            c[1].href = url
-            test.expect(res).toEqual(c[1]);
         });
     });
 
     test.should("throw if url is empty", () => {
-        test.expect(() => {
-            parseUrl("")
-        }).toThrow(/invalid url/i)
-    })
+        try {
+            test.expect(() => {
+                parseUrl("")
+            }).toThrow(/invalid url/i)
+        } catch (err) {
+            failedTests++;
+            console.error(`Test failed: empty url\n`, err.message || err);
+        }
+    });
 });
+
+
+process.on("exit", () => {
+    if (failedTests > 0) {
+        console.error(`\n${failedTests} test(s) failed.`);
+        process.exit(1);
+    }
+});
+
