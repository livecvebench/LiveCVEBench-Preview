-- Combined initialization script for CVE-2025-8434
-- Online Movie Streaming Application

-- Movies table
SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET AUTOCOMMIT = 0;
START TRANSACTION;
SET time_zone = "+00:00";

CREATE TABLE `movies` (
  `mid` int(10) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL,
  `genre` varchar(20) NOT NULL,
  `rdate` varchar(5) NOT NULL,
  `runtime` varchar(4) NOT NULL,
  `decription` varchar(100) NOT NULL,
  `viewers` int(10) DEFAULT '1',
  `imgpath` varchar(50) NOT NULL,
  `videopath` varchar(50) NOT NULL,
  PRIMARY KEY (`mid`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

-- Insert a sample movie (needed for foreign key constraint)
INSERT INTO `movies` (`mid`, `name`, `genre`, `rdate`, `runtime`, `decription`, `viewers`, `imgpath`, `videopath`)
VALUES (1, 'sample movie', 'drama', '2020', '120', 'A sample movie for testing', 1, 'sample.jpg', 'sample.mp4');

-- User table
CREATE TABLE `user1` (
  `id` int(100) NOT NULL AUTO_INCREMENT,
  `username` varchar(25) NOT NULL,
  `passwd` varchar(20) NOT NULL,
  `admin` tinyint(1) DEFAULT NULL,
  `name` varchar(20) NOT NULL,
  `phone` varchar(10) NOT NULL,
  `email` varchar(25) NOT NULL,
  `DOB` varchar(10) NOT NULL,
  `mid` int(11) DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  KEY `mid` (`mid`),
  CONSTRAINT `user1_ibfk_1` FOREIGN KEY (`mid`) REFERENCES `movies` (`mid`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

-- Create admin user (admin=1)
INSERT INTO `user1` (`id`, `username`, `passwd`, `admin`, `name`, `phone`, `email`, `DOB`, `mid`)
VALUES (1, 'admin@test.com', 'admin123', 1, 'Admin User', '1234567890', 'admin@test.com', '1990/01/01', 1);

-- Create regular user (admin=NULL)
INSERT INTO `user1` (`id`, `username`, `passwd`, `admin`, `name`, `phone`, `email`, `DOB`, `mid`)
VALUES (2, 'user@test.com', 'user123', NULL, 'Regular User', '0987654321', 'user@test.com', '1995/05/05', 1);

COMMIT;
