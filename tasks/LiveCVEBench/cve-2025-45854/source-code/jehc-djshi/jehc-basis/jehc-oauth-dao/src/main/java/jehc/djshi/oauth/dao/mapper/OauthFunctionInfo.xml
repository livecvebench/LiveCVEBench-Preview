<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jehc.djshi.oauth.dao.OauthFunctionInfoDao">
	<!--初始化分页-->
	<select id="getOauthFunctionInfoListByCondition" resultType="jehc.djshi.oauth.model.OauthFunctionInfo" parameterType="map">
		SELECT
			id,
			name,
			url,
			method,
			sys_mode_id AS sysModeId,
			sys_modules_id AS sysModulesId,
			is_sys_modules AS isSysModules,
			is_filter AS isFilter,
			resources_id AS resourcesId,
			is_authority AS isAuthority,
			status
		FROM 
			oauth_function_info
		WHERE 1=1
		<if test="null != sysModeId">
			AND sys_mode_id = #{sysModeId}
		</if>
		<if test="null != isFilter">
			AND is_filter = #{isFilter}
		</if>
		<if test="null != resourcesId">
			AND resources_id = #{resourcesId}
		</if>
	</select>

	<!--初始化集合（for admin all function）-->
	<select id="getFunctioninfoListForAdmin" resultType="jehc.djshi.oauth.model.OauthFunctionInfo" parameterType="map">
		SELECT
			url,
			method,
			is_filter AS isFilter,
			is_authority AS isAuthority,
		FROM
			oauth_function_info
		WHERE status = 0 AND is_authority = 1
	</select>

	<!--查询对象-->
	<select id="getOauthFunctionInfoById" resultType="jehc.djshi.oauth.model.OauthFunctionInfo" parameterType="string">
		SELECT
			oauth_function_info.id,
			oauth_function_info.name,
			oauth_function_info.url,
			oauth_function_info.method,
			oauth_function_info.sys_mode_id AS sysModeId,
			oauth_function_info.sys_modules_id AS sysModulesId,
			oauth_function_info.is_sys_modules AS isSysModules,
			oauth_function_info.is_filter AS isFilter,
			oauth_function_info.resources_id AS resourcesId,
			oauth_function_info.is_authority AS isAuthority,
			oauth_function_info.status,
			oauth_resources.name AS resourcesName
		FROM
			oauth_function_info oauth_function_info LEFT JOIN oauth_resources oauth_resources ON oauth_function_info.resources_id = oauth_resources.id
		WHERE oauth_function_info.id=#{id}
	</select>

	<!--添加-->
	<insert id="addOauthFunctionInfo" parameterType="jehc.djshi.oauth.model.OauthFunctionInfo">
		INSERT INTO
			oauth_function_info
			(
			id,
			name,
			url,
			method,
			sys_mode_id,
			sys_modules_id,
			is_sys_modules,
			is_filter,
			resources_id,
			status,
			is_authority,
			create_id,
			create_time
			)
			VALUES
			(
			#{id},
			#{name},
			#{url},
			#{method},
			#{sysModeId},
			#{sysModulesId},
			#{isSysModules},
			#{isFilter},
			#{resourcesId},
			#{status},
			#{isAuthority},
			#{createId},
			#{createTime}
			)
	</insert>

	<!--修改-->
	<update id="updateOauthFunctionInfo" parameterType="jehc.djshi.oauth.model.OauthFunctionInfo">
		UPDATE
			oauth_function_info
		SET
			name = #{name},
			url = #{url},
			method = #{method},
			sys_mode_id = #{sysModeId},
			sys_modules_id = #{sysModulesId},
			is_sys_modules = #{isSysModules},
			is_filter = #{isFilter},
			is_authority = #{isAuthority},
			resources_id = #{resourcesId},
			status = #{status},
			update_id = #{updateId},
			update_time = #{updateTime}
		WHERE id=#{id}
	</update>

	<!--修改（根据动态条件）-->
	<update id="updateOauthFunctionInfoBySelective" parameterType="jehc.djshi.oauth.model.OauthFunctionInfo">
		UPDATE
			oauth_function_info
		<set>
			<if test="name != null">
				name = #{name},
			</if>
			<if test="url != null">
				url = #{url},
			</if>
			<if test="method != null">
				method = #{method},
			</if>
			<if test="sysModeId != null">
				sys_mode_id = #{sysModeId},
			</if>
			<if test="sysModulesId != null">
				sys_modules_id = #{sysModulesId},
			</if>
			<if test="isSysModules != null">
				is_sys_modules = #{isSysModules},
			</if>
			<if test="isFilter != null">
				is_filter = #{isFilter},
			</if>
			<if test="resourcesId != null">
				resources_id = #{resourcesId},
			</if>
			<if test="isAuthority != null">
				is_authority = #{isAuthority},
			</if>
			<if test="status != null">
				status = #{status},
			</if>
		</set>
		WHERE id=#{id}
	</update>

	<!--删除-->
	<delete id="delOauthFunctionInfo" parameterType="map">
		DELETE FROM oauth_function_info WHERE id IN
		<foreach item="item" index="index" collection="id" open="(" separator="," close=")">
			#{item}
		</foreach>
	</delete>

	<!--批量修改-->
	<update id="updateBatchOauthFunctionInfo" parameterType="list">
		<foreach collection="list" item="item" index="index" open="" close="" separator=";">
			UPDATE
				oauth_function_info
			SET
				name = #{item.name},
				url = #{item.url},
				method = #{item.method},
				sys_mode_id = #{item.sysModeId},
				sys_modules_id = #{item.sysModulesId},
				is_sys_modules = #{item.isSysModules},
				is_filter = #{item.isFilter},
				resources_id = #{item.resourcesId},
				is_authority = #{isAuthority},
				status = #{status}
			WHERE id=#{item.id}
		</foreach>
	</update>

	<!--批量修改（根据动态条件）-->
	<update id="updateBatchOauthFunctionInfoBySelective" parameterType="list">
		<foreach collection="list" item="item" index="index" open="" close="" separator=";">
			UPDATE
				oauth_function_info
			<set>
				<if test="item.name != null">
					name = #{item.name},
				</if>
				<if test="item.url != null">
					url = #{item.url},
				</if>
				<if test="item.method != null">
					method = #{item.method},
				</if>
				<if test="item.sysModeId != null">
					sys_mode_id = #{item.sysModeId},
				</if>
				<if test="item.sysModulesId != null">
					sys_modules_id = #{item.sysModulesId},
				</if>
				<if test="item.isSysModules != null">
					is_sys_modules = #{item.isSysModules},
				</if>
				<if test="item.isFilter != null">
					is_filter = #{item.isFilter},
				</if>
				<if test="item.resourcesId != null">
					resources_id = #{item.resourcesId},
				</if>
				<if test="item.isAuthority != null">
					is_authority = #{item.isAuthority},
				</if>
				<if test="item.status != null">
					status = #{item.status},
				</if>
			</set>
			WHERE id=#{item.id}
		</foreach>
	</update>

	<!--读取所有功能-->
	<select id="getOauthFunctionInfoList" resultType="jehc.djshi.oauth.model.OauthFunctionInfo" parameterType="map">
		SELECT
			oauth_function_info.id,
			oauth_function_info.name,
			oauth_function_info.url,
			oauth_function_info.method,
			oauth_function_info.sys_mode_id AS sysModeId,
			oauth_function_info.sys_modules_id AS sysModulesId,
			oauth_function_info.is_sys_modules AS isSysModules,
			oauth_function_info.is_filter AS isFilter,
			oauth_function_info.resources_id AS resourcesId,
			oauth_function_info.is_authority AS isAuthority,
			oauth_function_info.status,
			oauth_resources.name AS resourcesName
		FROM
			oauth_function_info oauth_function_info LEFT JOIN oauth_resources oauth_resources ON oauth_function_info.resources_id = oauth_resources.id
		WHERE 1=1
			<if test="null != isFilter">
				AND oauth_function_info.is_filter = #{isFilter}
			</if>
	</select>
</mapper>