FROM php:7.4-apache

WORKDIR /var/www/html

# Install mysqli extension and required tools
RUN docker-php-ext-install mysqli && \
    apt-get update && \
    apt-get install -y git tmux asciinema curl wget gcc g++ default-mysql-client && \
    rm -rf /var/lib/apt/lists/*

# Copy application (using JSON array form to handle spaces in path)
COPY ["task-deps/School File Management System/", "/var/www/html/"]

# Update conn.php to use 'db' as MySQL host and 'root' password for Docker networking
RUN sed -i 's/localhost/db/g' /var/www/html/admin/conn.php && \
    sed -i 's/"root", ""/"root", "root"/g' /var/www/html/admin/conn.php

# Set permissions
RUN chown -R www-data:www-data /var/www/html/ && \
    chmod -R 755 /var/www/html/ && \
    chmod -R 777 /var/www/html/files/

# Apache configuration - enable mod_rewrite
RUN a2enmod rewrite


# CMD moved to docker-compose.yaml
# CMD ["apache2-foreground"]
