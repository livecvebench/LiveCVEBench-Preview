<?php
/**
 * Test helper to call Output::getPurified from Python tests
 * Usage: php test_helper.php '<html input>'
 */

// Load HTMLPurifier
require_once '/app/vendor/autoload.php';

// Load the Output class
require_once '/app/core/classes/Core/Output.php';

// Get input from command line argument
$test_input = $argv[1] ?? '';

try {
    $result = Output::getPurified($test_input);

    // Output as JSON for Python to parse
    echo json_encode([
        'success' => true,
        'input' => $test_input,
        'output' => $result,
        'has_iframe' => (bool)preg_match('/<iframe[^>]*>/i', $result),
        'has_iframe_width' => (bool)preg_match('/<iframe[^>]*\bwidth\s*=/i', $result),
        'has_iframe_height' => (bool)preg_match('/<iframe[^>]*\bheight\s*=/i', $result),
        'has_img_width' => (bool)preg_match('/<img[^>]*\bwidth\s*=/i', $result),
        'has_img_height' => (bool)preg_match('/<img[^>]*\bheight\s*=/i', $result),
    ], JSON_PRETTY_PRINT);
} catch (Exception $e) {
    echo json_encode([
        'success' => false,
        'error' => $e->getMessage(),
    ], JSON_PRETTY_PRINT);
    exit(1);
}
