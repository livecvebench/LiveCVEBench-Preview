"""Pytest configuration for Django tests."""
import os
import sys

# Add the tests directory to path for settings discovery
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

# Configure Django settings before any Django imports
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'test_settings')

import django
django.setup()

import pytest


@pytest.fixture(scope="session")
def django_db_setup(django_db_blocker):
    """Set up the database for the test session."""
    with django_db_blocker.unblock():
        from django.core.management import call_command
        # Create all tables
        call_command('migrate', '--run-syncdb', verbosity=0)


@pytest.fixture
def db(django_db_setup, django_db_blocker):
    """Provide access to the database for a test."""
    with django_db_blocker.unblock():
        yield
