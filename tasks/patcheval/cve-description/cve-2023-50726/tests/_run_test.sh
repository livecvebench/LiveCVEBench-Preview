#!/bin/bash
set -e

cd /app/argo-cd
git apply --whitespace=nowarn /tests/test.patch
go test  -timeout 30s -run ^TestCreateAppWithOperation$ github.com/argoproj/argo-cd/v2/server/application
go test -timeout 60s -run '^(TestGetCachedAppState|TestCoupleAppsListApps|TestLogsGetSelectedPod|TestServer_GetApplicationSyncWindowsState|TestListAppWithProjects|TestSplitStatusPatch|TestListAppsInDefaultNSWithLabels|TestInferResourcesStatusHealth|TestSyncHelm|TestUpdateAppSpec|TestCreateApp|TestDeleteApp|TestRunNewStyleResourceAction|TestUpdateApp|TestRollbackApp|TestSyncGit|TestAppMergePatch|TestListApps|TestAppNamespaceRestrictions|TestIsApplicationPermitted|TestGetAppRefresh_HardRefresh|TestRunOldStyleResourceAction|TestSyncAndTerminate|TestUpdateAppProject|TestCreateAppWithDestName|TestAppJsonPatch|TestListAppsInNamespaceWithLabels|TestGetAppRefresh_NormalRefresh|TestNoAppEnumeration)$' github.com/argoproj/argo-cd/v2/server/application
