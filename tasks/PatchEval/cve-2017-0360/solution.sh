cat <<'EOF' > /workspace/fix.patch
diff --git a/trytond/tools/misc.py b/trytond/tools/misc.py
index 2b9a7f8f4..ec53fe384 100644
--- a/trytond/tools/misc.py
+++ b/trytond/tools/misc.py
@@ -32,7 +32,7 @@ def secure_join(root, *paths):
         "Join paths and ensure it still below root"
         path = os.path.join(root, *paths)
         path = os.path.normpath(path)
-        if not path.startswith(root):
+        if not path.startswith(os.path.join(root, '')):
             raise IOError("Permission denied: %s" % name)
         return path
 


EOF

cd /workspace/trytond
git apply --whitespace=nowarn  /workspace/fix.patch