#!/bin/bash
set -e

# Use TEST_DIR if set, otherwise default to /tests
TEST_DIR="${TEST_DIR:-/tests}"
cd "$TEST_DIR"

echo "=== Atheos IDE Git Integration Tests ==="
echo "Installing test dependencies..."

# Install uv for isolated Python environment
curl -LsSf https://astral.sh/uv/0.7.13/install.sh | sh 2>/dev/null
source $HOME/.local/bin/env 2>/dev/null || true
export PATH="$HOME/.local/bin:$PATH"

# Initialize uv project if needed
uv init 2>/dev/null || true

# Install pytest and requests
uv add pytest requests 2>/dev/null

echo ""
echo "=== Running All Tests ==="
echo ""
# Run both test files together so pytest produces a single summary
uv run pytest test_func.py test_vuln.py -v -rA

echo ""
echo "=== All tests completed ==="
