#!/bin/bash
# Entrypoint script for Redash Python Query Runner test environment
# This keeps the container running for testing purposes

set -e

# Verify the required file exists
if [ ! -f "/app/redash/query_runner/python.py" ]; then
    echo "ERROR: Required file not found at /app/redash/query_runner/python.py"
    exit 1
fi

# Verify RestrictedPython is installed
python3 -c "from RestrictedPython import compile_restricted; print('RestrictedPython loaded successfully')"

# Set up minimal configuration
export REDASH_REDIS_URL=${REDASH_REDIS_URL:-redis://localhost:6379/0}
export REDASH_DATABASE_URL=${REDASH_DATABASE_URL:-postgresql://postgres:postgres@localhost:5432/redash}

echo "Redash Python Query Runner environment ready"
echo "Python query runner file: /app/redash/query_runner/python.py"

# Keep container running
exec tail -f /dev/null
