instruction: |-
  This application is a Redis server with embedded Lua scripting support for
  running custom scripts via the EVAL command.

  Users have reported that the Redis server occasionally crashes when running
  Lua scripts that perform intensive garbage collection operations while using
  the loadstring() function. The issue manifests as follows:

  1. A Lua script creates memory pressure by allocating large strings
  2. The script calls collectgarbage("collect") to trigger garbage collection
  3. The script then uses loadstring() to dynamically parse and compile Lua code
  4. Under certain timing conditions, the server crashes or the connection drops

  Example script pattern that triggers the issue:
  ```lua
  local garbage = {}
  for i = 1, 100 do
      garbage[i] = string.rep("A", 65536)
  end
  collectgarbage("collect")
  local chunk_name = string.rep("X", 1024)
  local func, err = loadstring(some_code, chunk_name)
  ```

  The crash is intermittent - it may take multiple script executions before
  it occurs. When it happens, the Redis connection is lost and the client
  receives a connection error.

  We expect the Lua parser to handle garbage collection safely during script
  compilation without crashing, even under memory pressure conditions.

difficulty: hard
category: bug-fix
tags:
  - redis
  - lua
  - memory-management
  - parser
  - c
parser_name: pytest

run_tests_in_same_shell: false
