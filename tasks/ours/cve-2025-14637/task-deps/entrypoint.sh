#!/bin/bash
set -e

# Wait for MySQL to be ready
until mysql -h mysql -uroot -proot -e "SELECT 1" > /dev/null 2>&1; do
    echo "Waiting for MySQL to be ready..."
    sleep 2
done

# Check if database is initialized
DB_INITIALIZED=$(mysql -h mysql -uroot -proot -e "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='dbcnp'" -s -N)

if [ "$DB_INITIALIZED" = "0" ]; then
    echo "Initializing database..."
    mysql -h mysql -uroot -proot dbcnp < /var/www/html/pet1/database/dbcnp.sql
    echo "Database initialized successfully."
else
    echo "Database already initialized."
fi

# Start Apache in foreground
exec apache2-foreground
